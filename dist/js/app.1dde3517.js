(()=>{"use strict";var e={738(e,a,t){t.d(a,{IZ:()=>r,J9:()=>m,KY:()=>v,LD:()=>p,cA:()=>u,dH:()=>d,dZ:()=>c,f:()=>o,jW:()=>s,k4:()=>i,kK:()=>n});var l=t(5142);const n=async(e,a,t)=>{try{const n=new URLSearchParams;e&&n.append("tag",e),a&&n.append("keyword",a),t&&n.append("account_id",t);const s=await fetch(`${l.JR}/api/contacts?${n.toString()}`,{headers:l.b3});if(!s.ok){const e=await s.json();throw new Error(e.detail||"获取好友列表失败")}const o=await s.json(),i=Array.isArray(o)?o.map(e=>({id:String(e.name||""),name:String(e.name||""),wxid:String(e.wxid||""),tags:Array.isArray(e.tags)?e.tags.map(e=>String(e||"")):[],avatar:e.avatar||void 0,is_new:!0===e.is_new})).filter(e=>e.name.length>0):[];return i}catch(n){throw console.error("获取好友列表失败:",n),n}},s=async e=>{try{const a=await fetch(`${l.JR}/api/contacts/invite-to-group`,{method:"POST",headers:{...l.b3,"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok){const e=await a.json();console.debug("批量拉群失败响应:",e);const t=e&&(e.error||e.message)||"批量拉群失败";throw new Error(t)}return await a.json()}catch(a){throw console.error("批量拉群失败:",a),a}},o=async(e,a)=>{try{const t=new URLSearchParams;e&&t.append("keyword",e),a&&t.append("account_id",a);const n=await fetch(`${l.JR}/api/contacts/groups?${t.toString()}`,{headers:l.b3});if(!n.ok){const e=await n.json();throw new Error(e.detail||"获取群聊列表失败")}const s=await n.json();return s.groups||[]}catch(t){throw console.error("获取群聊列表失败:",t),t}},i=async e=>{try{const a=await fetch(`${l.JR}/api/contacts/groups/set-tag`,{method:"POST",headers:{...l.b3,"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok){const e=await a.json().catch(()=>({}));throw new Error(e.detail||e.error||"批量设置群标签失败")}return await a.json()}catch(a){throw console.error("批量设置群标签失败:",a),a}},r=async e=>{try{const a=new URLSearchParams;e&&a.append("account_id",e);const t=await fetch(`${l.JR}/api/contacts/tags?${a.toString()}`,{headers:l.b3});if(!t.ok){const e=await t.json();throw new Error(e.detail||"获取标签列表失败")}return await t.json()}catch(a){throw console.error("获取标签列表失败:",a),a}},c=async e=>{try{const a=new URLSearchParams;e&&a.append("account_id",e);const t=await fetch(`${l.JR}/api/contacts/group_tags?${a.toString()}`,{headers:l.b3});if(!t.ok){const e=await t.json();throw new Error(e.detail||"获取群聊标签列表失败")}return await t.json()}catch(a){throw console.error("获取群聊标签列表失败:",a),a}},u=async e=>{try{const a={type:"group"};e&&(a.account_id=e);const t=await fetch(`${l.JR}/api/contact/sync`,{method:"POST",headers:l.b3,body:JSON.stringify(a)});if(!t.ok){const e=await t.json();throw new Error(e.detail||"同步群聊失败")}const n=await t.json();return console.debug("syncContacts-group",n),n}catch(a){throw console.error("同步群聊失败:",a),a}},d=async e=>{try{const a={type:"friend"};e&&(a.account_id=e);const t=await fetch(`${l.JR}/api/contact/sync`,{method:"POST",headers:l.b3,body:JSON.stringify(a)});if(!t.ok){const e=await t.json();throw new Error(e.detail||"同步通讯录失败")}const n=await t.json();return console.debug("syncContacts-friend",n),n}catch(a){throw console.error("同步通讯录失败:",a),a}},v=async(e,a)=>{try{const t=new URLSearchParams;e&&t.append("date",e),a&&t.append("agent_id",a);const n=await fetch(`${l.JR}/api/tasks/auto-follow/by-start-date?${t.toString()}`,{headers:l.b3}),s=await n.json();if(!n.ok)throw new Error(s.detail||s.error||"获取自动跟单任务失败");return Array.isArray(s)?s:s.tasks||[]}catch(t){throw console.error("获取自动跟单任务失败:",t),t}},m=async e=>{try{const a=await fetch(`${l.JR}/api/tasks/auto-follow/batch-cancel`,{method:"POST",headers:{...l.b3,"Content-Type":"application/json"},body:JSON.stringify({task_ids:e})});if(!a.ok){const e=await a.json();throw new Error(e.detail||"批量取消自动跟单任务失败")}return await a.json()}catch(a){throw console.error("批量取消自动跟单任务失败:",a),a}},p=async(e,a)=>{try{const t=await fetch(`${l.JR}/api/tasks/auto-follow/batch-update-agent`,{method:"POST",headers:{...l.b3,"Content-Type":"application/json"},body:JSON.stringify({task_ids:e,agent_id:a})});if(!t.ok){const e=await t.json();throw new Error(e.detail||"批量修改自动跟单任务智能体失败")}return await t.json()}catch(t){throw console.error("批量修改自动跟单任务智能体失败:",t),t}}},3863(e,a,t){t.d(a,{A:()=>n});var l=t(6892);const n=(0,l.y$)({state:{userInfo:null,isLoggedIn:!1},getters:{getUserInfo:e=>e.userInfo,isLoggedIn:e=>e.isLoggedIn},mutations:{SET_USER_INFO(e,a){e.userInfo=a,e.isLoggedIn=!0},CLEAR_USER_INFO(e){e.userInfo=null,e.isLoggedIn=!1}},actions:{setUserInfo({commit:e},a){e("SET_USER_INFO",a)},logout({commit:e}){e("CLEAR_USER_INFO")}},modules:{}})},3957(e,a,t){t.d(a,{J:()=>s});var l=t(2261);const n={theme:{primary:"#2c3e50",menuBackground:"#2c3e50",menuTextColor:"#ffffff",menuActiveTextColor:"#ffd04b",menuHoverBackground:"#34495e",gradientStart:"#2c3e50",gradientEnd:"#4c5b6a"},navbar:{items:[{index:"welcome",text:"欢迎"},{index:"ai-chat",text:"AI销冠"},{index:"customer-management",text:"客户管理"},{index:"auto-add",text:"自动化SOP"},{index:"settings",text:"配置"}]}},s=(0,l.nY)("config",{state:()=>({config:n,isLoaded:!1}),actions:{async loadConfig(){try{const e=await fetch("/config.json"),a=await e.json();this.config=a,this.isLoaded=!0}catch(e){console.error("Failed to load config:",e),this.isLoaded=!0}}}})},4032(e,a,t){t.d(a,{Y:()=>n});class l{ws=null;reconnectAttempts=0;maxReconnectAttempts=10;reconnectTimeout=1e3;isReconnecting=!1;heartbeatInterval=null;heartbeatTimeout=null;constructor(){this.connect()}checkConnection(){this.ws&&this.ws.readyState===WebSocket.OPEN||(console.debug("WebSocket 连接已断开，尝试重新连接..."),this.connect())}connect(){this.ws?.readyState!==WebSocket.OPEN&&(this.ws=new WebSocket(`ws://${window.location.host}/ws`),this.ws.onopen=()=>{console.debug("WebSocket已连接..."),this.reconnectAttempts=0,this.isReconnecting=!1,this.startHeartbeat()},this.ws.onmessage=e=>{try{const a=JSON.parse(e.data);if(console.debug("收到WebSocket消息:",a),"pong"===a.type||"ping"===a.type)return console.debug("收到心跳响应"),void(this.heartbeatTimeout&&(clearTimeout(this.heartbeatTimeout),this.heartbeatTimeout=null));this.handleMessage(a)}catch(a){console.error("解析WebSocket消息失败:",a,"原始消息:",e.data)}},this.ws.onclose=e=>{console.debug("WebSocket断开连接...",e.code,e.reason),this.stopHeartbeat(),this.isReconnecting||this.reconnect()},this.ws.onerror=e=>{console.error("WebSocket连接报错:",e),this.stopHeartbeat(),this.isReconnecting||this.reconnect()})}startHeartbeat(){this.stopHeartbeat(),this.heartbeatInterval=window.setInterval(()=>{if(this.ws?.readyState===WebSocket.OPEN)try{this.ws.send(JSON.stringify({type:"ping"})),console.debug("发送心跳包"),this.heartbeatTimeout=window.setTimeout(()=>{console.warn("心跳响应超时，尝试重连..."),this.reconnect()},1e4)}catch(e){console.error("发送心跳包失败:",e),this.reconnect()}else console.debug("WebSocket未连接，尝试重连..."),this.reconnect()},3e4)}stopHeartbeat(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null)}reconnect(){if(this.isReconnecting)return;if(this.isReconnecting=!0,this.reconnectAttempts>=this.maxReconnectAttempts)return console.error("Max reconnection attempts reached"),this.isReconnecting=!1,void setTimeout(()=>{this.reconnectAttempts=0,this.reconnect()},3e4);this.reconnectAttempts++,console.debug(`Attempting to reconnect (${this.reconnectAttempts}/${this.maxReconnectAttempts})...`);const e=this.reconnectTimeout*Math.pow(1.5,Math.min(this.reconnectAttempts,8));setTimeout(()=>{this.connect()},e)}handleMessage(e){switch(console.debug("接收到广播消息:",e.type,"数据:",e.data),e.type){case"mass_sending_tasks":this.handleMassSendingTasks(e.data);break;case"task_status":if(!e.data?.task_id)return void console.error("收到无效的任务状态消息:",e);this.handleTaskStatus(e.data);break;case"monitor_status":console.debug("Received monitor monitor_status:",e.data),window.dispatchEvent(new CustomEvent("monitor-status",{detail:e.data}));break;case"task_session":console.debug("Received monitor task_session:",e.data),window.dispatchEvent(new CustomEvent("task-session",{detail:e.data}));break;case"session_list":console.debug("Received monitor session_list:",e.data),window.dispatchEvent(new CustomEvent("session-list",{detail:e.data}));break;case"scheduler_status":this.handleSchedulerStatus(e.data);break;case"task_progress":this.handleTaskProgress(e.data);break;case"auto_reply_task":this.handleAutoReplyTask(e.data);break;case"pending_reply":console.debug("收到待确认回复:",e.data),window.dispatchEvent(new CustomEvent("pending-reply",{detail:e.data}));break;case"auto_config_progress":console.debug("Received auto_config_progress:",e.data),window.dispatchEvent(new CustomEvent("auto-config-progress",{detail:e.data}));break;case"error_task":window.dispatchEvent(new CustomEvent("error-task",{detail:e.data}));break}}handleMassSendingTasks(e){window.dispatchEvent(new CustomEvent("massSendingTasks",{detail:e}))}handleTaskStatus(e){("mass_sending"===e.type||"chat_collection"===e.type)&&window.dispatchEvent(new CustomEvent("taskStatus",{detail:e}))}handleSchedulerStatus(e){window.dispatchEvent(new CustomEvent("scheduler-status-update",{detail:e}))}handleTaskProgress(e){window.dispatchEvent(new CustomEvent("task-progress-update",{detail:e}))}handleAutoReplyTask(e){window.dispatchEvent(new CustomEvent("auto-reply-task-update",{detail:e}))}}const n=new l},4962(e,a,t){t.d(a,{A:()=>X});var l=t(6768),n=t(144),s=t(4232),o=t(1219),i=t(738),r=t(5142),c=t(7477),u=t(5186);const d={class:"warning-text"},v={class:"label-with-icon"},m={class:"item-content"},p={class:"label-with-icon"},g={class:"item-content"},k={class:"grouping-control"},h={key:0,class:"grouping-input"},f={key:0,class:"form-tip"},y={class:"label-with-icon"},b={class:"item-content"},_={class:"label-with-icon"},w={class:"item-content date-picker-container"},L={class:"label-with-icon"},F={class:"item-content"},C={class:"selected-targets"},E={class:"label-with-icon"},I={class:"item-content"},R={class:"label-with-icon"},T={class:"item-content"},V={class:"label-with-icon"},x={class:"item-content"},A={class:"dialog-footer"},W=(0,l.pM)({__name:"CreateTaskDialog",props:{visible:{type:Boolean,default:!1},modelValue:{type:Boolean,default:!1},greetingGroups:{type:Array,default:()=>[]},selectedFriends:{type:Array,default:()=>[]},selectedGroups:{type:Array,default:()=>[]},wechatNickname:{type:String,default:""},isFromSOP:{type:Boolean,default:!1}},emits:["update:visible","update:modelValue","create"],setup(e,{emit:a}){const t=e,W=(0,l.EW)(()=>{const e=window.innerWidth;return e<768?"95%":e<1200?"80%":"500px"}),S=(0,l.EW)(()=>{const e=[];if(t.selectedFriends.length>0){const a=t.selectedFriends.length<=3?t.selectedFriends.join("、"):`${t.selectedFriends.slice(0,3).join("、")}等${t.selectedFriends.length}个好友`;e.push(a)}if(t.selectedGroups.length>0){const a=t.selectedGroups.length<=3?t.selectedGroups.join("、"):`${t.selectedGroups.slice(0,3).join("、")}等${t.selectedGroups.length}个群聊`;e.push(a)}return e.join("；")}),K=(0,n.KR)([]),X=(0,n.KR)([]),$=async()=>{try{const e=await(0,r.zj)("greeting_config");console.debug("加载话术组",e);const a=e?.data?.greeting_config?.greeting_config;Array.isArray(a)?(K.value=a.map(e=>({id:e.name,name:e.name,greetings:Array.isArray(e.greetings)?e.greetings:[]})),console.debug("加载的话术组:",K.value)):(console.warn("话术组数据格式不正确:",a),K.value=[])}catch(e){console.error("加载话术组失败:",e),o.nk.error("加载话术组失败")}},U=async()=>{try{const e=await(0,r.zj)("agents");if(e.success&&e.data){const a=Array.isArray(e.data)?e.data:Array.isArray(e.data.agents)?e.data.agents:[];X.value=a.filter(e=>e.name&&e.botId)}}catch(e){console.error("加载智能体配置失败:",e)}},j=a,D=(0,l.EW)({get:()=>t.visible||t.modelValue,set:e=>{j("update:visible",e),j("update:modelValue",e)}}),P=(0,n.KR)([]),z=e=>{if(e){const a=e.getHours(),t=e.getMinutes(),l=new Date;O.value.time=new Date(l.getFullYear(),l.getMonth(),l.getDate(),a,t,0)}},M=e=>{const a=-e.getTimezoneOffset(),t=a>=0?"+":"-",l=e=>`${Math.floor(Math.abs(e))}`.padStart(2,"0"),n=l(a/60),s=l(a%60);return e.getFullYear()+"-"+l(e.getMonth()+1)+"-"+l(e.getDate())+"T"+l(e.getHours())+":"+l(e.getMinutes())+":"+l(e.getSeconds())+t+n+":"+s},N=e=>{const a=new Date;a.setHours(0,0,0,0);const t=new Date;return t.setDate(t.getDate()+60),e.getTime()<a.getTime()||e.getTime()>t.getTime()},O=(0,n.KR)({timeType:"now",scheduleDate:void 0,dayOffset:0,time:new Date,tagIds:[],contentType:"greeting",greetingGroupId:"",agentId:"",sendInterval:"3-8",autoGrouping:!1,batchSize:10}),G=async()=>{try{P.value=await(0,i.IZ)()}catch(e){console.error("加载用户标签失败:",e),o.nk.error("加载用户标签失败")}},q=async()=>{try{if("schedule"===O.value.timeType){if(!O.value.scheduleDate)return void o.nk.warning("请选择发送日期");if(!O.value.time)return void o.nk.warning("请选择发送时间")}if(!O.value.tagIds.length&&!t.selectedFriends.length&&!t.selectedGroups.length)return void o.nk.warning("请选择本次推送的目标");if("greeting"===O.value.contentType&&!O.value.greetingGroupId)return void o.nk.warning("请选择话术组");if("agent"===O.value.contentType&&!O.value.agentId)return void o.nk.warning("请选择智能体");let e={...O.value,time:O.value.time,selectedFriends:t.selectedFriends,selectedGroups:t.selectedGroups};if("schedule"===O.value.timeType&&O.value.scheduleDate&&O.value.time){const a=new Date(O.value.scheduleDate),t=O.value.time,l=new Date(a.getFullYear(),a.getMonth(),a.getDate(),t.getHours(),t.getMinutes(),0);e.time=M(l)}j("create",e),D.value=!1}catch(e){console.error("创建任务失败:",e),o.nk.error("创建任务失败")}},J=()=>(0,l.dY)();return(0,l.sV)(()=>{G(),$(),U(),window.addEventListener("resize",J)}),(0,l.hi)(()=>{window.removeEventListener("resize",J)}),(a,t)=>{const o=(0,l.g2)("el-alert"),i=(0,l.g2)("el-icon"),r=(0,l.g2)("el-input"),$=(0,l.g2)("el-form-item"),U=(0,l.g2)("el-switch"),j=(0,l.g2)("el-input-number"),M=(0,l.g2)("el-radio"),G=(0,l.g2)("el-radio-group"),J=(0,l.g2)("el-date-picker"),B=(0,l.g2)("el-time-picker"),Q=(0,l.g2)("el-checkbox"),H=(0,l.g2)("el-checkbox-group"),Y=(0,l.g2)("el-option"),Z=(0,l.g2)("el-select"),ee=(0,l.g2)("el-form"),ae=(0,l.g2)("el-button"),te=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(te,{modelValue:D.value,"onUpdate:modelValue":t[11]||(t[11]=e=>D.value=e),title:"新建推送任务",width:W.value,top:"15vh","close-on-click-modal":!1},{footer:(0,l.k6)(()=>[(0,l.Lk)("span",A,[(0,l.bF)(ae,{onClick:t[10]||(t[10]=e=>D.value=!1)},{default:(0,l.k6)(()=>[...t[28]||(t[28]=[(0,l.eW)("取消",-1)])]),_:1}),(0,l.bF)(ae,{type:"primary",onClick:q},{default:(0,l.k6)(()=>[...t[29]||(t[29]=[(0,l.eW)("创建任务",-1)])]),_:1})])]),default:(0,l.k6)(()=>[(0,l.bF)(o,{type:"warning","show-icon":"",closable:!1,class:"push-warning-banner"},{default:(0,l.k6)(()=>[(0,l.Lk)("span",d,[t[12]||(t[12]=(0,l.eW)("建议单次群发不超过100个目标，支持自动分组推送。",-1)),e.isFromSOP?((0,l.uX)(),(0,l.CE)(l.FK,{key:0},[(0,l.eW)("推荐在【客户管理】中创建任务，支持同时选择好友和群聊进行推送。")],64)):(0,l.Q3)("",!0)])]),_:1}),(0,l.bF)(ee,{model:O.value,"label-width":"100px"},{default:(0,l.k6)(()=>[e.wechatNickname?((0,l.uX)(),(0,l.Wv)($,{key:0,class:"custom-label-form-item"},{label:(0,l.k6)(()=>[(0,l.Lk)("div",v,[(0,l.bF)(i,{class:"label-icon"},{default:(0,l.k6)(()=>[(0,l.bF)((0,n.R1)(c.Avatar))]),_:1}),t[13]||(t[13]=(0,l.Lk)("span",null,"微信账号：",-1))])]),default:(0,l.k6)(()=>[(0,l.Lk)("div",m,[(0,l.bF)(r,{"model-value":e.wechatNickname,readonly:"",placeholder:"未选择微信账号"},null,8,["model-value"])])]),_:1})):(0,l.Q3)("",!0),(0,l.bF)($,{class:"custom-label-form-item"},{label:(0,l.k6)(()=>[(0,l.Lk)("div",p,[(0,l.bF)(i,{class:"label-icon"},{default:(0,l.k6)(()=>[(0,l.bF)((0,n.R1)(c.Files))]),_:1}),t[14]||(t[14]=(0,l.Lk)("span",null,"自动分组：",-1))])]),default:(0,l.k6)(()=>[(0,l.Lk)("div",g,[(0,l.Lk)("div",k,[(0,l.bF)(U,{modelValue:O.value.autoGrouping,"onUpdate:modelValue":t[0]||(t[0]=e=>O.value.autoGrouping=e),"active-text":"开启","inactive-text":"关闭"},null,8,["modelValue"]),O.value.autoGrouping?((0,l.uX)(),(0,l.CE)("div",h,[t[15]||(t[15]=(0,l.Lk)("span",{class:"grouping-label"},"每组人数：",-1)),(0,l.bF)(j,{modelValue:O.value.batchSize,"onUpdate:modelValue":t[1]||(t[1]=e=>O.value.batchSize=e),min:2,max:500,step:1,size:"small","controls-position":"right"},null,8,["modelValue"])])):(0,l.Q3)("",!0)]),O.value.autoGrouping?((0,l.uX)(),(0,l.CE)("div",f," 将大任务拆分为多个小任务执行，避免长时间占用资源，支持任务插队。 ")):(0,l.Q3)("",!0)])]),_:1}),(0,l.bF)($,{class:"custom-label-form-item"},{label:(0,l.k6)(()=>[(0,l.Lk)("div",y,[(0,l.bF)(i,{class:"label-icon"},{default:(0,l.k6)(()=>[(0,l.bF)((0,n.R1)(c.Clock))]),_:1}),t[16]||(t[16]=(0,l.Lk)("span",null,"发送时间：",-1))])]),default:(0,l.k6)(()=>[(0,l.Lk)("div",b,[(0,l.bF)(G,{modelValue:O.value.timeType,"onUpdate:modelValue":t[2]||(t[2]=e=>O.value.timeType=e)},{default:(0,l.k6)(()=>[(0,l.bF)(M,{label:"now"},{default:(0,l.k6)(()=>[...t[17]||(t[17]=[(0,l.eW)("立即发送",-1)])]),_:1}),(0,l.bF)(M,{label:"schedule"},{default:(0,l.k6)(()=>[...t[18]||(t[18]=[(0,l.eW)("定时发送",-1)])]),_:1})]),_:1},8,["modelValue"])])]),_:1}),"schedule"===O.value.timeType?((0,l.uX)(),(0,l.Wv)($,{key:1,class:"custom-label-form-item"},{label:(0,l.k6)(()=>[(0,l.Lk)("div",_,[(0,l.bF)(i,{class:"label-icon"},{default:(0,l.k6)(()=>[(0,l.bF)((0,n.R1)(c.Calendar))]),_:1}),t[19]||(t[19]=(0,l.Lk)("span",null,"选择日期：",-1))])]),default:(0,l.k6)(()=>[(0,l.Lk)("div",w,[(0,l.bF)(J,{modelValue:O.value.scheduleDate,"onUpdate:modelValue":t[3]||(t[3]=e=>O.value.scheduleDate=e),type:"date",placeholder:"选择日期",format:"YYYY/MM/DD","disabled-date":N,class:"date-picker",locale:(0,n.R1)(u.A)},null,8,["modelValue","locale"]),(0,l.bF)(B,{modelValue:O.value.time,"onUpdate:modelValue":t[4]||(t[4]=e=>O.value.time=e),format:"HH:mm",placeholder:"选择时间",class:"time-picker","default-time":new Date(2e3,1,1,(new Date).getHours(),(new Date).getMinutes()),onChange:z,locale:(0,n.R1)(u.A)},null,8,["modelValue","default-time","locale"])])]),_:1})):(0,l.Q3)("",!0),e.selectedFriends.length>0||e.selectedGroups.length>0?((0,l.uX)(),(0,l.Wv)($,{key:2,class:"custom-label-form-item"},{label:(0,l.k6)(()=>[(0,l.Lk)("div",L,[(0,l.bF)(i,{class:"label-icon"},{default:(0,l.k6)(()=>[(0,l.bF)((0,n.R1)(c.User))]),_:1}),t[20]||(t[20]=(0,l.Lk)("span",null,"推送对象：",-1))])]),default:(0,l.k6)(()=>[(0,l.Lk)("div",F,[(0,l.Lk)("div",C,(0,s.v_)(S.value),1)])]),_:1})):((0,l.uX)(),(0,l.Wv)($,{key:3,class:"custom-label-form-item"},{label:(0,l.k6)(()=>[(0,l.Lk)("div",E,[(0,l.bF)(i,{class:"label-icon"},{default:(0,l.k6)(()=>[(0,l.bF)((0,n.R1)(c.PriceTag))]),_:1}),t[21]||(t[21]=(0,l.Lk)("span",null,"好友标签：",-1))])]),default:(0,l.k6)(()=>[(0,l.Lk)("div",I,[(0,l.bF)(H,{modelValue:O.value.tagIds,"onUpdate:modelValue":t[5]||(t[5]=e=>O.value.tagIds=e)},{default:(0,l.k6)(()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(P.value,e=>((0,l.uX)(),(0,l.Wv)(Q,{key:e.id,label:e.id},{default:(0,l.k6)(()=>[(0,l.eW)((0,s.v_)(e.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])])]),_:1})),(0,l.bF)($,{class:"custom-label-form-item last-form-item"},{label:(0,l.k6)(()=>[(0,l.Lk)("div",R,[(0,l.bF)(i,{class:"label-icon"},{default:(0,l.k6)(()=>[(0,l.bF)((0,n.R1)(c.ChatLineRound))]),_:1}),t[22]||(t[22]=(0,l.Lk)("span",null,"激活话术：",-1))])]),default:(0,l.k6)(()=>[(0,l.Lk)("div",T,[(0,l.bF)(G,{modelValue:O.value.contentType,"onUpdate:modelValue":t[6]||(t[6]=e=>O.value.contentType=e),class:"content-type-radio"},{default:(0,l.k6)(()=>[(0,l.bF)(M,{label:"greeting"},{default:(0,l.k6)(()=>[...t[23]||(t[23]=[(0,l.eW)("话术组",-1)])]),_:1})]),_:1},8,["modelValue"]),"greeting"===O.value.contentType?((0,l.uX)(),(0,l.Wv)(Z,{key:0,modelValue:O.value.greetingGroupId,"onUpdate:modelValue":t[7]||(t[7]=e=>O.value.greetingGroupId=e),placeholder:"选择话术组",class:"select-full-width"},{default:(0,l.k6)(()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(K.value,e=>((0,l.uX)(),(0,l.Wv)(Y,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):((0,l.uX)(),(0,l.Wv)(Z,{key:1,modelValue:O.value.agentId,"onUpdate:modelValue":t[8]||(t[8]=e=>O.value.agentId=e),placeholder:"选择智能体",class:"select-full-width"},{default:(0,l.k6)(()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(X.value,e=>((0,l.uX)(),(0,l.Wv)(Y,{key:e.botId,label:e.name,value:e.botId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]))])]),_:1}),(0,l.bF)($,{class:"custom-label-form-item"},{label:(0,l.k6)(()=>[(0,l.Lk)("div",V,[(0,l.bF)(i,{class:"label-icon"},{default:(0,l.k6)(()=>[(0,l.bF)((0,n.R1)(c.Clock))]),_:1}),t[24]||(t[24]=(0,l.Lk)("span",null,"发送间隔：",-1))])]),default:(0,l.k6)(()=>[(0,l.Lk)("div",x,[(0,l.bF)(G,{modelValue:O.value.sendInterval,"onUpdate:modelValue":t[9]||(t[9]=e=>O.value.sendInterval=e)},{default:(0,l.k6)(()=>[(0,l.bF)(M,{label:"3-8"},{default:(0,l.k6)(()=>[...t[25]||(t[25]=[(0,l.eW)("3-8秒",-1)])]),_:1}),(0,l.bF)(M,{label:"10-30"},{default:(0,l.k6)(()=>[...t[26]||(t[26]=[(0,l.eW)("10-30秒",-1)])]),_:1}),(0,l.bF)(M,{label:"30-60"},{default:(0,l.k6)(()=>[...t[27]||(t[27]=[(0,l.eW)("30-60秒",-1)])]),_:1})]),_:1},8,["modelValue"])])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","width"])}}});var S=t(1241);const K=(0,S.A)(W,[["__scopeId","data-v-2e18a8b8"]]),X=K},5142(e,a,t){t.d(a,{JR:()=>l,b3:()=>n,ql:()=>s,zj:()=>o});const l=window.location.origin,n={"Content-Type":"application/json",Accept:"application/json","X-API-Key":"yoko_test"},s=async(e,a)=>{try{console.debug("正在保存配置:",e,a);const t=await fetch(`${l}/api/config/${e}`,{method:"POST",headers:{...n,"Content-Type":"application/json"},body:JSON.stringify(a),credentials:"include"});if(!t.ok){const e=await t.text();throw console.error("服务器响应:",{status:t.status,statusText:t.statusText,body:e}),new Error(`服务器错误 (${t.status}): ${e||t.statusText}`)}const s=await t.json();if(console.debug("保存配置响应:",s),!s.success)throw new Error(s.error||"保存失败");return s}catch(t){if(console.error("保存配置失败:",t),t instanceof Error)throw new Error(`保存失败: ${t.message}`);throw t}},o=async e=>{try{const a=await fetch(`${l}/api/config/${e}`);return await a.json()}catch(a){throw console.error("获取配置失败:",a),a}}},5826(e,a,t){t.d(a,{Fm:()=>f,HW:()=>h,MB:()=>i,Or:()=>v,PD:()=>o,Qj:()=>m,VO:()=>u,_Q:()=>d,hE:()=>k,kz:()=>g,oZ:()=>s,ps:()=>n,qg:()=>r,qh:()=>p,xI:()=>c});var l=t(5142);const n=async(e,a)=>{try{const t=await fetch(`${l.JR}/api/version/check`,{method:"POST",headers:{...l.b3,"Content-Type":"application/json"},body:JSON.stringify({current_version:e,agent_id:a})});return await t.json()}catch(t){throw console.error("检查版本失败:",t),t}},s=async()=>{try{const e=await fetch(`${l.JR}/api/config/version_notify`);return await e.json()}catch(e){throw console.error("获取版本通知配置失败:",e),e}},o=async e=>{try{const a=await fetch(`${l.JR}/api/config/version_notify`,{method:"POST",headers:{...l.b3,"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"});return await a.json()}catch(a){throw console.error("保存版本通知配置失败:",a),a}},i=async(e,a)=>{try{const t=await fetch(`${l.JR}/api/version/download`,{method:"POST",headers:{...l.b3,"Content-Type":"application/json"},body:JSON.stringify({current_version:e,agent_id:a})});return await t.json()}catch(t){throw console.error("下载更新失败:",t),t}},r=async e=>{try{const a=e?JSON.stringify({instance_id:e}):"{}",t=await fetch(`${l.JR}/api/reconnect`,{method:"POST",headers:{"Content-Type":"application/json"},body:a});return await t.json()}catch(a){return console.error("重连失败:",a),{success:!1,error:"网络请求失败"}}},c=async()=>{try{const e=await fetch(`${l.JR}/api/init/multi`,{method:"POST",headers:{...l.b3,"Content-Type":"application/json"},mode:"cors",credentials:"include",body:JSON.stringify({timestamp:Date.now()})});if(!e.ok){const a=await e.json().catch(()=>({detail:"初始化多微信失败"}));throw new Error(a.detail||"初始化多微信失败")}const a=await e.json();return console.debug("多微信初始化响应:",a),a}catch(e){throw console.error("初始化多微信失败:",e),e}},u=async()=>{try{const e=await fetch(`${l.JR}/api/system/wechat41/auto_config`,{method:"POST",headers:{...l.b3,"Content-Type":"application/json"},credentials:"include"});return await e.json()}catch(e){return console.error("自动配置失败:",e),{success:!1,message:"自动配置失败"}}},d=async()=>{try{const e=await fetch(`${l.JR}/api/system/narrator/stop`,{method:"POST",headers:{...l.b3,"Content-Type":"application/json"},credentials:"include"});return await e.json()}catch(e){return console.error("退出讲述人失败:",e),{success:!1,message:"退出讲述人失败"}}},v=async()=>{try{const e=await fetch(`${l.JR}/api/instances`,{headers:l.b3});if(!e.ok){const a=await e.json();throw new Error(a.detail||"获取实例信息失败")}return await e.json()}catch(e){throw console.error("获取实例信息失败:",e),e}},m=async e=>{try{const a=await fetch(`${l.JR}/api/instances/switch`,{method:"POST",headers:{...l.b3,"Content-Type":"application/json"},body:JSON.stringify({instance_id:e})});if(!a.ok){const e=await a.json();throw new Error(e.detail||"切换实例失败")}return await a.json()}catch(a){throw console.error("切换实例失败:",a),a}},p=async()=>{try{const e=await fetch(`${l.JR}/api/license/info`,{headers:l.b3});return await e.json()}catch(e){throw console.error("获取授权信息失败:",e),e}},g=async e=>{try{const a=await fetch(`${l.JR}/api/license/unbind`,{method:"POST",headers:{...l.b3,"Content-Type":"application/json"},body:JSON.stringify({activation_code:e})});return await a.json()}catch(a){throw console.error("解绑失败:",a),a}},k=async()=>{try{const e=await fetch(`${l.JR}/api/connection/status`,{headers:l.b3});if(!e.ok){const a=await e.json();throw new Error(a.detail||"检查连接状态失败")}return await e.json()}catch(e){throw console.error("检查连接状态失败:",e),e}},h=async()=>{try{const e=await fetch(`${l.JR}/api/user/current`,{headers:l.b3});if(!e.ok){const a=await e.json();throw new Error(a.detail||"获取用户信息失败")}const a=await e.json();return console.debug("用户信息:",a),a}catch(e){throw console.error("获取用户信息失败:",e),e}},f=async()=>{try{const e=await fetch(`${l.JR}/api/time/authority`,{method:"GET",headers:l.b3});return await e.json()}catch(e){throw console.error("获取服务器时间失败:",e),e}}},6297(e,a,t){t.d(a,{A:()=>x});var l=t(6768),n=t(144);const s="default",o={default:{channel_id:"channel_000001",name:"YokoAI机器人",ename:"YokoAIbot",logo:"./img/logo.jpg",contact:"扫描二维码添加专属客服微信",contactType:"qrcode",qrcodeUrl:"https://healthyeveryday.oss-cn-shanghai.aliyuncs.com/yokoai/yokobot_img/yoko_kefu.png",copyright:"YokoAI@2026 by 上海蒲兰科技"},channel_ailink:{channel_id:"channel_000041",name:"AiLink机器人",ename:"AiLinkBot",logo:"./img/ailink_logo.jpg",contact:"扫描二维码添加专属客服微信",contactType:"qrcode",qrcodeUrl:"https://healthyeveryday.oss-cn-shanghai.aliyuncs.com/yokoai/yokobot_img/ailink_kefu.jpg"},channel_moji:{channel_id:"channel_000040",name:"魔吉",ename:"Moji",logo:"./img/moji_logo.png",contact:"扫描二维码添加专属客服微信",contactType:"qrcode",qrcodeUrl:"https://healthyeveryday.oss-cn-shanghai.aliyuncs.com/yokoai/yokobot_img/moji_kefu.png"},channel_vanta:{channel_id:"channel_000039",name:"V神AI智慧获客",ename:"Vanta",logo:"./img/vanta_logo.jpg",contact:"345051813@qq.com"},channel_xiaoxin:{channel_id:"channel_000038",name:"小新AI点评系统",ename:"XiaoxinAIbot",logo:"./img/xiaoxin_logo.png",contact:"212575@qq.com"},channel_zoyu:{channel_id:"channel_000037",name:"智享优圈AI机器人",ename:"ZOYUAIbot",logo:"./img/zxyq_logo.png",contact:"扫描二维码添加专属客服微信",contactType:"qrcode",qrcodeUrl:"https://healthyeveryday.oss-cn-shanghai.aliyuncs.com/yokoai/yokobot_img/zoyu_kefu.jpg"},channel_interstellar:{channel_id:"channel_000036",name:"星际云 Ai",ename:"Interstellar Cloud",logo:"./img/interstellar_logo.jpg",contact:"扫描二维码添加专属客服微信",contactType:"qrcode",qrcodeUrl:"https://healthyeveryday.oss-cn-shanghai.aliyuncs.com/yokoai/yokobot_img/inter_kefu.jpg"},channel_healo:{channel_id:"channel_000035",name:"HealoAI销冠",ename:"HealoAIbot",logo:"./img/healo_logo.png",contact:"2634337479@qq.com"},channel_xipapa:{channel_id:"channel_000034",name:"喜啪啪",ename:"XIPAPA",logo:"./img/xipapa_logo.png",contact:"3672480844@qq.com"},channel_yunt:{channel_id:"channel_000033",name:"yun机器人",ename:"yunAIbot",logo:"./img/yunt_logo.png",contact:"扫描二维码添加专属客服微信",contactType:"qrcode",qrcodeUrl:"https://healthyeveryday.oss-cn-shanghai.aliyuncs.com/yokoai/yokobot_img/yunt_kefu.png"},channel_ycat:{channel_id:"channel_000032",name:"小馋猫AI机器人",ename:"YCatAIbot",logo:"./img/ycat_logo.jpg",contact:"扫描二维码添加专属客服微信",contactType:"qrcode",qrcodeUrl:"https://healthyeveryday.oss-cn-shanghai.aliyuncs.com/yokoai/yokobot_img/ycat_kefu.png"},channel_nutri:{channel_id:"channel_000031",name:"谆医营养师AI分身",ename:"Z-NutriAIA",logo:"./img/nutri_logo.png",contact:"hrcai@126.com"},channel_wsy:{channel_id:"channel_000030",name:"微三云客服",ename:"wsykf",logo:"./img/wsy_logo.jpg",contact:"扫描二维码添加专属客服微信",contactType:"qrcode",qrcodeUrl:"https://healthyeveryday.oss-cn-shanghai.aliyuncs.com/yokoai/yokobot_img/wsy_kefu.png"},channel_ruixiao:{channel_id:"channel_000029",name:"睿销云",ename:"Ruixiao Cloud",logo:"./img/ruixiao_logo.jpg",contact:"扫描二维码添加专属客服微信",contactType:"qrcode",qrcodeUrl:"https://healthyeveryday.oss-cn-shanghai.aliyuncs.com/yokoai/yokobot_img/ruixiao_kefu.png"},channel_lichuang:{channel_id:"channel_000028",name:"荔创AI机器人",ename:"LICHUANGAI",logo:"./img/lichuang_logo.png",contact:"2390016326@qq.com"},channel_refresh:{channel_id:"channel_000027",name:"焕旅AI 智能体",ename:"RefreshAI Agent",logo:"./img/refresh_logo.jpeg",contact:"Service@Refreshtour.com",copyright:"RefreshAi@2025 by 上海焕旅科技"},channel_tange:{channel_id:"channel_000026",name:"谈哥AI机器人",ename:"TangeAIbot",logo:"./img/logo_tange.png",contact:"2463691166@qq.com"},channel_aiboss:{channel_id:"channel_000025",name:"矩阵盾",ename:"Dun Pro",logo:"./img/logo_aiboss.png",contact:"31350072@qq.com"},channel_relaxai:{channel_id:"channel_000023",name:"轻松Ai",ename:"RelaxAi",logo:"./img/relax_logo.png",contact:"service@relaxai.cn"},channel_yysay:{channel_id:"channel_000024",name:"有鱼智客",ename:"yysayAI",logo:"./img/yysay_logo.png",contact:"扫描二维码添加专属客服企业微信",contactType:"qrcode",qrcodeUrl:"https://healthyeveryday.oss-cn-shanghai.aliyuncs.com/yokoai/yokobot_img/yysay_kefu.png"},channel_xlc:{channel_id:"channel_000022",name:"小懒虫AI机器人",ename:"小懒虫AI机器人",logo:"./img/xlc_logo.png",contact:"403298000@qq.com"},channel_Ant:{channel_id:"channel_000021",name:"蚂蚁AI机器人",ename:"AntAIbot",logo:"./img/ant_logo.png",contact:"3236602296@qq.com",copyright:"AntAI@2025 by 厦门极昼科技"},channel_stan:{channel_id:"channel_000020",name:"省探AI销售机器人",ename:"STAibot",logo:"./img/stan_logo.png",contact:"929944920@qq.com",copyright:"STAibot@2025 by 省探（云南）科技有限公司"},channel_linkc:{channel_id:"channel_000019",name:"灵宸AI",ename:"灵宸智能",logo:"./img/linkc_logo.png",contact:"qq：22528142",copyright:"灵宸AI@2025 by 贵州灵宸人工智能科技"},channel_astrai:{channel_id:"channel_000018",name:"Astra机器人",ename:"Astrai",logo:"./img/astra_logo.png",contact:"876560060@qq.com"},channel_xiaoxiao:{channel_id:"channel_000017",name:"肖肖AI机器人",ename:"肖肖AIBot",logo:"./img/xiaoxiao_logo.png",contact:"momobaby_2023(微信)"},channel_xw:{channel_id:"channel_000015",name:"星梧 AIBot",ename:"XWKJ AIBot",logo:"./img/xw_logo.png",contact:"i62417"},channel_dacore:{channel_id:"channel_000016",name:"大可AI金牌销售系统",ename:"Da Core",logo:"./img/dacore_logo.png",contact:"dd2211999（微信）"},channel_yun:{channel_id:"channel_000005",name:"云视界机器人",ename:"yunwebot",logo:"./img/yun_logo.png",contact:"18925982768"},channel_wanxiao:{channel_id:"channel_000014",name:"万校互联",ename:"All Schools Connect",logo:"./img/wanxiao_logo.png",contact:"wxhl6688@163.com"},channel_zhipu:{channel_id:"channel_000013",name:"知普AI机器人",ename:"ZhipuAI",logo:"./img/zhipu_logo.png",contact:"lhg20290@nudt.edu.com"},channel_atom:{channel_id:"channel_000012",name:"AtomAI机器人",ename:"AtomAIbot",logo:"./img/atom_logo.png",contact:"591905097@qq.com"},channel_shaozi:{channel_id:"channel_000010",name:"勺子AI-数智员工",ename:"ShaoziAI-Bot",logo:"./img/shaozi_logo.png",contact:"微信XM2222925"},channel_xlai:{channel_id:"channel_000011",name:"星链AI销冠",ename:"XLAI Sales Champion",logo:"./img/xlai_logo.png",contact:"400-6685-139"},channel_anlun:{channel_id:"channel_000006",name:"安伦科技",ename:"Anlunai",logo:"./img/anlun_logo.png",contact:"19128689489"},channel_busi:{channel_id:"channel_000007",name:"BusiAi智能客服",ename:"BusiAIbot",logo:"./img/busi_logo.jpg",contact:"641460330@qq.com"},channel_super:{channel_id:"channel_000008",name:"销冠AI助理",ename:"畜牧军火库★销冠AI助理",alias:"畜牧军火库★销冠AI助理",logo:"./img/super_logo.jpg",contact:"328441536@qq.com"},channel_allwise:{channel_id:"channel_000009",name:"ALLWISE AI机器人",ename:"ALLWISE AIbot",logo:"./img/alws_logo.jpg",contact:"allwiseai"},channel_xunyi:{channel_id:"channel_000003",name:"潘军师机器人",ename:"PanAibot",logo:"./img/XUNYI_logo.png",contact:"15977004390"},channel_aiok:{channel_id:"channel_000002",name:"AI数字员工",ename:"AIOK",logo:"./img/aiok_logo.png",contact:"AIOK"}};function i(){const e=localStorage.getItem("channel")||s;return o[e]||o.default}var r=t(8728),c=t(5130),u=t(4232),d=t(3957),v=t(7394);const m={class:"logo-container"},p=["src","alt"],g={class:"app-name"},k={class:"menu-container"},h=(0,l.pM)({__name:"NavBar",setup(e){(0,c.$9)(e=>({d7423eaa:h.value,v16bc08d3:i.value}));const a=(0,d.J)(),t=(0,v.C)(),s=(0,n.KR)(window.innerWidth),o=()=>{s.value=window.innerWidth};(0,l.sV)(()=>{window.addEventListener("resize",o),b.afterEach(e=>{_.value=e.path.substring(1)||"welcome"})}),(0,l.hi)(()=>{window.removeEventListener("resize",o)});(0,l.EW)(()=>{const e=t.currentTheme,a=e.primary,l=C(a,.15);return`linear-gradient(90deg, ${a}, ${l})`});const i=(0,l.EW)(()=>t.currentTheme.menuHoverBackground),h=(0,l.EW)(()=>t.currentTheme.primary),f=((0,l.EW)(()=>t.currentTheme.primary),(0,l.EW)(()=>t.currentTheme.menuTextColor),(0,l.WQ)("brandConfig",{channel_id:"channel_000001",name:"YokoAI机器人",ename:"YokoAIbot",logo:"/assets/logo.png",contact:"473726474@qq.com"})),y=(0,r.lq)(),b=(0,r.rd)(),_=(0,n.KR)(y.path.substring(1)||"welcome"),w=e=>{b.push(`/${e}`)};function L(e){const a=e.replace("#",""),t=parseInt(3===a.length?a[0]+a[0]:a.slice(0,2),16),l=parseInt(3===a.length?a[1]+a[1]:a.slice(2,4),16),n=parseInt(3===a.length?a[2]+a[2]:a.slice(4,6),16);return{r:t,g:l,b:n}}function F(e,a,t){const l=e=>e.toString(16).padStart(2,"0");return`#${l(e)}${l(a)}${l(t)}`}function C(e,a){const{r:t,g:l,b:n}=L(e),s=Math.round(t+(255-t)*a),o=Math.round(l+(255-l)*a),i=Math.round(n+(255-n)*a);return F(s,o,i)}return(e,s)=>{const o=(0,l.g2)("el-menu-item"),i=(0,l.g2)("el-menu");return(0,l.uX)(),(0,l.Wv)(c.eB,{name:"nav-slide"},{default:(0,l.k6)(()=>[(0,n.R1)(a).isLoaded?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"nav-wrapper",style:(0,u.Tr)({backgroundColor:(0,n.R1)(a).config.theme.primary})},[(0,l.Lk)("div",m,[(0,l.Lk)("img",{src:(0,n.R1)(f).logo,alt:(0,n.R1)(f).name,class:"logo-image"},null,8,p),(0,l.Lk)("span",g,(0,u.v_)((0,n.R1)(f).name),1)]),(0,l.Lk)("div",k,[(0,l.bF)(i,{"default-active":_.value,class:"nav-menu",mode:"horizontal",onSelect:w,"background-color":"transparent","text-color":(0,n.R1)(t).currentTheme.menuTextColor,"active-text-color":(0,n.R1)(t).currentTheme.menuActiveTextColor,ellipsis:!0},{default:(0,l.k6)(()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)((0,n.R1)(a).config.navbar.items,e=>((0,l.uX)(),(0,l.Wv)(o,{key:e.index,index:e.index},{default:(0,l.k6)(()=>[(0,l.eW)((0,u.v_)(e.text),1)]),_:2},1032,["index"]))),128))]),_:1},8,["default-active","text-color","active-text-color"])])],4)):(0,l.Q3)("",!0)]),_:1})}}});var f=t(1241);const y=(0,f.A)(h,[["__scopeId","data-v-4434b42a"]]),b=y;var _=t(1219),w=t(5826);const L={class:"reconnect-content"},F={class:"dialog-footer"},C=(0,l.pM)({__name:"ReconnectDialog",setup(e,{expose:a}){const t=(0,n.KR)(!1),s=(0,n.KR)(!1),o=async()=>{s.value=!0;try{const e=await(0,w.qg)();e.success?(_.nk.success("已重新连接"),t.value=!1):_.nk.error(e.message||"重新连接失败")}catch(e){_.nk.error("重新连接失败")}finally{s.value=!1}};return a({show:()=>t.value=!0}),(e,a)=>{const n=(0,l.g2)("el-alert"),i=(0,l.g2)("el-button"),r=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(r,{modelValue:t.value,"onUpdate:modelValue":a[0]||(a[0]=e=>t.value=e),title:"连接已断开","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,width:"30%"},{footer:(0,l.k6)(()=>[(0,l.Lk)("span",F,[(0,l.bF)(i,{type:"primary",onClick:o,loading:s.value},{default:(0,l.k6)(()=>[(0,l.eW)((0,u.v_)(s.value?"重新连接中...":"重新连接"),1)]),_:1},8,["loading"])])]),default:(0,l.k6)(()=>[(0,l.Lk)("div",L,[(0,l.bF)(n,{type:"warning",closable:!1,"show-icon":""},{default:(0,l.k6)(()=>[...a[1]||(a[1]=[(0,l.eW)(" 您已掉线，请重新连接 ",-1)])]),_:1})])]),_:1},8,["modelValue"])}}}),E=(0,f.A)(C,[["__scopeId","data-v-301bcd34"]]),I=E,R={class:"app-container"},T=(0,l.pM)({__name:"App",setup(e){const a=(0,r.lq)(),t=(0,l.EW)(()=>"StartupPage"===a.name),s=(0,l.EW)(()=>a.path.startsWith("/agent")||a.path.includes("dashboard")),o=(0,n.KR)(),c=(0,n.KR)(i());(0,l.Gt)("brandConfig",c);const u=()=>{o.value?.show()};return(0,l.qG)((e,a,t)=>(console.error("Vue 错误:",e),console.log("错误组件:",a),console.log("错误信息:",t),!1)),(0,l.Gt)("showReconnectDialog",u),(0,l.Gt)("brandConfig",c),(e,a)=>{const n=(0,l.g2)("router-view");return(0,l.uX)(),(0,l.CE)("div",R,[t.value||s.value?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(b,{key:0})),(0,l.bF)(n,null,{default:(0,l.k6)(({Component:e})=>[((0,l.uX)(),(0,l.Wv)((0,l.$y)(e),{class:"main-content"}))]),_:1}),(0,l.bF)(I,{ref_key:"reconnectDialog",ref:o},null,512)])}}}),V=T,x=V},7394(e,a,t){t.d(a,{C:()=>i});var l=t(2261),n=t(6768),s=t(144),o=t(3957);const i=(0,l.nY)("theme",()=>{const e=(0,o.J)(),a=(0,n.EW)(()=>e.config.theme),t=(0,s.KR)(!1),l=(0,n.EW)(()=>a.value.gradientStart||a.value.primary),i=(0,n.EW)(()=>a.value.gradientEnd||u(a.value.primary,.15)),c=(0,n.EW)(()=>{const e=a.value,t=r(e.primary),n=`rgba(${t.r}, ${t.g}, ${t.b}, 0.5)`,s=d(e.primary,.08);return{"--theme-primary":e.primary,"--menu-background":e.menuBackground,"--menu-text-color":e.menuTextColor,"--menu-active-text-color":e.menuActiveTextColor,"--menu-hover-background":e.menuHoverBackground,"--theme-gradient-start":l.value,"--theme-gradient-end":i.value,"--el-bg-color-overlay":e.primary,"--theme-primary-50":n,"--theme-primary-hover":s}}),v=()=>{const e=document.documentElement;Object.entries(c.value).forEach(([a,t])=>{e.style.setProperty(a,t)})},m=()=>{t.value||(v(),t.value=!0)};return{currentTheme:a,isInitialized:t,cssVariables:c,initTheme:m,applyTheme:v}});function r(e){const a=e.replace("#",""),t=parseInt(3===a.length?a[0]+a[0]:a.slice(0,2),16),l=parseInt(3===a.length?a[1]+a[1]:a.slice(2,4),16),n=parseInt(3===a.length?a[2]+a[2]:a.slice(4,6),16);return{r:t,g:l,b:n}}function c(e,a,t){const l=e=>e.toString(16).padStart(2,"0");return`#${l(e)}${l(a)}${l(t)}`}function u(e,a){const{r:t,g:l,b:n}=r(e),s=Math.round(t+(255-t)*a),o=Math.round(l+(255-l)*a),i=Math.round(n+(255-n)*a);return c(s,o,i)}function d(e,a){const{r:t,g:l,b:n}=r(e),s=Math.round(t*(1-a)),o=Math.round(l*(1-a)),i=Math.round(n*(1-a));return c(s,o,i)}},8761(e,a,t){t.d(a,{A2:()=>I,DT:()=>C,Gc:()=>o,H8:()=>y,M5:()=>m,MV:()=>h,N2:()=>g,OV:()=>i,QM:()=>n,S6:()=>L,UV:()=>w,WA:()=>E,WS:()=>_,Y8:()=>b,ZD:()=>d,Zs:()=>k,_t:()=>c,ky:()=>r,l6:()=>F,lG:()=>f,pW:()=>s,rY:()=>v,uV:()=>p,zL:()=>u});var l=t(5142);const n=async e=>{try{const a=104857600;if(e.size>a)throw new Error("文件大小不能超过100MB");const t=new FormData;t.append("file",e);const n=await fetch(`${l.JR}/api/file/upload`,{method:"POST",headers:{"X-API-Key":l.b3["X-API-Key"]},body:t}),s=await n.json();if(!n.ok||!s.success)throw new Error(s.error||s.detail||"上传失败");return s.data}catch(a){throw console.error("文件上传失败:",a),a instanceof Error?a:new Error("未知错误")}},s=async()=>{try{const e=await fetch(`${l.JR}/api/tasks/logs`,{method:"GET",headers:{...l.b3,"Content-Type":"application/json"}}),a=await e.json();if(!a.success)throw new Error(a.error||"获取任务日志失败");return a.data}catch(e){throw console.error("获取任务日志失败:",e),e instanceof Error?e:new Error("未知错误")}},o=async e=>{try{const a=await fetch(`${l.JR}/api/tasks/mass-sending`,{method:"POST",headers:{...l.b3,"Content-Type":"application/json"},body:JSON.stringify(e)}),t=await a.json();if(!a.ok)throw new Error(t.error||t.detail||"服务器错误");if(console.debug("群发任务创建结果：",t),!t.success)throw new Error(t.error||"创建任务失败");return t.data}catch(a){throw console.error("创建群发任务失败:",a),a instanceof Error?a:new Error("未知错误")}},i=async e=>{try{const a=await fetch(`${l.JR}/api/tasks/mass-sending/${e}/cancel`,{method:"POST",headers:{...l.b3,"Content-Type":"application/json"}}),t=await a.json();if(!t.success)throw new Error(t.error);return t}catch(a){throw console.error("取消群发任务失败:",a),a instanceof Error?a:new Error("未知错误")}},r=async()=>{try{const e=await fetch(`${l.JR}/api/tasks/mass-sending/cancel-all`,{method:"POST",headers:{...l.b3,"Content-Type":"application/json"}}),a=await e.json();if(!a.success)throw new Error(a.error);return a}catch(e){throw console.error("批量取消群发任务失败:",e),e instanceof Error?e:new Error("未知错误")}},c=async()=>{try{const e=await fetch(`${l.JR}/api/tasks/mass-sending`,{headers:l.b3}),a=await e.json();if(!a.success)throw new Error(a.error||"获取任务列表失败");return a}catch(e){throw console.error("获取群发任务列表失败:",e),e instanceof Error?e:new Error("未知错误")}},u=async(e,a)=>{try{const t=await fetch(`${l.JR}/api/tasks/friend-request/toggle`,{method:"POST",headers:{...l.b3,"Content-Type":"application/json"},body:JSON.stringify({enabled:e,maxFriendsPerDay:a.maxFriendsPerDay,maxProcessPerTime:a.maxProcessPerTime,tag:a.tag,targetGroup:a.targetGroup,greetingGroupId:a.greetingGroupId,checkInterval:a.checkInterval})}),n=await t.json();if(!n.success)throw new Error(n.error);return n}catch(t){throw console.error("切换自动通过好友失败:",t),t instanceof Error?t:new Error("未知错误")}},d=async(e,a)=>{try{const t=await fetch(`${l.JR}/api/moment/toggle-auto-comment`,{method:"POST",headers:{...l.b3,"Content-Type":"application/json"},body:JSON.stringify({...a,enabled:e})}),n=await t.json();if(!n.success)throw new Error(n.error);return n}catch(t){throw console.error("切换自动评论失败:",t),t instanceof Error?t:new Error("未知错误")}},v=async()=>{try{const e=await fetch(`${l.JR}/api/tasks/friend-request/logs`,{method:"GET",headers:l.b3}),a=await e.json();if(!a.success)throw new Error(a.error);return a.data}catch(e){throw console.error("获取好友请求日志失败:",e),e instanceof Error?e:new Error("未知错误")}},m=async e=>{try{const a=new FormData;a.append("file",e);const t=await fetch(`${l.JR}/api/friend/import`,{method:"POST",headers:{"X-API-Key":l.b3["X-API-Key"]},body:a}),n=await t.json();if(!t.ok)throw new Error(n.detail||"导入失败");return{success:!0,count:n.count,remaining:n.remaining}}catch(a){throw console.error("导入好友名单失败:",a),a instanceof Error?a:new Error("未知错误")}},p=async e=>{try{const a=await fetch(`${l.JR}/api/friend/import-by-agent`,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":l.b3["X-API-Key"]},body:JSON.stringify({agent_id:e})}),t=await a.json();if(console.debug("智能体导入结果：",t),t.needsAuth&&t.authUrl)return{success:!1,count:0,remaining:0,needsAuth:!0,authUrl:t.authUrl};if(!a.ok){const e=t.detail||"导入失败",a=e.match(/https:\/\/open\.feishu\.cn\/open-apis\/authen[^\s"']+/);if(a)return{success:!1,count:0,remaining:0,needsAuth:!0,authUrl:a[0]};throw new Error(e)}return{success:!0,count:t.count,remaining:t.remaining}}catch(a){throw console.error("通过智能体导入名单失败:",a),a instanceof Error?a:new Error("未知错误")}},g=async()=>{try{const e=await fetch(`${l.JR}/api/friend/sync-by-api`,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":l.b3["X-API-Key"]}}),a=await e.json();if(!e.ok)throw new Error(a.detail||a.error||"同步失败");if(!a.success)throw new Error(a.error||"同步失败");return{success:!0,count:a.count||0,remaining:a.remaining||0}}catch(e){throw console.error("通过API同步名单失败:",e),e instanceof Error?e:new Error("未知错误")}},k=async()=>{try{const e=await fetch(`${l.JR}/api/friend/add-logs`,{method:"GET",headers:l.b3}),a=await e.json();if(!a.success)throw new Error(a.error||"获取添加好友日志失败");return a.data}catch(e){throw console.error("获取添加好友日志失败:",e),e instanceof Error?e:new Error("未知错误")}},h=async()=>{try{const e=await fetch(`${l.JR}/api/friend/remaining-count`,{method:"GET",headers:l.b3}),a=await e.json();if(!a.success)throw new Error(a.error||"获取待添加好友数量失败");return{remaining:a.data.remaining,today_added:a.data.today_added||0}}catch(e){throw console.error("获取待添加好友数量失败:",e),e instanceof Error?e:new Error("未知错误")}},f=async(e,a)=>{try{const t=await fetch(`${l.JR}/api/friend/auto-add-new/toggle`,{method:"POST",headers:{...l.b3,"Content-Type":"application/json"},body:JSON.stringify({enabled:e,maxFriendsPerDay:a.maxFriendsPerDay,interval:a.interval,batchSize:a.batchSize,verifyMessage:a.verifyMessage||"",multiCycleEnabled:Boolean(a.multiCycleEnabled),accountIds:Array.isArray(a.selectedAccounts)?a.selectedAccounts:[]})}),n=await t.json();return n}catch(t){throw console.error("切换自动加好友状态失败:",t),t instanceof Error?t:new Error("未知错误")}},y=async()=>{try{const e=await fetch(`${l.JR}/api/friend/list`,{headers:l.b3});return await e.json()}catch(e){throw console.error("获取好友名单失败:",e),e}},b=async e=>{try{const a=await fetch(`${l.JR}/api/friend/list/${e}`,{method:"DELETE",headers:l.b3});return await a.json()}catch(a){throw console.error("删除好友失败:",a),a}},_=async e=>{try{const a=await fetch(`${l.JR}/api/friend/list/batch_delete`,{method:"POST",headers:{...l.b3,"Content-Type":"application/json"},body:JSON.stringify({wxids:e})});return await a.json()}catch(a){throw console.error("批量删除好友失败:",a),a}},w=async(e,a)=>{const t=new URLSearchParams;e&&t.append("status",e),a&&t.append("tag",a);const n=`${l.JR}/api/friend/list/export_path?${t.toString()}`,s=await fetch(n,{headers:l.b3}),o=await s.json();if(!s.ok||!o.success)throw new Error(o.error||o.detail||"导出失败");return o.path},L=async e=>{const a=new URLSearchParams;a.append("path",e),await fetch(`${l.JR}/api/moment-material/open-folder?${a.toString()}`,{method:"GET",headers:l.b3})},F=async e=>{try{const a=await fetch(`${l.JR}/api/tasks/auto-follow/batch`,{method:"POST",headers:{...l.b3,"Content-Type":"application/json"},body:JSON.stringify(e)}),t=await a.json();if(!a.ok)throw new Error(t.error||t.detail||"服务器错误");if(console.debug("批量创建自动跟单任务结果：",t),!t.success)throw new Error(t.error||"创建任务失败");return{success:!0,task_id:t.task_id,...t}}catch(a){throw console.error("批量创建自动跟单任务失败:",a),a instanceof Error?a:new Error("未知错误")}},C=async()=>{try{const e=await fetch(`${l.JR}/api/tasks/auto-follow`,{method:"GET",headers:{...l.b3,"Content-Type":"application/json"}}),a=await e.json();if(console.info("获取自动跟单任务列表结果：",a),!e.ok)throw new Error(a.error||a.detail||"获取任务列表失败");if(!a.success)throw new Error(a.error||"获取任务列表失败");return a.tasks||[]}catch(e){throw console.error("获取自动跟单任务列表失败:",e),e instanceof Error?e:new Error("未知错误")}},E=async e=>{try{const a=await fetch(`${l.JR}/api/tasks/auto-follow/${e}/cancel`,{method:"POST",headers:{...l.b3,"Content-Type":"application/json"}}),t=await a.json();if(!a.ok)throw new Error(t.error||t.detail||"取消任务失败");if(!t.success)throw new Error(t.error||"取消任务失败");return t}catch(a){throw console.error("取消自动跟单任务失败:",a),a instanceof Error?a:new Error("未知错误")}},I=async()=>{try{const e=await fetch(`${l.JR}/api/tasks/auto-follow/logs`,{method:"GET",headers:{...l.b3,"Content-Type":"application/json"}}),a=await e.json();if(!e.ok)throw new Error(a.error||a.detail||"获取执行日志失败");if(!a.success)throw new Error(a.error||"获取执行日志失败");return a.data||[]}catch(e){throw console.error("获取自动跟单执行日志失败:",e),e instanceof Error?e:new Error("未知错误")}}},9048(e,a,t){t.d(a,{A:()=>Zu});var l=t(8728),n=t(6768),s=t(4232),o=t(144),i=t(1219),r=t(7477),c=t(5826);const u={rE:"1.5.9"},d="http://127.0.0.1:9922",v="yoko_test",m={"Content-Type":"application/json","X-API-Key":v},p=async e=>{try{const a=await fetch(`${d}/api/agent/exists?name=${encodeURIComponent(e)}`,{method:"GET",headers:m}),t=await a.json();return t.success&&t.exists}catch(a){return!1}},g={class:"startup-container"},k={class:"card-header"},h={class:"version"},f={class:"startup-content"},y={key:0,class:"startup-progress"},b={class:"progress-text"},_={class:"startup-actions"},w={class:"dialog-header warning"},L={class:"dialog-content"},F={class:"steps-panel"},C={class:"step-text"},E={key:0},I={class:"step-text"},R={key:0},T={class:"step-text"},V={key:0},x={class:"step-text"},A={key:0},W=(0,n.pM)({__name:"StartupPage",setup(e){const a=(0,n.WQ)("brandConfig",{channel_id:"channel_000001",name:"Yoko微信机器人",ename:"YokoAIbot",logo:"/assets/logo.png",contact:"473726474@qq.com"}),t=(0,l.rd)(),d=(0,l.lq)(),v=(0,o.KR)(!1),m=(0,o.KR)(0),W=(0,o.KR)("success"),S=(0,o.KR)(""),K=(0,o.KR)(!1),X=(0,o.KR)(!1),$=(0,o.KR)(null),U=(0,o.KR)(!1),j=(0,o.KR)({1:"pending",2:"pending",3:"pending",4:"pending"}),D=(e,a)=>{m.value=e,S.value=a};(0,n.sV)(async()=>{const e=d.query.agent;if(e){$.value=e;const a=await p(e);a&&N()}});const P=async()=>{if(!v.value)try{v.value=!0,W.value="success",D(20,"正在检查微信状态...");const e=await(0,c.xI)();if(!e.success){if("ENV_NOT_CONFIGURED"===e.code)return v.value=!1,void(K.value=!0);throw new Error(e.message)}D(60,"正在初始化微信实例..."),D(100,"初始化成功！"),localStorage.setItem("appStarted","true"),setTimeout(()=>{t.push({name:"WelcomePage",params:{nickname:e.instances[0]?.nickname||"用户"}})},500)}catch(e){W.value="exception",D(100,`启动失败: ${e.message}`),i.nk.error(`启动失败: ${e.message}`),v.value=!1}},z=async()=>{try{if(U.value)return;U.value=!0,j.value={1:"pending",2:"pending",3:"pending",4:"pending"};const e=await(0,c.VO)();e.success?(K.value=!1,X.value=!0):i.nk.error(e.message||"自动配置失败")}catch(e){i.nk.error("自动配置失败")}finally{U.value=!1}},M=async()=>{try{v.value=!0,D(20,"正在检查微信状态...");const e=await(0,c.xI)();e.success?(D(100,"初始化成功！"),localStorage.setItem("appStarted","true"),X.value=!1,setTimeout(()=>{t.push({name:"WelcomePage",params:{nickname:e.instances[0]?.nickname||"用户"}})},500),(0,c._Q)()):i.nk.error(e.message||"初始化失败")}finally{v.value=!1}};function N(){$.value?t.push({path:"/agent/login",query:{agent:$.value}}):t.push("/agent/login")}return(e,t)=>{const l=(0,n.g2)("el-progress"),i=(0,n.g2)("el-button"),c=(0,n.g2)("el-card"),d=(0,n.g2)("el-icon"),p=(0,n.g2)("el-dialog");return(0,n.uX)(),(0,n.CE)("div",g,[t[15]||(t[15]=(0,n.Lk)("div",{class:"background-animation"},null,-1)),(0,n.bF)(c,{class:"startup-card"},{header:(0,n.k6)(()=>[(0,n.Lk)("div",k,[(0,n.Lk)("h2",null,[(0,n.eW)((0,s.v_)((0,o.R1)(a).ename)+" ",1),(0,n.Lk)("span",h,"v"+(0,s.v_)((0,o.R1)(u.rE)),1)])])]),default:(0,n.k6)(()=>[(0,n.Lk)("div",f,[t[3]||(t[3]=(0,n.Lk)("div",{class:"instructions"},[(0,n.Lk)("h3",null,"启动向导"),(0,n.Lk)("ol",null,[(0,n.Lk)("li",null,"请确保已登录至少1个微信号"),(0,n.Lk)("li",{class:"important-tip"},[(0,n.Lk)("span",{class:"important-icon"},"⚠️"),(0,n.Lk)("strong",null,"确保微信窗口可见，不要最小化或关闭")]),(0,n.Lk)("li",null,"点击启动应用后，不要操作鼠标"),(0,n.Lk)("li",null,"以上知晓后，点击下方按钮启动应用~")])],-1)),v.value?((0,n.uX)(),(0,n.CE)("div",y,[(0,n.bF)(l,{percentage:m.value,status:W.value,"stroke-width":8,"show-text":!1},null,8,["percentage","status"]),(0,n.Lk)("p",b,(0,s.v_)(S.value),1)])):(0,n.Q3)("",!0),(0,n.Lk)("div",_,[(0,n.bF)(i,{type:"warning",loading:v.value,onClick:P,class:"start-button multi-start-button",style:{"margin-top":"16px"}},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(v.value?"正在启动...":"启动应用"),1)]),_:1},8,["loading"]),t[2]||(t[2]=(0,n.Lk)("div",{class:"disclaimer"},[(0,n.Lk)("p",null,"免责声明"),(0,n.Lk)("ul",null,[(0,n.Lk)("li",null,"本软件仅供日常交流使用，严禁用于非法用途"),(0,n.Lk)("li",null,"请遵守相关法律法规，违规使用造成的后果由使用者承担")])],-1))])])]),_:1}),(0,n.bF)(p,{modelValue:K.value,"onUpdate:modelValue":t[0]||(t[0]=e=>K.value=e),title:"设备环境异常~",width:"460px","align-center":"",class:"env-dialog"},{header:(0,n.k6)(()=>[(0,n.Lk)("div",w,[(0,n.bF)(d,{class:"warning-icon"},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(r.WarningFilled))]),_:1}),t[4]||(t[4]=(0,n.Lk)("span",{class:"dialog-title"},"设备环境异常~",-1))])]),footer:(0,n.k6)(()=>[(0,n.bF)(i,{class:"dialog-primary",type:"primary",loading:U.value,disabled:U.value,onClick:z},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(U.value?"正在自动配置":"开始自动配置"),1)]),_:1},8,["loading","disabled"])]),default:(0,n.k6)(()=>[(0,n.Lk)("div",L,[t[13]||(t[13]=(0,n.Lk)("p",{class:"dialog-subtitle"},"您使用的是4.1版本微信，需要进行设备环境配置。点击下方按钮，会自动执行以下配置：",-1)),(0,n.Lk)("div",F,[(0,n.Lk)("div",{class:(0,s.C4)(["step-item",{done:"done"===j.value[1]}])},[t[6]||(t[6]=(0,n.Lk)("span",{class:"step-index"},"1",-1)),(0,n.Lk)("span",C,[t[5]||(t[5]=(0,n.eW)("退出当前微信程序",-1)),"done"===j.value[1]?((0,n.uX)(),(0,n.CE)("span",E,"（√）")):(0,n.Q3)("",!0)])],2),(0,n.Lk)("div",{class:(0,s.C4)(["step-item",{done:"done"===j.value[2]}])},[t[8]||(t[8]=(0,n.Lk)("span",{class:"step-index"},"2",-1)),(0,n.Lk)("span",I,[t[7]||(t[7]=(0,n.eW)("配置电脑环境变量",-1)),"done"===j.value[2]?((0,n.uX)(),(0,n.CE)("span",R,"（√）")):(0,n.Q3)("",!0)])],2),(0,n.Lk)("div",{class:(0,s.C4)(["step-item",{done:"done"===j.value[3]}])},[t[10]||(t[10]=(0,n.Lk)("span",{class:"step-index"},"3",-1)),(0,n.Lk)("span",T,[t[9]||(t[9]=(0,n.eW)("启动“讲述人”模式并运行 10 秒",-1)),"done"===j.value[3]?((0,n.uX)(),(0,n.CE)("span",V,"（√）")):(0,n.Q3)("",!0)])],2),(0,n.Lk)("div",{class:(0,s.C4)(["step-item",{done:"done"===j.value[4]}])},[t[12]||(t[12]=(0,n.Lk)("span",{class:"step-index"},"4",-1)),(0,n.Lk)("span",x,[t[11]||(t[11]=(0,n.eW)("重新启动微信程序",-1)),"done"===j.value[4]?((0,n.uX)(),(0,n.CE)("span",A,"（√）")):(0,n.Q3)("",!0)])],2)])])]),_:1},8,["modelValue"]),(0,n.bF)(p,{modelValue:X.value,"onUpdate:modelValue":t[1]||(t[1]=e=>X.value=e),title:"自动配置完成！",width:"380px","align-center":"",class:"complete-dialog"},{footer:(0,n.k6)(()=>[(0,n.bF)(i,{class:"dialog-primary",type:"primary",loading:v.value,disabled:v.value,onClick:M},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(v.value?"正在启动":"启动应用"),1)]),_:1},8,["loading","disabled"])]),default:(0,n.k6)(()=>[t[14]||(t[14]=(0,n.Lk)("div",{class:"dialog-content"},[(0,n.Lk)("p",{class:"dialog-summary"},"已完成配置（先不要关闭讲述人模式）"),(0,n.Lk)("p",{class:"dialog-subtitle"},"请登录微信后，点击下方按钮启动应用")],-1))]),_:1},8,["modelValue"])])}}});var S=t(1241);const K=(0,S.A)(W,[["__scopeId","data-v-59b346f0"]]),X=K;var $=t(2261);const U=(0,$.nY)("user",{state:()=>({userInfo:null,isLoggedIn:!1,lastFetchTime:0,isFetching:!1}),actions:{async fetchUserInfo(e=!1){if(this.isFetching)return new Promise(e=>{const a=setInterval(()=>{this.isFetching||(clearInterval(a),e(this.userInfo))},100)});const a=Date.now();if(!e&&this.userInfo&&a-this.lastFetchTime<3e5)return this.userInfo;try{this.isFetching=!0;const e=await(0,c.HW)();return e.success&&e.data&&(this.setUserInfo(e.data),this.lastFetchTime=a),this.isFetching=!1,this.userInfo}catch(t){throw console.error("获取用户信息失败:",t),this.isFetching=!1,t}},setUserInfo(e){this.userInfo=e,this.isLoggedIn=!!e},clearUserInfo(){this.userInfo=null,this.isLoggedIn=!1,this.lastFetchTime=0}}});class j{static instance;loadStatus={};preloadedImages={};config={};globalFallback="/icon/empty.svg";retryCount={};maxRetries=2;constructor(){}static getInstance(){return j.instance||(j.instance=new j),j.instance}registerConfig(e){this.config={...this.config,...e}}setGlobalFallback(e){this.globalFallback=e}getPath(e){const a=this.config[e];if(!a)return console.warn(`未找到图标配置: ${e}，请确保已注册配置`),this.globalFallback;const t=this.loadStatus[e];return"error"===t?a.fallback||this.globalFallback:a.path}handleLoad(e){const a=e.target,t=this.getIconNameFromSrc(a.src);t&&(this.loadStatus[t]="loaded",this.preloadedImages[t]=a,console.debug(`SVG加载成功: ${t}`))}handleError(e){const a=e.target,t=this.getIconNameFromSrc(a.src);if(!t)return;const l=this.retryCount[t]||0,n=this.config[t];if(l>=this.maxRetries)return console.warn(`SVG加载失败达到最大重试次数: ${t}`),void(this.loadStatus[t]="error");this.retryCount[t]=l+1,this.loadStatus[t]="error";const s=n?.fallback||this.globalFallback;a.src!==s&&(console.warn(`SVG加载失败: ${t}, 尝试备用路径 (重试 ${l+1}/${this.maxRetries})`),a.src=s)}getIconNameFromSrc(e){for(const[a,t]of Object.entries(this.config)){const l=t.path.split("/").pop();if(l&&e.endsWith(l))return a}return null}async preloadImages(e){const a=e||Object.keys(this.config),t=a.map(e=>new Promise(a=>{const t=this.config[e];if(!t)return void a();const l=new Image;this.loadStatus[e]="loading",l.onload=()=>{this.loadStatus[e]="loaded",this.preloadedImages[e]=l,console.debug(`SVG预加载成功: ${e}`),a()},l.onerror=()=>{this.loadStatus[e]="error",console.warn(`SVG预加载失败: ${e}`),a()},l.src=t.path}));await Promise.all(t),console.debug("SVG预加载完成")}async checkAvailability(e){const a=this.config[e];return!!a&&new Promise(e=>{const t=new Image;t.onload=()=>e(!0),t.onerror=()=>e(!1),t.src=a.path})}getLoadStatus(e){return this.loadStatus[e]||"unknown"}resetRetryCount(e){e?delete this.retryCount[e]:this.retryCount={}}}const D=j;function P(e){const a=D.getInstance(),t=(0,o.KR)(!1);e&&a.registerConfig(e);const l=e=>a.getPath(e),n=e=>{a.handleLoad(e)},s=e=>{a.handleError(e)},i=async e=>{await a.preloadImages(e),t.value=!0},r=e=>a.checkAvailability(e),c=e=>a.getLoadStatus(e);return{isReady:t,getIconPath:l,handleImageLoad:n,handleImageError:s,preloadImages:i,checkAvailability:r,getLoadStatus:c}}const z={class:"multi-welcome-container"},M={class:"main-container"},N={class:"sidebar"},O=["onClick"],G=["title"],q=["src"],J={class:"content"},B={class:"header"},Q={class:"header-content"},H={class:"brand-container"},Y={class:"brand-name"},Z={class:"version-number"},ee={class:"welcome-container"},ae={class:"user-name"},te={class:"stats-container"},le={class:"stat-card"},ne={class:"stat-number"},se={class:"stat-card"},oe={class:"stat-number"},ie={class:"stat-number"},re={class:"stat-label"},ce={key:1,class:"copyright-info"},ue={class:"copyright-text"},de={class:"unbind-content"},ve={class:"machine-code-info"},me={class:"dialog-footer"},pe={class:"dialog-footer"},ge={class:"update-content"},ke={class:"version-info"},he={class:"version-item"},fe={class:"version-value latest"},ye={class:"version-item"},be={class:"version-value"},_e={class:"changelog"},we=["innerHTML"],Le={class:"dialog-footer"},Fe={class:"customer-service-content"},Ce={key:0,class:"qrcode-container"},Ee=["src"],Ie={class:"customer-service-contact"},Re={key:1,class:"text-contact-container"},Te={class:"customer-service-contact"},Ve={class:"dialog-footer"},xe=(0,n.pM)({name:"MultiWelcomePage",__name:"MultiWelcomePage",setup(e){const{getIconPath:a,handleImageLoad:t,handleImageError:l,preloadImages:r}=P({refresh:{path:"/icon/refresh.png",fallback:"/icon/load_error.svg"},update:{path:"/icon/update.svg",fallback:"/icon/load_error.svg"}}),d=(0,n.WQ)("brandConfig",(0,o.KR)({channel_id:"channel_000001",name:"Yoko微信机器人",ename:"YokoAIBot",logo:"/assets/logo.png",contact:"473726474@qq.com",version:"1.0.9"})),v=(0,o.KR)([]),m=(0,o.KR)(""),p=(0,n.EW)(()=>v.value.find(e=>e.instance_id===m.value)),g=(0,o.KR)(0),k=(0,o.KR)(0),h=(0,o.KR)(!0),f=(0,o.KR)(!1),y=(0,n.EW)(()=>h.value?"在线":"已掉线"),b=U(),_=(0,o.KR)(!1),w=(0,o.KR)(!1),L=(0,o.KR)(""),F=(0,o.KR)(""),C=(0,o.KR)(!1),E=(0,o.KR)({needs_update:!1,latest_version:"",download_url:"",changelog:"",is_mandatory:!1,release_date:""}),I=(0,o.KR)(!1),R=(0,o.KR)(0),T=(0,o.KR)(!1),V=(0,o.KR)(!1),x=()=>{i.nk.error("二维码加载失败，请联系客服")},A=async()=>{if(d.value.qrcodeUrl)try{const e=document.createElement("a");e.href=d.value.qrcodeUrl,e.download=`${d.value.name}_客服二维码.png`,document.body.appendChild(e),e.click(),document.body.removeChild(e),i.nk.success("二维码已保存到下载文件夹")}catch(e){console.error("保存二维码失败:",e),i.nk.error("保存失败，请右键图片另存为")}else i.nk.warning("二维码链接不存在")},W=()=>{V.value=!0},S=()=>{d.value.contact?navigator.clipboard.writeText(d.value.contact).then(()=>{i.nk.success("联系方式已复制到剪贴板")}).catch(e=>{console.error("复制失败:",e),i.nk.error("复制失败，请手动复制")}):i.nk.warning("联系方式为空")},K=async()=>{try{const e=await(0,c.qh)();e.success?(L.value=e.data.machine_code,_.value=!0):i.nk.error(e.error||"获取授权信息失败")}catch(e){i.nk.error("获取授权信息失败")}},X=async()=>{try{const e=await(0,c.kz)(F.value);e.success?i.nk.success("解绑成功，应用即将关闭"):i.nk.error(e.message||"解绑失败")}catch(e){i.nk.error("解绑失败")}finally{w.value=!1,_.value=!1}},$=async()=>{try{const e=await(0,c.hE)();h.value=e.connected,e.connected||i.nk.warning(`连接状态: ${e.reason}`)}catch(e){console.error("检查连接状态失败:",e),h.value=!1}},j=async()=>{try{f.value=!0;const e=await(0,c.qg)(m.value);e.success?(i.nk.success("重新连接成功"),h.value=!0,e.user_info&&b.setUserInfo(e.user_info),await xe()):i.nk.error(e.error||"重新连接失败")}catch(e){i.nk.error("重新连接失败: "+e)}finally{f.value=!1}},D=async e=>{try{if(e.is_active)return;const a=await(0,c.Qj)(e.instance_id);console.debug("切换结果:",a),a.success?(i.nk.success("成功切换微信号"),m.value=e.instance_id,await xe(),a.instance&&(g.value=a.instance.friend_count||0,k.value=a.instance.group_count||0,b.setUserInfo({nickname:a.instance.nickname,account_id:a.instance.account_id,friendCount:a.instance.friend_count,groupCount:a.instance.group_count}),b.$state.lastFetchTime=Date.now()),await $()):i.nk.error(a.error||"切换实例失败")}catch(a){console.error("切换实例失败:",a),i.nk.error("切换实例失败")}},xe=async()=>{try{const e=await(0,c.Or)();if(console.debug("加载微信实例列表结果:",e),e.success){v.value=e.instances.map(e=>({...e,nickname:e.nickname||e.account_info?.nickname||"微信",account_id:e.account_id||e.account_info?.account_id||"",is_connected:!0}));const a=v.value.find(e=>e.is_active);a&&(m.value=a.instance_id)}else i.nk.error(e.error||"获取实例列表失败")}catch(e){console.error("获取实例列表失败:",e),i.nk.error("获取实例列表失败")}},Ae=async()=>{try{const e=await(0,c.Or)();if(console.debug("初始化多微信实例结果:",e),e.success){if(v.value=e.instances.map(e=>({...e,nickname:e.nickname||e.account_info?.nickname||"微信",account_id:e.account_id||e.account_info?.account_id||"",is_connected:!0})),e.instances.length>0){const a=e.instances.find(e=>e.is_active)||e.instances[0];m.value=a.instance_id}return!0}return i.nk.error(e.message||"获取微信实例失败"),!1}catch(e){return console.error("获取微信实例失败:",e),i.nk.error("获取微信实例失败"),!1}},We=async()=>{try{const e=d.value.channel_id||"default",a=await(0,c.ps)(u.rE,e);a.success?a.data.needs_update?(E.value=a.data,C.value=!0):i.nk.success("当前已是最新版本"):i.nk.error(a.error||"检查更新失败")}catch(e){console.error("检查更新失败:",e),i.nk.error("检查更新失败")}},Se=e=>e?e.replace(/\n/g,"<br>"):"",Ke=e=>{if(!e)return"";const a=new Date(e);return a.toLocaleDateString("zh-CN")},Xe=e=>100===e?"准备重启":`${e}%`,$e=async()=>{try{I.value=!0,R.value=0;const e=setInterval(()=>{R.value<90&&(R.value+=10)},500),a=d.value.channel_id||"default",t=new Promise((e,a)=>{setTimeout(()=>a(new Error("timeout")),6e4)}),l=await Promise.race([(0,c.MB)(u.rE,a),t]);if(clearInterval(e),l.success){R.value=100;const e=l.log_file;i.nk.success("更新已下载，应用将在几秒后重启"+(e?"（日志："+e+"）":"")),setTimeout(()=>{I.value&&(i.nk.warning("自动重启可能失败，请手动关闭并重新打开应用"),I.value=!1)},2e4)}else{const e=l.error||"",a=l.log_file;"invalid_update_package"===e||/zip/i.test(e)?i.nk.error("更新包为空或已损坏，请稍后重试"+(a?"（日志："+a+"）":"")):"permission_denied"===e?i.nk.error("更新失败：当前目录无写入权限，请使用管理员权限运行或关闭安全软件后重试"+(a?"（日志："+a+"）":"")):i.nk.error((l.error||"更新失败")+(a?"（日志："+a+"）":"")),I.value=!1}}catch(e){"timeout"===e?.message?i.nk.error("下载超时，请检查网络后重试"):i.nk.error("更新失败"),I.value=!1}},Ue=async()=>{if(!T.value)try{const e=d.value.channel_id||"default",a=await(0,c.ps)(u.rE,e);if(a.success&&a.data.needs_update)if(E.value=a.data,a.data.is_mandatory)C.value=!0;else{const e=await(0,c.oZ)();if(e.success){const t=e.data.notified_versions||[];t.includes(a.data.latest_version)||(C.value=!0,t.push(a.data.latest_version),await(0,c.PD)({notified_versions:t}))}else C.value=!0}T.value=!0}catch(e){console.error("检查更新失败:",e)}},je=async()=>{try{const e=v.value.find(e=>e.is_active),a=e?.account_id||"",t=b.userInfo?.account_id||"",l=""!==a&&""!==t&&a!==t;l&&console.debug("检测到账号切换，强制刷新用户信息");const n=await b.fetchUserInfo(l);console.debug("获取用户信息:",n),n&&(g.value=n.friendCount||0,k.value=n.groupCount||0)}catch(e){console.error("获取用户信息失败:",e)}},De=(0,o.KR)(!1),Pe=async()=>{if(!De.value)try{De.value=!0,i.nk.info("正在刷新...");const e=await Ae();e&&(await je(),await $()),i.nk.success("刷新完成")}catch(e){console.error("刷新失败:",e),i.nk.error("刷新失败")}finally{De.value=!1}};(0,n.sV)(async()=>{try{console.time("多开欢迎页-总加载时间");const a=await Ae();await r(["refresh","update"]),a&&(await je(),await $(),await Ue());try{const e=await(0,c.Fm)(),a=e&&e.success?e.authority_time||e.server_time:null;if(a){const e=new Date(a).getTime(),t=Date.now(),l=Math.abs(t-e);Me.value=Math.round(l/1e3),ze.value=l>6e4}}catch(e){}console.timeEnd("多开欢迎页-总加载时间")}catch(a){console.error("初始化失败:",a),i.nk.error("初始化失败")}});const ze=(0,o.KR)(!1),Me=(0,o.KR)(0);return(e,i)=>{const r=(0,n.g2)("el-alert"),c=(0,n.g2)("el-button"),b=(0,n.g2)("el-input"),T=(0,n.g2)("el-form-item"),$=(0,n.g2)("el-form"),U=(0,n.g2)("el-dialog"),P=(0,n.g2)("el-progress");return(0,n.uX)(),(0,n.CE)(n.FK,null,[(0,n.Lk)("div",z,[i[20]||(i[20]=(0,n.Lk)("div",{class:"background-animation"},null,-1)),(0,n.Lk)("div",M,[(0,n.Lk)("div",N,[i[11]||(i[11]=(0,n.Lk)("div",{class:"sidebar-title"},"账号",-1)),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(v.value,e=>((0,n.uX)(),(0,n.CE)("div",{key:e.instance_id,class:(0,s.C4)(["account-item",{active:e.instance_id===m.value}]),onClick:a=>D(e)},[(0,n.Lk)("span",null,(0,s.v_)(e.nickname?.substring(0,2)||"微信"),1),(0,n.Lk)("div",{class:(0,s.C4)(["status-indicator",{offline:!e.is_connected}])},null,2)],10,O))),128)),(0,n.Lk)("div",{class:(0,s.C4)(["refresh-button",{refreshing:De.value}]),onClick:Pe,title:De.value?"正在刷新...":"刷新账号列表"},[(0,n.Lk)("img",{src:(0,o.R1)(a)("refresh"),alt:"刷新",class:"refresh-icon",onError:i[0]||(i[0]=(...e)=>(0,o.R1)(l)&&(0,o.R1)(l)(...e)),onLoad:i[1]||(i[1]=(...e)=>(0,o.R1)(t)&&(0,o.R1)(t)(...e))},null,40,q)],10,G)]),(0,n.Lk)("div",J,[(0,n.Lk)("div",B,[(0,n.Lk)("div",Q,[(0,n.Lk)("div",H,[(0,n.Lk)("span",Y,(0,s.v_)((0,o.R1)(d).alias||(0,o.R1)(d).ename),1),(0,n.Lk)("span",Z,"v"+(0,s.v_)((0,o.R1)(u.rE)),1)]),(0,n.Lk)("div",ee,[i[12]||(i[12]=(0,n.Lk)("span",{class:"welcome-text"},"欢迎回来，",-1)),(0,n.Lk)("span",ae,(0,s.v_)(p.value?.nickname||"用户"),1)])])]),ze.value?((0,n.uX)(),(0,n.Wv)(r,{key:0,type:"warning","show-icon":"",class:"time-warning-banner"},{default:(0,n.k6)(()=>[(0,n.Lk)("span",null,"检测到异常！电脑时间与服务器时间偏差约 "+(0,s.v_)(Me.value)+" 秒，请尽快联网校准设备时间！",1)]),_:1})):(0,n.Q3)("",!0),(0,n.Lk)("div",te,[(0,n.Lk)("div",le,[(0,n.Lk)("span",ne,(0,s.v_)(g.value),1),i[13]||(i[13]=(0,n.Lk)("span",{class:"stat-label"},"好友数量",-1))]),(0,n.Lk)("div",se,[(0,n.Lk)("span",oe,(0,s.v_)(k.value),1),i[14]||(i[14]=(0,n.Lk)("span",{class:"stat-label"},"群聊数量",-1))]),(0,n.Lk)("div",{class:(0,s.C4)(["stat-card",{online:h.value}])},[(0,n.Lk)("span",ie,(0,s.v_)(y.value),1),(0,n.Lk)("span",re,[(0,n.eW)((0,s.v_)(h.value?"正常连接":"")+" ",1),h.value?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(c,{key:0,type:"info",size:"small",onClick:j,loading:f.value},{default:(0,n.k6)(()=>[...i[15]||(i[15]=[(0,n.eW)(" 重新连接 ",-1)])]),_:1},8,["loading"]))])],2)]),i[19]||(i[19]=(0,n.Fv)('<div class="features-container" data-v-778ff1ea><div class="features-grid" data-v-778ff1ea><div class="feature-card" data-v-778ff1ea><div class="feature-icon" data-v-778ff1ea>🛡️</div><div class="feature-title" data-v-778ff1ea>安全保障</div><div class="feature-desc" data-v-778ff1ea>RPA技术，模拟真人操作</div></div><div class="feature-card" data-v-778ff1ea><div class="feature-icon" data-v-778ff1ea>🤖</div><div class="feature-title" data-v-778ff1ea>AI智能客服</div><div class="feature-desc" data-v-778ff1ea>销冠智能体，7*24小时服务</div></div><div class="feature-card" data-v-778ff1ea><div class="feature-icon" data-v-778ff1ea>👥</div><div class="feature-title" data-v-778ff1ea>多账号管理</div><div class="feature-desc" data-v-778ff1ea>多账号管理，提升运营效率</div></div><div class="feature-card" data-v-778ff1ea><div class="feature-icon" data-v-778ff1ea>💎</div><div class="feature-title" data-v-778ff1ea>AI朋友圈大师</div><div class="feature-desc" data-v-778ff1ea>AI朋友圈评论，维护客户关系</div></div></div></div>',1)),(0,n.Lk)("div",{class:"action-buttons"},[(0,n.Lk)("button",{class:"btn btn-primary",onClick:W},[...i[16]||(i[16]=[(0,n.Lk)("span",null,"💬",-1),(0,n.eW)(" 专属客服 ",-1)])]),(0,n.Lk)("button",{class:"btn btn-secondary",onClick:K},[...i[17]||(i[17]=[(0,n.Lk)("span",null,"🔗",-1),(0,n.eW)(" 解绑账号 ",-1)])]),(0,n.Lk)("button",{class:"btn btn-outline",onClick:We},[...i[18]||(i[18]=[(0,n.Lk)("span",null,"🔄",-1),(0,n.eW)(" 版本更新 ",-1)])])]),(0,o.R1)(d).copyright?((0,n.uX)(),(0,n.CE)("div",ce,[(0,n.Lk)("span",ue,(0,s.v_)((0,o.R1)(d).copyright),1)])):(0,n.Q3)("",!0)])])]),(0,n.bF)(U,{modelValue:_.value,"onUpdate:modelValue":i[4]||(i[4]=e=>_.value=e),title:"提示：请谨慎解绑，一旦解绑不可恢复",width:"400px",class:"unbind-dialog"},{footer:(0,n.k6)(()=>[(0,n.Lk)("span",me,[(0,n.bF)(c,{onClick:i[3]||(i[3]=e=>_.value=!1)},{default:(0,n.k6)(()=>[...i[21]||(i[21]=[(0,n.eW)("取消",-1)])]),_:1}),(0,n.bF)(c,{type:"danger",onClick:X},{default:(0,n.k6)(()=>[...i[22]||(i[22]=[(0,n.eW)(" 确认 ",-1)])]),_:1})])]),default:(0,n.k6)(()=>[(0,n.Lk)("div",de,[(0,n.Lk)("p",ve,"本机机器码： "+(0,s.v_)(L.value),1),(0,n.bF)($,null,{default:(0,n.k6)(()=>[(0,n.bF)(T,{label:"您的激活码："},{default:(0,n.k6)(()=>[(0,n.bF)(b,{modelValue:F.value,"onUpdate:modelValue":i[2]||(i[2]=e=>F.value=e),placeholder:"请输入激活码",maxlength:54},null,8,["modelValue"])]),_:1})]),_:1})])]),_:1},8,["modelValue"]),(0,n.bF)(U,{modelValue:w.value,"onUpdate:modelValue":i[6]||(i[6]=e=>w.value=e),title:"确认解绑",width:"300px"},{footer:(0,n.k6)(()=>[(0,n.Lk)("span",pe,[(0,n.bF)(c,{onClick:i[5]||(i[5]=e=>w.value=!1)},{default:(0,n.k6)(()=>[...i[23]||(i[23]=[(0,n.eW)("取消",-1)])]),_:1}),(0,n.bF)(c,{type:"danger",onClick:X},{default:(0,n.k6)(()=>[...i[24]||(i[24]=[(0,n.eW)("确认解绑",-1)])]),_:1})])]),default:(0,n.k6)(()=>[i[25]||(i[25]=(0,n.Lk)("p",null,"确定要解绑当前设备吗？此操作不可恢复！",-1))]),_:1},8,["modelValue"]),(0,n.bF)(U,{modelValue:C.value,"onUpdate:modelValue":i[8]||(i[8]=e=>C.value=e),title:E.value.is_mandatory?"强制更新":"发现新版本",width:"450px","close-on-click-modal":!E.value.is_mandatory,"close-on-press-escape":!E.value.is_mandatory,"show-close":!E.value.is_mandatory,class:"update-dialog"},{footer:(0,n.k6)(()=>[(0,n.Lk)("span",Le,[E.value.is_mandatory?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(c,{key:0,onClick:i[7]||(i[7]=e=>C.value=!1)},{default:(0,n.k6)(()=>[...i[30]||(i[30]=[(0,n.eW)("稍后更新",-1)])]),_:1})),(0,n.bF)(c,{type:"primary",onClick:$e,loading:I.value,disabled:I.value},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(I.value?"更新中":"立即更新"),1)]),_:1},8,["loading","disabled"])])]),default:(0,n.k6)(()=>[(0,n.Lk)("div",ge,[i[29]||(i[29]=(0,n.Lk)("div",{class:"update-header"},[(0,n.Lk)("img",{src:"/icon/update.svg",alt:"更新",class:"update-icon"}),(0,n.Lk)("div",{class:"update-title"},[(0,n.Lk)("h3",null,"软件更新"),(0,n.Lk)("p",{class:"update-subtitle"},"发现新版本可用")])],-1)),(0,n.Lk)("div",ke,[(0,n.Lk)("div",he,[i[26]||(i[26]=(0,n.Lk)("span",{class:"version-label"},"最新版本:",-1)),(0,n.Lk)("span",fe,"v"+(0,s.v_)(E.value.latest_version),1)]),(0,n.Lk)("div",ye,[i[27]||(i[27]=(0,n.Lk)("span",{class:"version-label"},"发布日期:",-1)),(0,n.Lk)("span",be,(0,s.v_)(Ke(E.value.release_date)),1)])]),(0,n.Lk)("div",_e,[i[28]||(i[28]=(0,n.Lk)("h4",null,"更新内容:",-1)),(0,n.Lk)("div",{class:"changelog-content",innerHTML:Se(E.value.changelog)},null,8,we)]),I.value?((0,n.uX)(),(0,n.Wv)(P,{key:0,percentage:R.value,format:Xe,"stroke-width":10,class:"update-progress"},null,8,["percentage"])):(0,n.Q3)("",!0)])]),_:1},8,["modelValue","title","close-on-click-modal","close-on-press-escape","show-close"]),(0,n.bF)(U,{modelValue:V.value,"onUpdate:modelValue":i[10]||(i[10]=e=>V.value=e),title:"专属客服",width:"400px"},{footer:(0,n.k6)(()=>[(0,n.Lk)("span",Ve,["qrcode"!==(0,o.R1)(d).contactType?((0,n.uX)(),(0,n.Wv)(c,{key:0,type:"primary",onClick:S},{default:(0,n.k6)(()=>[...i[32]||(i[32]=[(0,n.eW)("复制联系方式",-1)])]),_:1})):((0,n.uX)(),(0,n.Wv)(c,{key:1,type:"primary",onClick:A},{default:(0,n.k6)(()=>[...i[33]||(i[33]=[(0,n.eW)("保存二维码",-1)])]),_:1})),(0,n.bF)(c,{onClick:i[9]||(i[9]=e=>V.value=!1)},{default:(0,n.k6)(()=>[...i[34]||(i[34]=[(0,n.eW)("关闭",-1)])]),_:1})])]),default:(0,n.k6)(()=>[(0,n.Lk)("div",Fe,["qrcode"===(0,o.R1)(d).contactType&&(0,o.R1)(d).qrcodeUrl?((0,n.uX)(),(0,n.CE)("div",Ce,[(0,n.Lk)("img",{src:(0,o.R1)(d).qrcodeUrl,alt:"客服二维码",class:"customer-qrcode",onError:x},null,40,Ee),(0,n.Lk)("p",Ie,(0,s.v_)((0,o.R1)(d).contact),1)])):((0,n.uX)(),(0,n.CE)("div",Re,[i[31]||(i[31]=(0,n.Lk)("div",{class:"contact-icon"},[(0,n.Lk)("span",{style:{"font-size":"100px"}},"📞")],-1)),(0,n.Lk)("p",Te,"客服联系方式："+(0,s.v_)((0,o.R1)(d).contact),1)]))])]),_:1},8,["modelValue"])],64)}}}),Ae=(0,S.A)(xe,[["__scopeId","data-v-778ff1ea"]]),We=Ae;var Se=t(5130),Ke=t(2933);const Xe="http://127.0.0.1:9922/api",$e="yoko_test",Ue={"Content-Type":"application/json","X-API-Key":$e},je=async()=>{try{const e=await fetch(`${Xe}/chat/suspended_sessions`,{method:"GET",headers:Ue});if(!e.ok)throw new Error(`获取挂起会话列表失败: ${e.status}`);const a=await e.json();return Array.isArray(a)?a:[]}catch(e){return console.error("获取挂起会话列表失败:",e),[]}},De=async(e,a)=>{try{const t=await fetch(`${Xe}/chat/unsuspend_session`,{method:"POST",headers:Ue,body:JSON.stringify({session_name:e,account_id:a})});if(!t.ok)throw new Error(`解除会话挂起失败: ${t.status}`);const l=await t.json();return!0===l.success}catch(t){return console.error("解除会话挂起失败:",t),!1}},Pe=async()=>{try{const e=await fetch(`${Xe}/chat/history_sessions`,{method:"GET",headers:Ue});if(!e.ok)throw new Error(`获取历史会话列表失败: ${e.status}`);const a=await e.json();return Array.isArray(a)?a:[]}catch(e){return console.error("获取历史会话列表失败:",e),[]}},ze=async(e,a)=>{try{const t=new URL(`${Xe}/chat/history_messages/${encodeURIComponent(e)}`);a&&t.searchParams.append("account_id",a);const l=await fetch(t.toString(),{method:"GET",headers:Ue});if(!l.ok)throw new Error(`获取历史聊天记录失败: ${l.status}`);const n=await l.json();return{messages:n.messages||[],chatType:n.chatType||"unknown"}}catch(t){return console.error("获取历史聊天记录失败:",t),{messages:[],chatType:"unknown"}}},Me=async()=>{try{const e=await fetch(`${Xe}/chat/logs`,{headers:Ue}),a=await e.json();if(!a.success)throw new Error("获取日志数据失败");const t=a.logs.map(e=>({timestamp:new Date(e.timestamp),targetName:e.targetName||e.session_name,content:e.content,status:e.status,error:e.error,chatType:e.chatType||(e.content?.includes("：")?"group":"single"),account_id:e.account_id||"default"})),l=new Date;l.setHours(0,0,0,0);const n=l.getTime(),s=new Date(n);s.setDate(s.getDate()-1);const o=s.getTime(),i=t.filter(e=>e.timestamp.getTime()>=n),r=t.filter(e=>e.timestamp.getTime()>=o&&e.timestamp.getTime()<n),c=new Set(i.map(e=>`${e.account_id}_${e.targetName}`)),u=c.size,d=new Set(r.map(e=>`${e.account_id}_${e.targetName}`)),v=d.size,m=i.filter(e=>"completed"===e.status).length,p=r.filter(e=>"completed"===e.status).length;let g=0;0===v?g=100*u:(g=100*(u-v)/v,g<-100&&(g=-100));let k=0;0===p?k=100*m:(k=100*(m-p)/p,k<-100&&(k=-100));let h=0;i.forEach(e=>{"completed"===e.status&&e.content&&(h+=e.content.length)});const f=parseFloat((5*h/3600).toFixed(2)),y=25,b=parseFloat((f*y).toFixed(0));return{sessionCount:u,sessionIncrease:parseFloat(g.toFixed(1)),messageCount:m,messageIncrease:parseFloat(k.toFixed(1)),savedHours:f,savedMoney:b}}catch(e){return console.error("获取统计数据失败:",e),{sessionCount:0,sessionIncrease:0,messageCount:0,messageIncrease:0,savedHours:0,savedMoney:0}}},Ne=async e=>{try{const a=await fetch(`${Xe}/chat/multi-monitor/start`,{method:"POST",headers:Ue,body:JSON.stringify(e||{})}),t=await a.json();if("error"===t.status&&("SYNC_REQUIRED"===t.code||"SYNC_EXPIRED"===t.code))throw new Error(JSON.stringify({type:"SYNC_ERROR",message:t.message}));return t}catch(a){throw console.error("启动会话监控失败:",a),a}},Oe=async e=>{try{const a=await fetch(`${Xe}/v2/tasks/auto-reply/confirm`,{method:"POST",headers:Ue,body:JSON.stringify(e)});return await a.json()}catch(a){throw console.error("确认自动回复失败:",a),a}},Ge=async()=>{try{const e=await fetch(`${Xe}/chat/monitor/stop`,{method:"POST",headers:Ue}),a=await e.json();return a}catch(e){throw console.error("停止会话监控失败:",e),e}},qe=async e=>{try{const a=new URL(`${Xe}/chat/latest_sessions`);e&&a.searchParams.append("start_time",e.toString());const t=await fetch(a.toString(),{method:"GET",headers:Ue});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const l=await t.json();return Array.isArray(l)?l:[]}catch(a){return console.error("获取最新会话列表失败:",a),[]}},Je=async(e,a)=>{try{const t=new URL(`${Xe}/chat/messages/${encodeURIComponent(e)}`);a&&t.searchParams.append("account_id",a);const l=await fetch(t.toString(),{method:"GET",headers:Ue});if(!l.ok)throw new Error(`获取聊天记录失败: ${l.status}`);const n=await l.json();return console.debug(`获取 ${e} 的聊天记录:`,n),{messages:n.messages||[],chatType:n.chatType||"unknown"}}catch(t){return console.error("获取聊天记录失败:",t),{messages:[],chatType:"unknown"}}},Be=async(e,a)=>{try{const t=await fetch(`${Xe}/chat/send_message`,{method:"POST",headers:Ue,body:JSON.stringify({user:e,message:a})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){throw console.error("发送消息失败:",t),t}},Qe=async e=>{try{const a=await fetch(`${Xe}/v2/tasks/auto-reply`,{method:"POST",headers:Ue,body:JSON.stringify(e)});return await a.json()}catch(a){return console.error("创建自动回复任务失败:",a),{success:!1,error:String(a)}}},He=async e=>{try{const a=await fetch(`${Xe}/chat/monitor/manual-review`,{method:"POST",headers:Ue,body:JSON.stringify({enabled:e})});return await a.json()}catch(a){throw console.error("更新人工复核状态失败:",a),a}},Ye=async()=>{try{const e=await fetch(`${Xe}/chat/monitor/status`,{method:"GET",headers:Ue}),a=await e.json();return a}catch(e){throw console.error("获取监控状态失败:",e),e}};var Ze=t(738),ea=t(5142);const aa={class:"staff-form"},ta={class:"form-item"},la={class:"form-item"},na={key:0,style:{"margin-top":"6px","padding-top":"6px","border-top":"1px dashed #eee"}},sa={class:"form-item"},oa={style:{display:"flex","align-items":"center"}},ia=["src","alt"],ra={key:0,class:"form-item"},ca={class:"section-header"},ua={key:1,class:"form-item"},da={class:"section-header"},va={class:"dialog-footer"},ma=(0,n.pM)({__name:"StaffDialog",props:{visible:{type:Boolean,default:!1},staff:{type:Object,default:void 0},isEdit:{type:Boolean,default:!1},cozeAgents:{type:Array,default:()=>[]},contactTags:{type:Array,default:()=>[]},groupTags:{type:Array,default:()=>[]},hasGroupStaff:{type:Boolean,default:!1}},emits:["update:visible","save"],setup(e,{emit:a}){const t=e=>"dify"===e||"yuanqi"===e?"png":"svg",l=e,r=a,c=((0,n.EW)(()=>l.isEdit&&"group"===l.staff?.chatType),(0,n.EW)({get:()=>l.visible,set:e=>r("update:visible",e)})),u=(0,o.KR)({id:"",name:"",enabled:!0,agentId:"",chatType:"single",selectedTags:[],keywords:[],readGroupMember:!1});(0,o.KR)(!1),(0,o.KR)(""),(0,o.KR)(null);(0,n.wB)(()=>l.staff,e=>{if(e){const a=JSON.parse(JSON.stringify(e));u.value={...a,readGroupMember:a.readGroupMember??!1}}},{immediate:!0});const d=()=>{u.value.selectedTags=[],i.nk.success("已重置，重新保存后生效")},v=()=>{u.value.name.trim()?u.value.agentId?r("save",u.value):i.nk.error("请选择智能体"):i.nk.error("请输入员工名称")};return(a,o)=>{const i=(0,n.g2)("el-input"),r=(0,n.g2)("el-radio"),m=(0,n.g2)("el-radio-group"),p=(0,n.g2)("el-checkbox"),g=(0,n.g2)("el-option"),k=(0,n.g2)("el-select"),h=(0,n.g2)("el-button"),f=(0,n.g2)("el-checkbox-group"),y=(0,n.g2)("el-dialog");return(0,n.uX)(),(0,n.Wv)(y,{modelValue:c.value,"onUpdate:modelValue":o[7]||(o[7]=e=>c.value=e),title:e.isEdit?"编辑AI助理":"添加AI助理",width:"500px"},{footer:(0,n.k6)(()=>[(0,n.Lk)("div",va,[(0,n.bF)(h,{onClick:o[6]||(o[6]=e=>c.value=!1)},{default:(0,n.k6)(()=>[...o[19]||(o[19]=[(0,n.eW)("取消",-1)])]),_:1}),(0,n.bF)(h,{type:"primary",onClick:v},{default:(0,n.k6)(()=>[...o[20]||(o[20]=[(0,n.eW)("确认",-1)])]),_:1})])]),default:(0,n.k6)(()=>[(0,n.Lk)("div",aa,[(0,n.Lk)("div",ta,[o[8]||(o[8]=(0,n.Lk)("h3",null,"*员工名称",-1)),(0,n.bF)(i,{modelValue:u.value.name,"onUpdate:modelValue":o[0]||(o[0]=e=>u.value.name=e),placeholder:"如：培育AI助理"},null,8,["modelValue"])]),(0,n.Lk)("div",la,[o[13]||(o[13]=(0,n.Lk)("h3",null,"*回复范围",-1)),(0,n.bF)(m,{modelValue:u.value.chatType,"onUpdate:modelValue":o[1]||(o[1]=e=>u.value.chatType=e)},{default:(0,n.k6)(()=>[(0,n.bF)(r,{label:"single"},{default:(0,n.k6)(()=>[...o[9]||(o[9]=[(0,n.eW)("单聊",-1)])]),_:1}),(0,n.bF)(r,{label:"group"},{default:(0,n.k6)(()=>[...o[10]||(o[10]=[(0,n.eW)("群聊",-1)])]),_:1})]),_:1},8,["modelValue"]),"group"===u.value.chatType?((0,n.uX)(),(0,n.CE)("div",na,[(0,n.bF)(p,{modelValue:u.value.readGroupMember,"onUpdate:modelValue":o[2]||(o[2]=e=>u.value.readGroupMember=e)},{default:(0,n.k6)(()=>[...o[11]||(o[11]=[(0,n.eW)(" 是否读群成员 ",-1)])]),_:1},8,["modelValue"]),o[12]||(o[12]=(0,n.Lk)("div",{class:"description",style:{"margin-top":"4px",color:"#909399","font-size":"12px"}}," 微信4.1无法直接读取群聊发送者名称，需额操作获取，如非必须可不勾选 ",-1))])):(0,n.Q3)("",!0)]),(0,n.Lk)("div",sa,[o[14]||(o[14]=(0,n.Lk)("h3",null,"*选择智能体",-1)),(0,n.bF)(k,{modelValue:u.value.agentId,"onUpdate:modelValue":o[3]||(o[3]=e=>u.value.agentId=e),placeholder:"请选择智能体",clearable:"",style:{width:"100%"}},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(l.cozeAgents,e=>((0,n.uX)(),(0,n.Wv)(g,{key:e.botId,label:e.name,value:e.botId},{default:(0,n.k6)(()=>[(0,n.Lk)("div",oa,[(0,n.Lk)("img",{src:`/icon/${e.platform||"coze"}.${t(e.platform)}`,alt:e.platform||"coze",style:{width:"18px",height:"18px","margin-right":"8px"}},null,8,ia),(0,n.Lk)("span",null,(0,s.v_)(e.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),"single"===u.value.chatType||"all"===u.value.chatType?((0,n.uX)(),(0,n.CE)("div",ra,[(0,n.Lk)("div",ca,[o[16]||(o[16]=(0,n.Lk)("div",{class:"title-group"},[(0,n.Lk)("h3",null,"好友标签"),(0,n.Lk)("p",{class:"description"},"不选会作为兜底AI助理，回复所有好友")],-1)),e.isEdit?((0,n.uX)(),(0,n.Wv)(h,{key:0,type:"warning",size:"small",onClick:d,disabled:0===u.value.selectedTags.length},{default:(0,n.k6)(()=>[...o[15]||(o[15]=[(0,n.eW)(" 重置标签 ",-1)])]),_:1},8,["disabled"])):(0,n.Q3)("",!0)]),(0,n.bF)(f,{modelValue:u.value.selectedTags,"onUpdate:modelValue":o[4]||(o[4]=e=>u.value.selectedTags=e)},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(l.contactTags,e=>((0,n.uX)(),(0,n.Wv)(p,{key:e.id,label:e.id},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(e.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])])):(0,n.Q3)("",!0),"group"===u.value.chatType?((0,n.uX)(),(0,n.CE)("div",ua,[(0,n.Lk)("div",da,[o[18]||(o[18]=(0,n.Lk)("div",{class:"title-group"},[(0,n.Lk)("h3",null,"群聊标签"),(0,n.Lk)("p",{class:"description"},"不选会作为兜底AI助理，回复所有群聊")],-1)),e.isEdit?((0,n.uX)(),(0,n.Wv)(h,{key:0,type:"warning",size:"small",onClick:d,disabled:0===u.value.selectedTags.length},{default:(0,n.k6)(()=>[...o[17]||(o[17]=[(0,n.eW)(" 重置标签 ",-1)])]),_:1},8,["disabled"])):(0,n.Q3)("",!0)]),(0,n.bF)(f,{modelValue:u.value.selectedTags,"onUpdate:modelValue":o[5]||(o[5]=e=>u.value.selectedTags=e)},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(l.groupTags,e=>((0,n.uX)(),(0,n.Wv)(p,{key:e.id,label:e.id},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(e.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])])):(0,n.Q3)("",!0)])]),_:1},8,["modelValue","title"])}}}),pa=(0,S.A)(ma,[["__scopeId","data-v-146b4356"]]),ga=pa,ka={class:"strategy-content"},ha={class:"config-section"},fa={class:"section-header"},ya={class:"staff-list"},ba={class:"staff-info"},_a={class:"staff-icon"},wa={class:"staff-details"},La={class:"staff-name"},Fa={class:"staff-tags"},Ca={class:"staff-actions"},Ea={class:"config-section"},Ia={class:"common-config-item"},Ra={style:{display:"flex","justify-content":"space-between","align-items":"center"}},Ta={key:0,class:"greeting-group-select"},Va={class:"common-config-item"},xa={class:"form-item"},Aa={class:"form-item",style:{"margin-top":"10px"}},Wa={class:"common-config-item"},Sa={style:{display:"flex","justify-content":"space-between","align-items":"center"}},Ka={key:0,class:"whitelist-input"},Xa={class:"common-config-item"},$a={class:"section-header"},Ua={class:"form-item"},ja={class:"filter-words-list"},Da={class:"common-config-item"},Pa={style:{display:"flex","justify-content":"space-between","align-items":"center"}},za={key:0,class:"file-recognition-config"},Ma={class:"form-item"},Na={class:"form-item"},Oa={class:"path-input-header"},Ga={class:"dialog-footer"},qa=(0,n.pM)({__name:"AIStaffConfig",props:{visible:{type:Boolean,default:!1},cozeAgents:{type:Array,default:()=>[]}},emits:["update:visible","save"],setup(e,{emit:a}){const t=(0,o.KR)(window.innerWidth),l=()=>{t.value=window.innerWidth},c=e,u=a,d=(0,n.EW)({get:()=>c.visible,set:e=>u("update:visible",e)}),v=(0,n.EW)(()=>{if(L.value&&"group"===F.value?.chatType){const e=p.value.filter((e,a)=>a!==C.value);return e.some(e=>"group"===e.chatType)}return p.value.some(e=>"group"===e.chatType)});(0,n.wB)(d,async e=>{e&&(await I(),await E())});const m=(0,o.KR)(["common"]),p=(0,o.KR)([]),g=(0,o.KR)({groupAtOnly:!1,colleagueNamesToIgnore:"",filterWords:[],autoGreeting:{enabled:!1,greetingGroupId:""},fileRecognition:{enabled:!1,fileTypes:[],filePath:""},whitelist:{enabled:!1,names:"",list:[]}}),k=(0,o.KR)([]),h=(0,o.KR)([]),f=(0,o.KR)([]),y=(0,o.KR)(!1),b=(0,o.KR)(""),_=(0,o.KR)(null),w=(0,o.KR)(!1),L=(0,o.KR)(!1),F=(0,o.KR)(void 0),C=(0,o.KR)(-1);(0,n.sV)(async()=>{try{h.value=await(0,Ze.IZ)();try{const e=await(0,Ze.f)(),a=new Map;e.forEach(e=>{const t=(e?.tag||"").trim();t&&a.set(t,(a.get(t)||0)+1)}),f.value=Array.from(a.entries()).map(([e,a])=>({id:e,name:e,count:a}))}catch(e){}await E(),await I(),window.addEventListener("resize",l)}catch(a){console.error("加载配置失败:",a),i.nk.error("加载配置失败")}}),(0,n.hi)(()=>{window.removeEventListener("resize",l)});const E=async()=>{try{const e=await(0,ea.zj)("greeting_config"),a=e?.data?.greeting_config?.greeting_config;Array.isArray(a)&&(k.value=a.map(e=>({id:e.name,name:e.name,greetings:Array.isArray(e.greetings)?e.greetings:[]})))}catch(e){console.error("加载话术组失败:",e),i.nk.error("加载话术组失败")}},I=async()=>{try{const e=await(0,ea.zj)("reply_strategy_v2");e?.success&&e?.data&&(p.value=e.data.staffList||[],e.data.commonConfig&&(g.value={groupAtOnly:e.data.commonConfig.groupAtOnly||!1,colleagueNamesToIgnore:e.data.commonConfig.colleagueNamesToIgnore||"",filterWords:e.data.commonConfig.filterWords||[],autoGreeting:{enabled:e.data.commonConfig.autoGreeting?.enabled||!1,greetingGroupId:e.data.commonConfig.autoGreeting?.greetingGroupId||""},fileRecognition:{enabled:e.data.commonConfig.fileRecognition?.enabled||!1,fileTypes:e.data.commonConfig.fileRecognition?.fileTypes||[],filePath:e.data.commonConfig.fileRecognition?.filePath||""},whitelist:{enabled:e.data.commonConfig.whitelist?.enabled||!1,names:e.data.commonConfig.whitelist?.names||"",list:e.data.commonConfig.whitelist?.list||[]}}))}catch(e){console.error("加载配置失败:",e),i.nk.error("加载配置失败")}},R=async()=>{try{if(g.value.fileRecognition.enabled){if(0===g.value.fileRecognition.fileTypes.length)return void i.nk.error("请至少选择一种文件类型");if(!g.value.fileRecognition.filePath.trim())return void i.nk.error("请输入文件目录路径")}if(g.value.autoGreeting.enabled&&!g.value.autoGreeting.greetingGroupId)return void i.nk.error("请选择自动打招呼话术组");if(g.value.whitelist.enabled&&!g.value.whitelist.names?.trim())return void i.nk.error("请先输入白名单");if(g.value.whitelist.enabled){const e=g.value.whitelist.names.split("//").map(e=>e.trim()).filter(e=>e);g.value.whitelist.list=e}else g.value.whitelist.list=[];const e={staffList:p.value,commonConfig:g.value},a=await(0,ea.ql)("reply_strategy_v2",e);a?.success?(i.nk.success("保存成功"),u("save")):i.nk.error("保存失败")}catch(e){console.error("保存配置失败:",e),i.nk.error("保存配置失败")}},T=e=>{switch(e){case"single":return"success";case"group":return"info";default:return"info"}},V=()=>{y.value=!0,(0,n.dY)(()=>{_.value?.focus()})},x=()=>{b.value.trim()&&(g.value.filterWords.includes(b.value.trim())||(g.value.filterWords.push(b.value.trim()),R())),y.value=!1,b.value=""},A=e=>{g.value.filterWords.splice(e,1),R()},W=()=>{p.value.length>=5?i.nk.warning("目前最多支持添加5名AI助理"):(L.value=!1,F.value={id:Date.now().toString(),name:"",enabled:!0,agentId:"",chatType:"single",selectedTags:[],keywords:[],readGroupMember:!1},w.value=!0)},S=e=>{L.value=!0,F.value=JSON.parse(JSON.stringify(p.value[e])),C.value=e,w.value=!0},K=e=>{p.value.splice(e,1),R()},X=e=>{L.value&&-1!==C.value?p.value[C.value]=e:p.value.push(e),w.value=!1,R()},$=e=>{switch(e){case"single":return"单聊";case"group":return"群聊";case"all":return"全部";default:return e}},U=e=>{if(0===e.length)return"";const a=e.map(e=>{const a=h.value.find(a=>a.id===e);return a?a.name:e});return a.length<=2?a.join("、"):`${a[0]}、${a[1]}等${a.length}个标签`};return(e,a)=>{const l=(0,n.g2)("el-alert"),i=(0,n.g2)("el-icon"),u=(0,n.g2)("el-button"),C=(0,n.g2)("el-empty"),E=(0,n.g2)("el-tag"),I=(0,n.g2)("el-switch"),j=(0,n.g2)("el-tooltip"),D=(0,n.g2)("el-option"),P=(0,n.g2)("el-select"),z=(0,n.g2)("el-checkbox"),M=(0,n.g2)("el-input"),N=(0,n.g2)("el-checkbox-group"),O=(0,n.g2)("el-collapse-item"),G=(0,n.g2)("el-collapse"),q=(0,n.g2)("el-dialog");return(0,n.uX)(),(0,n.CE)(n.FK,null,[(0,n.bF)(q,{modelValue:d.value,"onUpdate:modelValue":a[12]||(a[12]=e=>d.value=e),width:t.value<=700?"95%":"700px"},{header:(0,n.k6)(()=>[...a[14]||(a[14]=[(0,n.Lk)("div",{class:"dialog-header"},[(0,n.Lk)("span",{class:"dialog-title"},"AI助理配置")],-1)])]),footer:(0,n.k6)(()=>[(0,n.Lk)("div",Ga,[(0,n.bF)(u,{onClick:a[11]||(a[11]=e=>d.value=!1)},{default:(0,n.k6)(()=>[...a[34]||(a[34]=[(0,n.eW)("取消",-1)])]),_:1}),(0,n.bF)(u,{type:"primary",onClick:R},{default:(0,n.k6)(()=>[...a[35]||(a[35]=[(0,n.eW)("保存配置",-1)])]),_:1})])]),default:(0,n.k6)(()=>[(0,n.bF)(l,{type:"info","show-icon":"",closable:!1,style:{"margin-bottom":"10px"}},{default:(0,n.k6)(()=>[...a[15]||(a[15]=[(0,n.Lk)("span",null,"向托管微信的“文件传输助手”发送指令，可以实现手机远程关闭或启用AI助理，详见操作指南说明",-1)])]),_:1}),(0,n.Lk)("div",ka,[(0,n.Lk)("div",ha,[(0,n.Lk)("div",fa,[a[17]||(a[17]=(0,n.Lk)("div",{class:"title-group"},[(0,n.Lk)("h3",null,"AI助理配置"),(0,n.Lk)("p",{class:"description"},"配置不同场景下的AI助理")],-1)),(0,n.bF)(u,{type:"primary",size:"small",onClick:W,class:"add-staff-btn",round:"",disabled:p.value.length>=5},{default:(0,n.k6)(()=>[(0,n.bF)(i,null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(r.Plus))]),_:1}),a[16]||(a[16]=(0,n.Lk)("span",null,"AI助理",-1))]),_:1},8,["disabled"])]),(0,n.Lk)("div",ya,[0===p.value.length?((0,n.uX)(),(0,n.Wv)(C,{key:0,description:"暂未配置AI助理"})):((0,n.uX)(!0),(0,n.CE)(n.FK,{key:1},(0,n.pI)(p.value,(e,a)=>((0,n.uX)(),(0,n.CE)("div",{class:"staff-item",key:a},[(0,n.Lk)("div",ba,[(0,n.Lk)("div",_a,[(0,n.Lk)("img",{src:"/icon/ai_assistant.svg",style:(0,s.Tr)({filter:"single"===e.chatType?"invert(43%) sepia(94%) saturate(1752%) hue-rotate(190deg) brightness(97%) contrast(96%)":"none"})},null,4)]),(0,n.Lk)("div",wa,[(0,n.Lk)("div",La,(0,s.v_)(e.name),1),(0,n.Lk)("div",Fa,[(0,n.bF)(E,{size:"small",type:T(e.chatType)},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)($(e.chatType)),1)]),_:2},1032,["type"]),e.selectedTags.length>0?((0,n.uX)(),(0,n.Wv)(E,{key:0,size:"small",type:"success"},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(U(e.selectedTags)),1)]),_:2},1024)):(0,n.Q3)("",!0)])])]),(0,n.Lk)("div",Ca,[(0,n.bF)(j,{content:e.enabled?"AI助理已启用":"AI助理未启用",placement:"top",effect:"light"},{default:(0,n.k6)(()=>[(0,n.bF)(I,{modelValue:e.enabled,"onUpdate:modelValue":a=>e.enabled=a,onChange:R},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["content"]),(0,n.bF)(u,{type:"primary",text:"",onClick:e=>S(a)},{default:(0,n.k6)(()=>[(0,n.bF)(i,null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(r.Edit))]),_:1})]),_:1},8,["onClick"]),(0,n.bF)(u,{type:"danger",text:"",onClick:e=>K(a)},{default:(0,n.k6)(()=>[(0,n.bF)(i,null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(r.Delete))]),_:1})]),_:1},8,["onClick"])])]))),128))])]),(0,n.Lk)("div",Ea,[(0,n.bF)(G,{modelValue:m.value,"onUpdate:modelValue":a[10]||(a[10]=e=>m.value=e)},{default:(0,n.k6)(()=>[(0,n.bF)(O,{title:"通用配置（修改完后记得点保存）",name:"common"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",Ia,[(0,n.Lk)("div",Ra,[a[18]||(a[18]=(0,n.Lk)("div",null,[(0,n.Lk)("h3",null,"自动打招呼"),(0,n.Lk)("p",{class:"description"},"当检测到对方通过了你的好友申请后，则自动发送话术组内容")],-1)),(0,n.bF)(I,{modelValue:g.value.autoGreeting.enabled,"onUpdate:modelValue":a[0]||(a[0]=e=>g.value.autoGreeting.enabled=e)},null,8,["modelValue"])]),g.value.autoGreeting.enabled?((0,n.uX)(),(0,n.CE)("div",Ta,[(0,n.bF)(P,{modelValue:g.value.autoGreeting.greetingGroupId,"onUpdate:modelValue":a[1]||(a[1]=e=>g.value.autoGreeting.greetingGroupId=e),placeholder:"选择话术组",class:"greeting-select",onChange:R},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(k.value,e=>((0,n.uX)(),(0,n.Wv)(D,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])):(0,n.Q3)("",!0)]),(0,n.Lk)("div",Va,[a[21]||(a[21]=(0,n.Lk)("h3",null,"群聊配置",-1)),a[22]||(a[22]=(0,n.Lk)("p",{class:"description"},"设置群聊中的回复行为和忽略规则",-1)),(0,n.Lk)("div",xa,[(0,n.bF)(z,{modelValue:g.value.groupAtOnly,"onUpdate:modelValue":a[2]||(a[2]=e=>g.value.groupAtOnly=e)},{default:(0,n.k6)(()=>[...a[19]||(a[19]=[(0,n.eW)("群聊被@时才回复",-1)])]),_:1},8,["modelValue"])]),(0,n.Lk)("div",Aa,[(0,n.bF)(M,{modelValue:g.value.colleagueNamesToIgnore,"onUpdate:modelValue":a[3]||(a[3]=e=>g.value.colleagueNamesToIgnore=e),placeholder:"录入群聊同事名单，会自动忽略群中同事的消息",clearable:""},null,8,["modelValue"]),a[20]||(a[20]=(0,n.Lk)("p",{class:"el-form-item__hint",style:{"font-size":"12px",color:"#909399","line-height":"1.5","margin-top":"5px"}},' 多个同事名单用双斜杠"//"分隔开，输入后自动保存。 ',-1))])]),(0,n.Lk)("div",Wa,[(0,n.Lk)("div",Sa,[a[23]||(a[23]=(0,n.Lk)("div",null,[(0,n.Lk)("h3",null,"白名单"),(0,n.Lk)("p",{class:"description"},"开启后，仅回复白名单中的好友或群聊")],-1)),(0,n.bF)(I,{modelValue:g.value.whitelist.enabled,"onUpdate:modelValue":a[4]||(a[4]=e=>g.value.whitelist.enabled=e)},null,8,["modelValue"])]),g.value.whitelist.enabled?((0,n.uX)(),(0,n.CE)("div",Ka,[(0,n.bF)(M,{modelValue:g.value.whitelist.names,"onUpdate:modelValue":a[5]||(a[5]=e=>g.value.whitelist.names=e),type:"textarea",rows:3,placeholder:'输入好友昵称或群名并用双斜杠"//"隔开，如：张三//测试一群'},null,8,["modelValue"]),a[24]||(a[24]=(0,n.Lk)("p",{class:"input-tip"},'输入好友昵称或群名并用双斜杠"//"隔开，如：张三//测试一群',-1))])):(0,n.Q3)("",!0)]),(0,n.Lk)("div",Xa,[(0,n.Lk)("div",$a,[a[26]||(a[26]=(0,n.Lk)("div",{class:"title-group"},[(0,n.Lk)("h3",null,"回复过滤词"),(0,n.Lk)("p",{class:"description"},"AI生成的回复中包含过滤词（全匹配）时，将不会发送给用户")],-1)),(0,n.bF)(u,{type:"primary",size:"small",onClick:V,disabled:g.value.filterWords.length>=5},{default:(0,n.k6)(()=>[...a[25]||(a[25]=[(0,n.eW)(" 添加过滤词 ",-1)])]),_:1},8,["disabled"])]),(0,n.Lk)("div",Ua,[(0,n.Lk)("div",ja,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(g.value.filterWords,(e,a)=>((0,n.uX)(),(0,n.Wv)(E,{key:a,closable:"",onClose:e=>A(a)},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(e),1)]),_:2},1032,["onClose"]))),128)),y.value?((0,n.uX)(),(0,n.Wv)(M,{key:0,ref_key:"filterWordInputRef",ref:_,modelValue:b.value,"onUpdate:modelValue":a[6]||(a[6]=e=>b.value=e),class:"keyword-input",size:"small",onKeyup:(0,Se.jR)(x,["enter"]),onBlur:x},null,8,["modelValue"])):(0,n.Q3)("",!0)])])]),(0,n.Lk)("div",Da,[(0,n.Lk)("div",Pa,[a[27]||(a[27]=(0,n.Lk)("div",null,[(0,n.Lk)("h3",null,"识别文件"),(0,n.Lk)("p",{class:"description"},"开启后可以识别消息的文件并上传到Coze")],-1)),(0,n.bF)(I,{modelValue:g.value.fileRecognition.enabled,"onUpdate:modelValue":a[7]||(a[7]=e=>g.value.fileRecognition.enabled=e)},null,8,["modelValue"])]),g.value.fileRecognition.enabled?((0,n.uX)(),(0,n.CE)("div",za,[(0,n.Lk)("div",Ma,[a[32]||(a[32]=(0,n.Lk)("h4",null,"文件类型",-1)),(0,n.bF)(N,{modelValue:g.value.fileRecognition.fileTypes,"onUpdate:modelValue":a[8]||(a[8]=e=>g.value.fileRecognition.fileTypes=e)},{default:(0,n.k6)(()=>[(0,n.bF)(z,{label:"word"},{default:(0,n.k6)(()=>[...a[28]||(a[28]=[(0,n.eW)("Word",-1)])]),_:1}),(0,n.bF)(z,{label:"pdf"},{default:(0,n.k6)(()=>[...a[29]||(a[29]=[(0,n.eW)("PDF",-1)])]),_:1}),(0,n.bF)(z,{label:"excel"},{default:(0,n.k6)(()=>[...a[30]||(a[30]=[(0,n.eW)("Excel",-1)])]),_:1}),(0,n.bF)(z,{label:"image"},{default:(0,n.k6)(()=>[...a[31]||(a[31]=[(0,n.eW)("图片",-1)])]),_:1})]),_:1},8,["modelValue"])]),(0,n.Lk)("div",Na,[(0,n.Lk)("div",Oa,[a[33]||(a[33]=(0,n.Lk)("h4",null,"文件目录",-1)),(0,n.bF)(j,{effect:"dark",content:"示例：D:\\ProgramData\\tencent_cache\\WeChat Files\\ABC123，注意！！最后一个目录一定是当前登录的微信号",placement:"top"},{default:(0,n.k6)(()=>[(0,n.bF)(i,null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(r.QuestionFilled))]),_:1})]),_:1})]),(0,n.bF)(M,{modelValue:g.value.fileRecognition.filePath,"onUpdate:modelValue":a[9]||(a[9]=e=>g.value.fileRecognition.filePath=e),placeholder:"请输入微信文件夹路径",onChange:R},null,8,["modelValue"])])])):(0,n.Q3)("",!0)])]),_:1})]),_:1},8,["modelValue"])])])]),_:1},8,["modelValue","width"]),(0,n.bF)(ga,{visible:w.value,"onUpdate:visible":a[13]||(a[13]=e=>w.value=e),staff:F.value,"is-edit":L.value,"coze-agents":c.cozeAgents,"contact-tags":h.value,"group-tags":f.value,"has-group-staff":v.value,onSave:X},null,8,["visible","staff","is-edit","coze-agents","contact-tags","group-tags","has-group-staff"])],64)}}}),Ja=(0,S.A)(qa,[["__scopeId","data-v-1f3f8f1c"]]),Ba=Ja,Qa={class:"error-dialog-content"},Ha={class:"error-header"},Ya={class:"error-title"},Za={class:"error-body"},et={class:"error-message-box"},at={class:"main-content"},tt={key:0,class:"error-detail-wrapper"},lt={class:"error-detail-text"},nt={class:"error-footer"},st=(0,n.pM)({__name:"CommonErrorDialog",props:{visible:{type:Boolean},title:{},content:{},errorDetail:{}},emits:["update:visible","close"],setup(e,{emit:a}){const t=e,l=a,c=(0,n.EW)({get:()=>t.visible,set:e=>l("update:visible",e)}),u=()=>{c.value=!1,l("close")},d=async()=>{if(t.errorDetail)try{await navigator.clipboard.writeText(t.errorDetail),i.nk.success("错误信息已复制")}catch(e){console.error("复制失败:",e),i.nk.error("复制失败")}};return(a,t)=>{const l=(0,n.g2)("el-icon"),i=(0,n.g2)("el-button"),v=(0,n.g2)("el-dialog");return(0,n.uX)(),(0,n.Wv)(v,{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=e=>c.value=e),"show-close":!1,width:"420px",class:"common-error-dialog",center:"","align-center":"","destroy-on-close":""},{header:(0,n.k6)(()=>[...t[1]||(t[1]=[(0,n.Lk)("div",{class:"my-header"},null,-1)])]),default:(0,n.k6)(()=>[(0,n.Lk)("div",Qa,[(0,n.Lk)("div",Ha,[(0,n.bF)(l,{class:"error-icon",size:48,color:"#F56C6C"},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(r.WarningFilled))]),_:1}),(0,n.Lk)("h3",Ya,(0,s.v_)(e.title),1)]),(0,n.Lk)("div",Za,[(0,n.Lk)("div",et,[(0,n.Lk)("p",at,(0,s.v_)(e.content),1),e.errorDetail?((0,n.uX)(),(0,n.CE)("div",tt,[t[2]||(t[2]=(0,n.Lk)("p",{class:"error-detail-title"},"报错详情：",-1)),(0,n.Lk)("p",lt,(0,s.v_)(e.errorDetail),1)])):(0,n.Q3)("",!0)])]),(0,n.Lk)("div",nt,[e.errorDetail?((0,n.uX)(),(0,n.Wv)(i,{key:0,onClick:d,class:"copy-btn",size:"large"},{default:(0,n.k6)(()=>[...t[3]||(t[3]=[(0,n.eW)("复制错误",-1)])]),_:1})):(0,n.Q3)("",!0),(0,n.bF)(i,{type:"primary",onClick:u,class:"close-btn",size:"large"},{default:(0,n.k6)(()=>[...t[4]||(t[4]=[(0,n.eW)("关闭",-1)])]),_:1})])])]),_:1},8,["modelValue"])}}}),ot=(0,S.A)(st,[["__scopeId","data-v-c1ada4e4"]]),it=ot;var rt,ct,ut=t(1576),dt=t.n(ut);(function(e){e["PENDING"]="pending",e["PROCESSING"]="processing",e["COMPLETED"]="completed",e["FAILED"]="failed",e["CANCELLED"]="cancelled"})(rt||(rt={})),function(e){e[e["LOW"]=1]="LOW",e[e["MEDIUM"]=2]="MEDIUM",e[e["HIGH"]=3]="HIGH",e[e["URGENT"]=4]="URGENT",e[e["CRITICAL"]=5]="CRITICAL"}(ct||(ct={}));class vt{tasks=(0,o.KR)([]);taskLogs=(0,o.KR)([]);messageNumLock=(0,o.KR)(!1);lastAutoReplies=new Map;constructor(){this.loadTaskLogs()}maxConcurrent=1;processing=(0,o.KR)(new Set);getQueueLength(){const e=this.tasks.value.filter(e=>e.status===rt.PENDING||e.status===rt.PROCESSING).length;return console.log("当前队列任务数量:",e),e}sortedTasks=(0,n.EW)(()=>[...this.tasks.value].sort((e,a)=>a.priority!==e.priority?a.priority-e.priority:e.createTime-a.createTime));async loadTaskLogs(){try{const e=await fetch("/api/chat/logs",{headers:ea.b3}),a=await e.json();a.success&&(this.taskLogs.value=a.logs.map(e=>({timestamp:new Date(e.timestamp),targetName:e.targetName||e.session_name,content:e.content,status:e.status,error:e.error,chatType:e.chatType||(e.content?.includes("：")?"group":"single")})),this.taskLogs.value.sort((e,a)=>a.timestamp.getTime()-e.timestamp.getTime()))}catch(e){console.error("加载日志失败:",e)}}markTaskAsCancelled(e,a="回复内容被过滤"){const t=this.tasks.value.find(a=>a.id===e);t&&(t.status=rt.CANCELLED,t.lastError=a,t.messageNum=0,console.log("取消任务",t.content))}addTask(e){const a=()=>this.messageNumLock.value?new Promise(e=>setTimeout(()=>e(a()),10)):Promise.resolve();a().then(()=>{try{this.messageNumLock.value=!0;const a=this.tasks.value.find(a=>a.userName===e.userName&&a.status===rt.PENDING);if(a)a.messageNum=(a.messageNum||0)+1,console.log(`更新任务消息数 - ${e.userName}: ${a.messageNum}`);else{const a={...e,id:`task_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createTime:Date.now(),status:rt.PENDING,retryCount:0,messageNum:1};this.tasks.value.push(a),console.log(`添加新任务 - ${e.userName}: 消息数 1`),this.processNextTask()}}finally{this.messageNumLock.value=!1}})}getNextTask(){return this.sortedTasks.value.find(e=>e.status===rt.PENDING||e.status===rt.FAILED&&e.retryCount<3)}async processNextTask(){if(this.processing.value.size>=this.maxConcurrent)return;const e=this.getNextTask();if(e){this.processing.value.add(e.id),e.status=rt.PROCESSING,e.startTime=Date.now();try{await this.processTask(e),e.status=rt.COMPLETED,e.endTime=Date.now(),e.messageNum=0;const a=e.content.includes("：")||e.isGroup;console.log("任务：消息发送成功"),this.addTaskLog({timestamp:new Date,targetName:e.userName,content:e.content,status:"completed",chatType:a?"group":"single"})}catch(a){const t=a;console.error("任务：消息发送失败",t.message),e.status=rt.FAILED,e.lastError=t.message,e.retryCount++,e.retryCount>=3&&(e.messageNum=0,this.addTaskLog({timestamp:new Date,targetName:e.userName,content:e.content,status:"failed",error:t.message,chatType:e.isGroup?"group":"single"}))}finally{this.processing.value.delete(e.id),this.processNextTask()}}}async addTaskLog(e){try{const a=await fetch("/api/chat/logs",{method:"POST",headers:ea.b3,body:JSON.stringify(e)});a.ok&&(this.taskLogs.value.unshift(e),this.taskLogs.value.length>100&&(this.taskLogs.value=this.taskLogs.value.slice(0,100)))}catch(a){console.error("保存日志失败:",a)}}getTaskLogs(){return this.taskLogs.value}cleanOldLogs(){const e=Date.now()-864e5;this.taskLogs.value=this.taskLogs.value.filter(a=>a.timestamp.getTime()>e)}taskHandler;setTaskHandler(e){this.taskHandler=e}async processTask(e){if(!this.taskHandler)throw new Error("Task handler not set");await this.taskHandler(e)}hasDuplicateTask(e,a){return this.tasks.value.some(t=>t.userName===e&&t.isGroup===a&&t.status===rt.PENDING)}getTaskMessageNum(e){const a=this.tasks.value.find(a=>a.userName===e);return a?.messageNum||0}getTaskStatus(e){const a=this.tasks.value.find(a=>a.id===e);return a?.status}cancelTask(e){const a=this.tasks.value.find(a=>a.id===e);return!(!a||a.status!==rt.PENDING)&&(a.status=rt.FAILED,a.lastError="Task cancelled",!0)}cleanCompletedTasks(){this.tasks.value=this.tasks.value.filter(e=>e.status!==rt.COMPLETED)}getQueueStats(){const e={total:this.tasks.value.length,pending:0,processing:0,completed:0,failed:0,cancelled:0};return this.tasks.value.forEach(a=>{e[a.status]++}),e}recordAutoReply(e,a){console.log(),this.lastAutoReplies.set(e,a)}isAutoReplyMessage(e,a){const t=this.lastAutoReplies.get(e);return t===a}}const mt=new vt,pt=(0,n.pM)({__name:"ReplyLogDialog",props:{visible:{type:Boolean}},emits:["update:visible"],setup(e,{emit:a}){const t=(0,o.KR)(window.innerWidth),l=e,i=()=>{t.value=window.innerWidth},r=async()=>{await mt.loadTaskLogs()},c=a,u=(0,n.EW)({get:()=>l.visible,set:e=>c("update:visible",e)}),d=()=>{r(),console.log("对话框打开后的日志数据:",v.value)},v=(0,n.EW)(()=>mt.getTaskLogs());(0,n.sV)(()=>{r(),window.addEventListener("resize",i)}),(0,n.hi)(()=>{window.removeEventListener("resize",()=>{t.value=window.innerWidth})});const m=e=>dt()(e).format("MM-DD HH:mm:ss");return(e,a)=>{const l=(0,n.g2)("el-table-column"),o=(0,n.g2)("el-tag"),i=(0,n.g2)("el-table"),r=(0,n.g2)("el-dialog");return(0,n.uX)(),(0,n.Wv)(r,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=e=>u.value=e),title:"自动回复日志",width:(t.value,"95%"),onOpen:d},{default:(0,n.k6)(()=>[(0,n.bF)(i,{data:v.value,style:{width:"100%"},"max-height":"500px"},{default:(0,n.k6)(()=>[(0,n.bF)(l,{prop:"timestamp",label:"时间",width:"120"},{default:(0,n.k6)(({row:e})=>[(0,n.eW)((0,s.v_)(m(e.timestamp)),1)]),_:1}),(0,n.bF)(l,{prop:"targetName",label:"用户",width:"80"}),(0,n.bF)(l,{prop:"chatType",label:"类型",width:"70"},{default:(0,n.k6)(({row:e})=>[(0,n.bF)(o,{size:"small",type:"group"===e.chatType?"warning":"info"},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)("group"===e.chatType?"群聊":"私聊"),1)]),_:2},1032,["type"])]),_:1}),(0,n.bF)(l,{prop:"content",label:"AI回复","show-overflow-tooltip":""}),(0,n.bF)(l,{prop:"status",label:"状态",width:"70"},{default:(0,n.k6)(({row:e})=>[(0,n.bF)(o,{type:"completed"===e.status?"success":"danger",size:"small"},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)("completed"===e.status?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue","width"])}}}),gt=(0,S.A)(pt,[["__scopeId","data-v-e65364e8"]]),kt=gt,ht={class:"stat-card"},ft={class:"stat-content"},yt={class:"stat-number"},bt={class:"stat-card"},_t={class:"stat-content"},wt={class:"stat-number"},Lt={class:"stat-card"},Ft={class:"stat-content"},Ct={class:"stat-number"},Et={class:"stat-trend"},It=(0,n.pM)({__name:"StatsPanel",props:{expanded:{type:Boolean},stats:{}},setup(e){return(a,t)=>((0,n.uX)(),(0,n.CE)("div",{class:(0,s.C4)(["stats-grid",{expanded:e.expanded}])},[(0,n.Lk)("div",ht,[(0,n.Lk)("div",ft,[(0,n.Lk)("div",yt,(0,s.v_)(e.stats.sessionCount),1),t[0]||(t[0]=(0,n.Lk)("div",{class:"stat-label"},"服务用户数",-1)),(0,n.Lk)("div",{class:(0,s.C4)(["stat-trend",{"trend-up":e.stats.sessionIncrease>=0,"trend-down":e.stats.sessionIncrease<0}])},(0,s.v_)(e.stats.sessionIncrease>=0?"↗️":"↘️")+" "+(0,s.v_)(e.stats.sessionIncrease>=0?"+":"")+(0,s.v_)(e.stats.sessionIncrease)+"% 昨日 ",3)])]),(0,n.Lk)("div",bt,[(0,n.Lk)("div",_t,[(0,n.Lk)("div",wt,(0,s.v_)(e.stats.messageCount),1),t[1]||(t[1]=(0,n.Lk)("div",{class:"stat-label"},"自动回复数",-1)),(0,n.Lk)("div",{class:(0,s.C4)(["stat-trend",{"trend-up":e.stats.messageIncrease>=0,"trend-down":e.stats.messageIncrease<0}])},(0,s.v_)(e.stats.messageIncrease>=0?"↗️":"↘️")+" "+(0,s.v_)(e.stats.messageIncrease>=0?"+":"")+(0,s.v_)(e.stats.messageIncrease)+"% 昨日 ",3)])]),(0,n.Lk)("div",Lt,[(0,n.Lk)("div",Ft,[(0,n.Lk)("div",Ct,(0,s.v_)(e.stats.savedHours),1),t[2]||(t[2]=(0,n.Lk)("div",{class:"stat-label"},"节省工时(小时)",-1)),(0,n.Lk)("div",Et," 💰 约节省 ¥"+(0,s.v_)(e.stats.savedMoney),1)])])],2))}}),Rt=(0,S.A)(It,[["__scopeId","data-v-28885b0a"]]),Tt=Rt,Vt={class:"info-text"},xt={class:"account-status-content"},At={class:"account-list"},Wt={class:"account-header"},St={class:"account-info"},Kt={class:"account-label"},Xt={class:"account-id"},$t={class:"account-nickname"},Ut={class:"status-list"},jt={class:"status-item"},Dt={class:"status-item"},Pt={class:"dialog-footer"},zt=(0,n.pM)({__name:"AccountStatusDialog",props:{visible:{type:Boolean},accountList:{}},emits:["update:visible","confirm"],setup(e,{emit:a}){const t=e,l=a,o=(0,n.EW)({get:()=>t.visible,set:e=>l("update:visible",e)}),i=e=>{const a=e.sync_status.error||e.ai_status.error;return a?"异常账号":"正常账号"},r=()=>{l("confirm"),l("update:visible",!1)};return(a,t)=>{const l=(0,n.g2)("el-alert"),c=(0,n.g2)("el-button"),u=(0,n.g2)("el-dialog");return(0,n.uX)(),(0,n.Wv)(u,{modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=e=>o.value=e),title:"AI自动回复检查项提醒",width:"600px","close-on-click-modal":!1,class:"account-status-dialog"},{default:(0,n.k6)(()=>[(0,n.bF)(l,{type:"info","show-icon":"",closable:!1,class:"status-info-banner"},{default:(0,n.k6)(()=>[(0,n.Lk)("span",Vt,"检测到已登录 "+(0,s.v_)(e.accountList.length)+" 个账号，请按指引完善配置后，重新开启自动回复",1)]),_:1}),(0,n.Lk)("div",xt,[(0,n.Lk)("div",At,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(e.accountList,e=>((0,n.uX)(),(0,n.CE)("div",{key:e.account_id,class:"account-item"},[(0,n.Lk)("div",Wt,[(0,n.Lk)("div",St,[(0,n.Lk)("span",Kt,(0,s.v_)(i(e))+"：",1),(0,n.Lk)("span",Xt,(0,s.v_)(e.account_id),1),(0,n.Lk)("span",$t,"("+(0,s.v_)(e.nickname)+")",1)])]),(0,n.Lk)("div",Ut,[(0,n.Lk)("div",jt,[(0,n.Lk)("span",{class:(0,s.C4)(["status-text",{"error-text":e.sync_status.error}])},(0,s.v_)(e.sync_status.message),3)]),(0,n.Lk)("div",Dt,[(0,n.Lk)("span",{class:(0,s.C4)(["status-text",{"error-text":e.ai_status.error}])},(0,s.v_)(e.ai_status.message),3)])])]))),128))]),(0,n.Lk)("div",Pt,[(0,n.bF)(c,{type:"primary",class:"confirm-button",onClick:r},{default:(0,n.k6)(()=>[...t[1]||(t[1]=[(0,n.eW)(" 好的 ",-1)])]),_:1})])])]),_:1},8,["modelValue"])}}}),Mt=(0,S.A)(zt,[["__scopeId","data-v-03049c1c"]]),Nt=Mt,Ot={class:"ai-chat-container"},Gt={class:"settings-bar"},qt={class:"settings-content"},Jt={class:"auto-reply-container"},Bt=["disabled"],Qt={class:"settings-right"},Ht={class:"main-content1"},Yt={class:"chat-list"},Zt={class:"chat-tabs"},el={class:"tab-header"},al={class:"tab-header-left"},tl={class:"tab-title"},ll={key:0,class:"status-indicator-chat"},nl={key:0,class:"account-header"},sl={class:"account-title"},ol=["onClick"],il={class:"avatar-wrapper"},rl={key:0,class:"unread-dot"},cl={class:"chat-info"},ul={class:"chat-header"},dl={class:"chat-title"},vl={class:"name-tag-container"},ml=["title"],pl={class:"chat-time"},gl=["title"],kl={key:0,class:"account-info"},hl={class:"account-id"},fl={class:"tab-header"},yl={class:"tab-header-left"},bl={class:"tab-title"},_l={key:1,class:"suspended-list"},wl=["onClick"],Ll={class:"avatar-wrapper"},Fl={class:"suspended-info"},Cl={class:"suspended-header"},El=["title"],Il={class:"suspended-time-row"},Rl={class:"suspended-time"},Tl={class:"account-info"},Vl={class:"account-id"},xl={class:"tab-header"},Al={key:0,class:"account-header"},Wl={class:"account-title"},Sl=["onClick"],Kl={class:"avatar-wrapper"},Xl={class:"chat-info"},$l={class:"chat-header"},Ul={class:"chat-title"},jl={class:"name-tag-container"},Dl=["title"],Pl={class:"chat-time"},zl=["title"],Ml={key:0,class:"account-info"},Nl={class:"account-id"},Ol={class:"current-chat-header"},Gl={class:"header-left"},ql={class:"user-name"},Jl={class:"messages",ref:"messageContainer"},Bl={key:0,class:"sender-name"},Ql={class:"voice-text"},Hl={class:"input-area"},Yl={class:"message-input-container"},Zl={class:"countdown-content"},en={class:"countdown-circle"},an={width:"40",height:"40",viewBox:"0 0 40 40"},tn=["stroke-dasharray"],ln={class:"countdown-number"},nn={class:"countdown-text"},sn={class:"countdown-subtitle"},on={class:"input-content"},rn={class:"input-footer"},cn={key:1,class:"empty-chat-container"},un=(0,n.pM)({__name:"AiChatNew",setup(e){const a=(0,l.rd)(),t=(0,o.KR)(!1),c=(0,o.KR)(!1),u=(0,o.KR)(!1),d=(0,o.KR)(""),v=(0,o.KR)(null),m=(0,o.KR)(!1),p=(0,o.KR)(!1),g=(0,o.KR)(!1),k=(0,o.KR)(""),h=(0,o.KR)(!0),f=(0,o.KR)(!1),y=(0,o.KR)(""),b=(0,o.KR)(!1),_=(0,o.KR)("none"),w=(0,o.KR)(!1),L=(0,o.KR)(!1),F=(0,o.KR)([]),C=(0,o.KR)([]),E=(0,o.KR)(!1),I=(0,o.KR)(window.innerWidth<600),R=(0,o.KR)(!1),T=(0,o.KR)("recent"),V=(0,o.KR)(null),x=(0,o.KR)(null),A=(0,o.KR)(null),W=(0,o.KR)(0),S=(0,o.KR)(!1),K=(0,o.KR)(!1),X=(0,o.KR)([]),$=(0,o.KR)(!1),U=(0,o.KR)(!1),j=(0,o.KR)(!1),D=(0,o.KR)({}),P=(0,o.KR)([]),z=(0,o.KR)([]),M=(0,o.KR)({sessionCount:0,sessionIncrease:0,messageCount:0,messageIncrease:0,savedHours:0,savedMoney:0}),N=(0,n.EW)(()=>{const e={};return z.value.forEach(a=>{const t=a.account_id||"unknown",l=a.account_nickname||"未知账号";e[t]||(e[t]={nickname:l,sessions:[]}),a.unique_id=a.unique_id||`${t}_${a.name}`,e[t].sessions.push(a)}),e}),O=e=>{if(!e)return"";const a=new Date(1e3*e),t=(a.getMonth()+1).toString().padStart(2,"0"),l=a.getDate().toString().padStart(2,"0"),n=a.getHours().toString().padStart(2,"0"),s=a.getMinutes().toString().padStart(2,"0");return`${t}-${l} ${n}:${s}`},G=async()=>{$.value=!0;try{X.value=await je()}catch(k){console.error("刷新挂起列表失败:",k),i.nk.error("刷新挂起列表失败")}finally{$.value=!1}},q=e=>{Ke.s.confirm(`是否解除 ${e.session_name} 的挂起状态？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{const a=await De(e.session_name,e.account_id);a?(i.nk.success("解除挂起成功"),G()):i.nk.error("解除挂起失败")}).catch(()=>{})},J=async()=>{U.value=!0,j.value=!0;try{z.value=await Pe(),Object.keys(N.value).forEach(e=>{D.value[e]=!1})}catch(k){console.error("刷新历史会话失败:",k),i.nk.error("刷新历史会话失败")}finally{U.value=!1,j.value=!1}};(0,n.wB)(T,e=>{"history"===e&&0===z.value.length?J():"suspended"===e&&G()});const B=async e=>{const a="boolean"===typeof e?e:K.value;if(u.value)try{await He(a),i.nk.success(`已${a?"开启":"关闭"}人工复核`)}catch(k){console.error("更新人工复核状态失败:",k),i.nk.error("更新人工复核状态失败"),K.value=!a}},Q=new Map,H=new Map,Y=e=>{const{running:a}=e.detail;u.value=a},Z=()=>{const e=window.innerWidth<600;I.value!==e&&(I.value=e)},ee=e=>{const{status:a,session_name:t}=e.detail;"processing"===a?(y.value=t,L.value=!0):(y.value===t&&(y.value="",L.value=!1),"completed"===a&&te())},ae=e=>{const{sessions:a}=e.detail;if(Array.isArray(a)){const e=a.map(e=>({id:e.unique_id||e.id||Date.now(),name:e.name||"",avatar:e.avatar||"",lastMessage:e.lastMessage||"",lastTime:e.lastTime||"",unread:e.unread||0,isGroup:e.isGroup||!1,account_id:e.account_id||"",account_nickname:e.account_nickname||"",unique_id:e.unique_id||e.name})),t=F.value||[],l=[...t];e.forEach(e=>{const a=l.findIndex(a=>a.unique_id===e.unique_id||a.id===e.id);a>=0?l[a]=e:l.push(e)}),l.sort((e,a)=>{const t=new Date(e.lastTime||0).getTime(),l=new Date(a.lastTime||0).getTime();return l-t}),F.value=l}},te=async()=>{try{const e=await Me();M.value=e}catch(k){console.error("加载统计数据失败:",k)}},le=async()=>{R.value=!R.value,R.value&&await te()},ne=async()=>{try{const e=await Pe();z.value=e}catch(e){console.error("获取历史会话列表失败:",e)}},se=async e=>{if(v.value?.id!==e.id){v.value=e;try{C.value=[];const a=await ze(e.name,e.account_id),t=a.messages||[];Array.isArray(t)&&(C.value=t),await Fe()}catch(a){k.value="加载历史聊天记录失败",m.value=!1}}},oe=async()=>{try{const e=await Ye();e.success&&(u.value=e.data.running,void 0!==e.data.manual_review_enabled&&(K.value=e.data.manual_review_enabled))}catch(k){console.error("获取监控状态失败:",k)}},ie=e=>{xe(e)},re=(0,o.KR)(!1),ce=(0,o.KR)("智能体报错"),ue=(0,o.KR)(""),de=(0,o.KR)(""),ve=e=>{const a=e.detail;if("AI回复"===a.scene){const e=a.params||[],t=e[0]||"未知错误",l=e[1]||"未知会话",n=e[2]||"未知ID";ce.value="智能体报错",ue.value=`无法回复会话 ${l} 的消息，调用智能体 ${n} 时报错，请检查智能体配置。`,de.value=t,re.value=!0}};(0,n.sV)(async()=>{await me(),await oe(),window.addEventListener("monitor-status",Y),window.addEventListener("task-session",ee),window.addEventListener("session-list",ae),window.addEventListener("pending-reply",ie),window.addEventListener("error-task",ve),await(0,n.dY)(),Z(),window.addEventListener("resize",Z),requestAnimationFrame(()=>{h.value=!1})}),(0,n.hi)(()=>{window.removeEventListener("monitor-status",Y),window.removeEventListener("task-session",ee),window.removeEventListener("session-list",ae),window.removeEventListener("resize",Z),window.removeEventListener("pending-reply",ie),window.removeEventListener("error-task",ve),na()});const me=async()=>{try{const e=await(0,ea.zj)("agents");e.success&&e.data&&(P.value=Array.isArray(e.data)?e.data:e.data.agents||[],console.debug("加载到的智能体配置:",P.value))}catch(k){console.error("加载智能体配置失败:",k)}},pe=async()=>{if(v.value&&!g.value){g.value=!0;try{const{messages:e,chatType:a}=await Je(v.value.name,v.value.account_id);if("official_account"===a)return void i.nk.warning("公众号会话不支持查看消息");Array.isArray(e)&&(C.value=e),await Fe()}catch(k){console.error("刷新消息失败:",k),i.nk.error("刷新消息失败")}finally{g.value=!1}}},ge=()=>{c.value=!0},ke=async()=>{if(!E.value){E.value=!0;try{await Ve()}catch(k){console.error("刷新会话列表失败:",k),i.nk.error("刷新失败")}finally{E.value=!1}}},he=()=>{b.value=!0},fe=async()=>{if(v.value)if(v.value.lastMessage){w.value=!0;try{const e=await Qe({sessionId:v.value.id,content:v.value.lastMessage,userName:v.value.name,sessionName:v.value.name,isGroup:v.value.isGroup||!1,accountId:v.value.account_id});if(!e.success)throw new Error(e.error||"创建回复任务失败");"task_exists"===e.message?i.nk.warning("该会话已有AI回复任务正在处理中，请勿重复创建"):(i.nk.success("AI正在生成回复，请稍候..."),V.value=e.taskId)}catch(k){console.error("创建AI回复任务失败:",k),i.nk.error("创建AI回复任务失败")}finally{w.value=!1}}else i.nk.warning("没有找到可回复的用户消息");else i.nk.warning("请先选择聊天对象")},ye=async e=>{_.value=e},be=(0,o.KR)(!1),_e=(0,o.KR)([]),we=()=>{},Le=async e=>{if(e)try{const e=await Ne({manualReview:K.value});if("success"!==e.status)return"VALIDATION_FAILED"===e.code&&e.accounts?(_e.value=e.accounts,be.value=!0,void(u.value=!1)):(i.nk.error(e.message||"启动监控失败"),void(u.value=!1));i.nk.success(e.message||"自动回复已启动")}catch(k){if(k instanceof Error&&"string"===typeof k.message)try{const t=JSON.parse(k.message);if("SYNC_ERROR"===t.type)return void Ke.s.confirm(t.message,"提示",{confirmButtonText:"去同步",cancelButtonText:"取消",type:"warning"}).then(()=>{a.push("/mass-sending?tab=group")}).catch(()=>{u.value=!1})}catch{}return void(u.value=!1)}else{await Ge(),K.value=!1;try{await He(!1)}catch{}}},Fe=async()=>{await(0,n.dY)();const e=document.querySelector(".messages");e&&setTimeout(()=>{e.scrollTop=e.scrollHeight},100)};(0,n.wB)(()=>C.value,()=>{Fe()},{deep:!0}),(0,n.wB)(T,e=>{"history"===e?ne():"recent"===e&&Ve()}),(0,n.wB)(u,e=>{e||(K.value=!1)});const Ce=()=>{f.value=!0},Ee=()=>{Q.clear(),H.clear(),F.value=[],C.value=[]},Ie=async(e,a=!0)=>{if(v.value?.id===e.id)return{messages:C.value};v.value=e},Re=async e=>{if(v.value){d.value="";try{const a=await Be(v.value.name,e);console.debug("发送消息结果:",a),"success"===a.status?(console.debug("刷新消息列表，当前对话：",v),a.data?.messages&&Array.isArray(a.data.messages)&&(C.value=a.data.messages),await Fe()):k.value=a.message||"发送消息失败"}catch(a){k.value="发送消息失败"}}else i.nk.warning("请先选择聊天对象")},Te=async()=>{if(d.value.trim()){if(!t.value){t.value=!0;try{if(A.value&&(clearInterval(A.value),A.value=null),S.value=!1,x.value&&V.value)try{return await Oe({task_id:V.value,action:"confirm",final_content:d.value.trim()}),na(),void i.nk.success("回复已发送")}catch(k){return console.error("确认回复失败:",k),i.nk.error("发送失败"),S.value=!0,void Ze(W.value||30)}await Re(d.value)}catch(k){console.error("发送消息失败:",k),i.nk.error("发送失败")}finally{t.value=!1}}}else i.nk.warning("请输入消息内容")},Ve=async()=>{try{p.value&&Ee();const e=await qe(),a=e.map(e=>{const a={id:e.unique_id||e.id||Date.now(),name:e.name||"",avatar:e.avatar||"",lastMessage:e.lastMessage||"",lastTime:e.lastTime||"",unread:e.unread||0,isGroup:e.isGroup||!1,account_id:e.account_id||"",account_nickname:e.account_nickname||"",unique_id:e.unique_id||e.name};return a});return F.value=a,a}catch(k){return console.error("获取会话列表失败:",k),i.nk.error("获取会话列表失败"),[]}},xe=e=>{const a=e.detail;u.value&&"recent"!==T.value&&(T.value="recent"),console.debug("收到待确认回复:",a,F);const t=a.unique_id||`${a.account_id}_${a.session_name}`;let l=null;if("recent"===T.value?l=F.value.find(e=>e.unique_id===t||e.id===t):"history"===T.value&&(l=z.value.find(e=>e.unique_id===t||e.id===t)),!l)return console.warn(`未找到会话: ${a.session_name} (账号: ${a.account_id})`),void i.nk.warning(`未找到会话: ${a.session_name} (账号: ${a.account_id})`);"recent"===T.value?Ie(l,!1):"history"===T.value&&se(l),x.value={task_id:a.task_id,content:a.ai_reply,timeout:a.timeout},d.value=a.ai_reply||"",V.value=a.task_id,Ze(a.timeout||30),(0,i.nk)({message:`AI回复已生成，将在${a.timeout||30}秒后自动发送`,type:"success",duration:2e3})},Ae=(0,o.KR)(null),We=(0,n.EW)(()=>{if(W.value<=0)return 0;const e=x.value?.timeout||30,a=(e-W.value)/e*100;return Math.min(a,100)}),Xe=(0,n.EW)(()=>{const e=2*Math.PI*18,a=We.value,t=a/100*e;return`${t} ${e}`}),$e=(0,n.EW)(()=>{const e={};return F.value.forEach(a=>{const t=a.account_id||"默认账号";e[t]||(e[t]={sessions:[],lastTime:""}),e[t].sessions.push(a),(!e[t].lastTime||a.lastTime&&a.lastTime>e[t].lastTime)&&(e[t].lastTime=a.lastTime||"")}),Object.values(e).forEach(e=>{e.sessions.sort((e,a)=>{const t=new Date(e.lastTime||0).getTime(),l=new Date(a.lastTime||0).getTime();return l-t})}),e}),Ue=(0,n.EW)(()=>{const e={};return z.value.forEach(a=>{const t=a.account_id||"默认账号";e[t]||(e[t]={sessions:[],lastTime:""}),e[t].sessions.push(a),(!e[t].lastTime||a.lastTime&&a.lastTime>e[t].lastTime)&&(e[t].lastTime=a.lastTime||"")}),Object.values(e).forEach(e=>{e.sessions.sort((e,a)=>{const t=new Date(e.lastTime||0).getTime(),l=new Date(a.lastTime||0).getTime();return l-t})}),e}),Ze=e=>{W.value=e,S.value=!0,A.value=setInterval(()=>{W.value--,W.value<=5&&Ae.value&&Ae.value.classList.add("urgent"),W.value<=0&&(aa(),A.value&&(clearInterval(A.value),A.value=null),W.value=0)},1e3)},aa=async()=>{if(x.value)try{await Oe({task_id:x.value.task_id,action:"confirm",final_content:d.value}),na(),i.nk.success("回复已自动发送")}catch(k){console.error("自动发送失败:",k),i.nk.error("自动发送失败"),na()}},ta=async()=>{if(x.value)try{await Oe({task_id:x.value.task_id,action:"cancel"}),na(),i.nk.info("已取消AI回复任务")}catch(k){console.error("取消回复失败:",k),i.nk.error("取消回复失败")}},la=async()=>{if(d.value.trim())try{await navigator.clipboard.writeText(d.value),i.nk.success("内容已复制到剪贴板")}catch(k){console.error("复制失败:",k),i.nk.error("复制失败，请手动复制")}else i.nk.warning("输入框内容为空")},na=()=>{A.value&&(clearInterval(A.value),A.value=null),x.value=null,W.value=0,S.value=!1,d.value="",V.value=null};return(e,a)=>{const l=(0,n.g2)("el-switch"),i=(0,n.g2)("el-tooltip"),m=(0,n.g2)("el-button"),p=(0,n.g2)("el-tag"),k=(0,n.g2)("el-icon"),f=(0,n.g2)("el-empty"),_=(0,n.g2)("el-avatar"),V=(0,n.g2)("el-tab-pane"),x=(0,n.g2)("el-tabs"),A=(0,n.g2)("el-input");return(0,n.uX)(),(0,n.CE)("div",Ot,[(0,n.Lk)("div",Gt,[(0,n.Lk)("div",qt,[(0,n.Lk)("div",Jt,[(0,n.bF)(l,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=e=>u.value=e),class:"auto-reply-switch","active-text":"自动回复",onChange:Le},null,8,["modelValue"]),(0,n.bF)(i,{content:"勾选后，AI回复的内容等待人工确认后再发送",placement:"bottom",effect:"dark"},{default:(0,n.k6)(()=>[(0,n.Lk)("label",{class:(0,s.C4)(["cyberpunk-checkbox-label manual-review-top",{"is-disabled":!u.value}])},[(0,n.bo)((0,n.Lk)("input",{type:"checkbox","onUpdate:modelValue":a[1]||(a[1]=e=>K.value=e),disabled:!u.value,class:"cyberpunk-checkbox",onChange:a[2]||(a[2]=e=>B(K.value))},null,40,Bt),[[Se.lH,K.value]]),a[9]||(a[9]=(0,n.eW)(" 人工复核 ",-1))],2)]),_:1})]),(0,n.Lk)("div",Qt,[(0,n.bF)(m,{class:(0,s.C4)(["stats-btn",{active:R.value}]),onClick:le,size:"small"},{default:(0,n.k6)(()=>[...a[10]||(a[10]=[(0,n.Lk)("span",{class:(0,s.C4)({"rotate-icon":!0})}," 📊 ",-1),(0,n.eW)(" 数据统计 ",-1)])]),_:1},8,["class"]),(0,n.bF)(m,{class:"log-btn",onClick:ge,size:"small",type:"info",plain:""},{default:(0,n.k6)(()=>[...a[11]||(a[11]=[(0,n.eW)(" 📋 日志 ",-1)])]),_:1}),(0,n.bF)(m,{class:"setting-btn",onClick:he},{default:(0,n.k6)(()=>[...a[12]||(a[12]=[(0,n.eW)(" 🤖 AI助理配置 ",-1)])]),_:1})])]),(0,n.bF)(Tt,{expanded:R.value,stats:M.value},null,8,["expanded","stats"])]),(0,n.Lk)("div",Ht,[(0,n.Lk)("div",Yt,[(0,n.Lk)("div",Zt,[(0,n.bF)(x,{modelValue:T.value,"onUpdate:modelValue":a[3]||(a[3]=e=>T.value=e),class:"chat-tabs-container"},{default:(0,n.k6)(()=>[(0,n.bF)(V,{label:"最新",name:"recent"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",el,[(0,n.Lk)("div",al,[(0,n.Lk)("span",tl,(0,s.v_)(F.value.length)+" 条新会话",1),u.value?((0,n.uX)(),(0,n.CE)("div",ll,[(0,n.bF)(p,{type:"info",size:"small"},{default:(0,n.k6)(()=>[a[13]||(a[13]=(0,n.Lk)("span",{class:"dot-flashing"},null,-1)),(0,n.eW)(" "+(0,s.v_)(L.value?`回复 ${y.value} `:"运行中"),1)]),_:1})])):(0,n.Q3)("",!0)]),(0,n.bF)(m,{class:"refresh-icon-btn",loading:E.value,onClick:ke,size:"small",type:"primary",circle:""},{default:(0,n.k6)(()=>[(0,n.bF)(k,null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(r.Refresh))]),_:1})]),_:1},8,["loading"])]),0===F.value.length?((0,n.uX)(),(0,n.Wv)(f,{key:0,"image-size":120,description:"暂无新消息"})):((0,n.uX)(!0),(0,n.CE)(n.FK,{key:1},(0,n.pI)($e.value,(e,t)=>((0,n.uX)(),(0,n.CE)(n.FK,{key:t},[e.sessions.length>0?((0,n.uX)(),(0,n.CE)("div",nl,[(0,n.Lk)("span",sl,"账号："+(0,s.v_)(t||"默认账号"),1)])):(0,n.Q3)("",!0),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(e.sessions,e=>((0,n.uX)(),(0,n.CE)("div",{key:e.id,class:(0,s.C4)(["chat-item",{active:v.value?.id===e.id,unread:e?.unread&&e.unread>0}]),onClick:a=>Ie(e)},[(0,n.Lk)("div",il,[(0,n.bF)(_,{size:40,src:e.avatar,icon:(0,o.R1)(r.User)},null,8,["src","icon"]),e?.unread&&e.unread>0?((0,n.uX)(),(0,n.CE)("span",rl)):(0,n.Q3)("",!0)]),(0,n.Lk)("div",cl,[(0,n.Lk)("div",ul,[(0,n.Lk)("div",dl,[(0,n.Lk)("div",vl,[(0,n.Lk)("span",{class:"chat-name",title:e.name},(0,s.v_)(e.name),9,ml),e.isGroup?((0,n.uX)(),(0,n.Wv)(p,{key:0,size:"small",type:"info",class:"group-tag"},{default:(0,n.k6)(()=>[...a[14]||(a[14]=[(0,n.eW)("群聊",-1)])]),_:1})):(0,n.Q3)("",!0)]),(0,n.Lk)("span",pl,(0,s.v_)(e.lastTime),1)]),(0,n.Lk)("div",{class:"last-message",title:e.lastMessage},(0,s.v_)(e.lastMessage),9,gl),e.account_id?((0,n.uX)(),(0,n.CE)("div",kl,[a[15]||(a[15]=(0,n.Lk)("span",{class:"account-label"},"来自",-1)),(0,n.Lk)("span",hl,(0,s.v_)(e.account_id),1)])):(0,n.Q3)("",!0)])])],10,ol))),128))],64))),128))]),_:1}),(0,n.bF)(V,{label:"挂起",name:"suspended"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",fl,[(0,n.Lk)("div",yl,[(0,n.Lk)("span",bl,(0,s.v_)(X.value.length)+" 个挂起会话",1)])]),0===X.value.length?((0,n.uX)(),(0,n.Wv)(f,{key:0,"image-size":120},{description:(0,n.k6)(()=>[...a[16]||(a[16]=[(0,n.Lk)("span",null,"暂无挂起会话",-1),(0,n.Lk)("div",{style:{"margin-top":"2cap",padding:"0 20px","font-size":"12px",color:"#909399","line-height":"1.6"}},[(0,n.Lk)("br"),(0,n.eW)("手机端向文件传输助手发送“解除挂起”，可远程解除挂起会话 ")],-1)])]),_:1})):((0,n.uX)(),(0,n.CE)("div",_l,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(X.value,e=>((0,n.uX)(),(0,n.CE)("div",{key:`${e.account_id}_${e.session_name}`,class:"suspended-item",onClick:a=>q(e)},[(0,n.Lk)("div",Ll,[(0,n.bF)(_,{size:40,icon:(0,o.R1)(r.User)},null,8,["icon"])]),(0,n.Lk)("div",Fl,[(0,n.Lk)("div",Cl,[(0,n.Lk)("div",{class:"suspended-name",title:e.session_name},(0,s.v_)(e.session_name),9,El),(0,n.bF)(m,{type:"primary",link:"",size:"small",onClick:(0,Se.D$)(a=>q(e),["stop"])},{default:(0,n.k6)(()=>[...a[17]||(a[17]=[(0,n.eW)(" 解除 ",-1)])]),_:1},8,["onClick"])]),(0,n.Lk)("div",Il,[a[18]||(a[18]=(0,n.Lk)("span",{class:"time-label"},"挂起时间：",-1)),(0,n.Lk)("span",Rl,(0,s.v_)(O(e.suspended_at)),1)]),(0,n.Lk)("div",Tl,[a[19]||(a[19]=(0,n.Lk)("span",{class:"account-label"},"来自",-1)),(0,n.Lk)("span",Vl,(0,s.v_)(e.account_nickname||e.account_id),1)])])],8,wl))),128))]))]),_:1}),(0,n.bF)(V,{label:"历史",name:"history"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",xl,[(0,n.Lk)("span",null,(0,s.v_)(z.value.length)+" 条历史会话",1)]),0===z.value.length?((0,n.uX)(),(0,n.Wv)(f,{key:0,"image-size":120,description:"暂无历史会话"})):((0,n.uX)(!0),(0,n.CE)(n.FK,{key:1},(0,n.pI)(Ue.value,(e,t)=>((0,n.uX)(),(0,n.CE)(n.FK,{key:t},[e.sessions.length>0?((0,n.uX)(),(0,n.CE)("div",Al,[(0,n.Lk)("span",Wl,"账号："+(0,s.v_)(t||"默认账号"),1)])):(0,n.Q3)("",!0),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(e.sessions,e=>((0,n.uX)(),(0,n.CE)("div",{key:e.id,class:(0,s.C4)(["chat-item",{active:v.value?.id===e.id}]),onClick:a=>se(e)},[(0,n.Lk)("div",Kl,[(0,n.bF)(_,{size:40,src:e.avatar,icon:(0,o.R1)(r.User)},null,8,["src","icon"])]),(0,n.Lk)("div",Xl,[(0,n.Lk)("div",$l,[(0,n.Lk)("div",Ul,[(0,n.Lk)("div",jl,[(0,n.Lk)("span",{class:"chat-name",title:e.name},(0,s.v_)(e.name),9,Dl),e.isGroup?((0,n.uX)(),(0,n.Wv)(p,{key:0,size:"small",type:"info",class:"group-tag"},{default:(0,n.k6)(()=>[...a[20]||(a[20]=[(0,n.eW)("群聊",-1)])]),_:1})):(0,n.Q3)("",!0)]),(0,n.Lk)("span",Pl,(0,s.v_)(e.lastTime),1)]),(0,n.Lk)("div",{class:"last-message",title:e.lastMessage},(0,s.v_)(e.lastMessage),9,zl),e.account_id?((0,n.uX)(),(0,n.CE)("div",Ml,[a[21]||(a[21]=(0,n.Lk)("span",{class:"account-label"},"来自",-1)),(0,n.Lk)("span",Nl,(0,s.v_)(e.account_id),1)])):(0,n.Q3)("",!0)])])],10,Sl))),128))],64))),128))]),_:1})]),_:1},8,["modelValue"])])]),(0,n.Lk)("div",{class:(0,s.C4)(["chat-area",{"chat-area-hidden":I.value,"no-transition":h.value}])},[v.value?((0,n.uX)(),(0,n.CE)(n.FK,{key:0},[(0,n.Lk)("div",Ol,[(0,n.Lk)("div",Gl,[(0,n.Lk)("span",ql,(0,s.v_)(v.value.name),1),v.value.isGroup?((0,n.uX)(),(0,n.Wv)(p,{key:0,size:"small",type:"info"},{default:(0,n.k6)(()=>[...a[22]||(a[22]=[(0,n.eW)("群聊",-1)])]),_:1})):(0,n.Q3)("",!0)]),"history"!==T.value?((0,n.uX)(),(0,n.Wv)(m,{key:0,class:"refresh-chat-btn",loading:g.value,onClick:pe,size:"small",type:"primary",plain:""},{default:(0,n.k6)(()=>[(0,n.bF)(k,null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(r.Refresh))]),_:1}),a[23]||(a[23]=(0,n.eW)(" 刷新消息 ",-1))]),_:1},8,["loading"])):(0,n.Q3)("",!0)]),(0,n.Lk)("div",Jl,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(C.value,e=>((0,n.uX)(),(0,n.CE)("div",{key:e.id,class:(0,s.C4)(["message-wrapper",{"message-wrapper-self":e.isSelf}])},[!v.value?.isGroup||e.isSelf||e.isTimeMessage?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.CE)("div",Bl,(0,s.v_)(e.sender?.name),1)),(0,n.Lk)("div",{class:(0,s.C4)(["message",{"message-self":e.isSelf,"message-time":e.isTimeMessage}])},[(0,n.eW)((0,s.v_)(e.content)+" ",1),e.voice_text?((0,n.uX)(),(0,n.CE)(n.FK,{key:0},[a[24]||(a[24]=(0,n.Lk)("div",{class:"voice-text-divider"},null,-1)),(0,n.Lk)("div",Ql,(0,s.v_)(e.voice_text),1)],64)):(0,n.Q3)("",!0)],2)],2))),128))],512),(0,n.Lk)("div",Hl,[(0,n.Lk)("div",Yl,[S.value?((0,n.uX)(),(0,n.CE)("div",{key:0,ref_key:"countdownOverlayRef",ref:Ae,class:(0,s.C4)(["countdown-overlay",{urgent:W.value<=5}])},[(0,n.Lk)("div",Zl,[(0,n.Lk)("div",en,[((0,n.uX)(),(0,n.CE)("svg",an,[a[25]||(a[25]=(0,n.Lk)("circle",{cx:"20",cy:"20",r:"18",fill:"none",stroke:"rgba(255, 255, 255, 0.3)","stroke-width":"3"},null,-1)),(0,n.Lk)("circle",{cx:"20",cy:"20",r:"18",fill:"none",stroke:"#fff","stroke-width":"3","stroke-linecap":"round","stroke-dasharray":Xe.value,"stroke-dashoffset":"0",transform:"rotate(-90 20 20)",class:"countdown-progress"},null,8,tn)])),(0,n.Lk)("div",ln,(0,s.v_)(W.value),1)]),(0,n.Lk)("div",nn,[a[26]||(a[26]=(0,n.Lk)("div",{class:"countdown-title"},"AI回复确认",-1)),(0,n.Lk)("div",sn,(0,s.v_)(W.value)+"秒后自动发送",1)])]),(0,n.bF)(m,{class:"cancel-btn",size:"small",type:"danger",onClick:ta},{default:(0,n.k6)(()=>[...a[27]||(a[27]=[(0,n.eW)(" 取消 ",-1)])]),_:1})],2)):(0,n.Q3)("",!0),(0,n.Lk)("div",on,[(0,n.bF)(A,{modelValue:d.value,"onUpdate:modelValue":a[4]||(a[4]=e=>d.value=e),type:"textarea",rows:5,placeholder:"输入消息...",onFocus:Ce},null,8,["modelValue"])]),(0,n.Lk)("div",rn,[d.value.trim()?((0,n.uX)(),(0,n.Wv)(m,{key:0,class:"copy-btn",onClick:la},{default:(0,n.k6)(()=>[(0,n.bF)(k,null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(r.DocumentCopy))]),_:1}),a[28]||(a[28]=(0,n.eW)(" 复制 ",-1))]),_:1})):(0,n.Q3)("",!0),(0,n.bF)(m,{class:"coze-btn",disabled:u.value||!v.value||w.value,loading:w.value,onClick:fe},{default:(0,n.k6)(()=>[a[29]||(a[29]=(0,n.Lk)("img",{src:"/icon/img_ai.png",alt:"Dify",class:"img-ai"},null,-1)),(0,n.eW)(" "+(0,s.v_)(w.value?"生成中..":"生成话术"),1)]),_:1},8,["disabled","loading"]),(0,n.bF)(m,{type:"primary",class:"send-btn",disabled:t.value||!d.value.trim(),loading:t.value,onClick:Te},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(t.value?"发送中.":"发送"),1)]),_:1},8,["disabled","loading"])])])])],64)):((0,n.uX)(),(0,n.CE)("div",cn,[...a[30]||(a[30]=[(0,n.Lk)("div",{class:"empty-state"},[(0,n.Lk)("div",{class:"empty-state-icon"},"💬"),(0,n.Lk)("div",{class:"empty-state-text"},"未选中会话"),(0,n.Lk)("div",{class:"empty-state-subtext"},"从左侧选择会话开始查看聊天记录")],-1)])]))],2)]),(0,n.bF)(Ba,{visible:b.value,"onUpdate:visible":a[5]||(a[5]=e=>b.value=e),"coze-agents":P.value,onSave:ye},null,8,["visible","coze-agents"]),(0,n.bF)(kt,{visible:c.value,"onUpdate:visible":a[6]||(a[6]=e=>c.value=e)},null,8,["visible"]),(0,n.bF)(Nt,{visible:be.value,"onUpdate:visible":a[7]||(a[7]=e=>be.value=e),"account-list":_e.value,onConfirm:we},null,8,["visible","account-list"]),(0,n.bF)(it,{visible:re.value,"onUpdate:visible":a[8]||(a[8]=e=>re.value=e),title:ce.value,content:ue.value,"error-detail":de.value},null,8,["visible","title","content","error-detail"])])}}}),dn=(0,S.A)(un,[["__scopeId","data-v-4639e5cc"]]),vn=dn,mn={class:"coze-settings"},pn={key:0,class:"agents-list"},gn={class:"dialog-footer"},kn=(0,n.pM)({__name:"CozeAgentConfig",props:{visible:{type:Boolean},agents:{}},emits:["update:visible","update:agents"],setup(e,{emit:a}){const t=e,l=a,s=(0,o.KR)(t.visible),r=(0,o.KR)(),c=(0,o.KR)({name:"",botId:"",isDefault:!1,platform:"coze"}),u=(0,n.EW)(()=>Array.isArray(t.agents)?t.agents:[]),d={name:[{required:!0,message:"请输入智能体名称",trigger:"blur"}],botId:[{required:!0,message:"请输入 Bot ID",trigger:"blur"},{validator:async(e,a,t)=>{a&&v(a)?t(new Error("该智能体已经添加过了，无法重复添加")):t()},trigger:"blur"}]};(0,n.wB)(()=>t.visible,e=>{s.value=e}),(0,n.wB)(()=>s.value,e=>{l("update:visible",e)});const v=e=>u.value.some(a=>a.botId===e),m=()=>{s.value=!1,r.value?.resetFields(),c.value.isDefault=!1},p=async()=>{r.value&&await r.value.validate(async e=>{if(e){if(u.value.length>=10)return void i.nk.warning("最多只能添加10个智能体");if(v(c.value.botId.trim()))return void i.nk.warning("该智能体已经添加过了，无法重复添加");const e={name:c.value.name.trim(),botId:c.value.botId.trim(),isDefault:c.value.isDefault,platform:c.value.platform};"dify"===c.value.platform?e.id=`dify-${Date.now()}-${Math.random().toString(36).substring(2,10)}`:e.id=c.value.botId.trim();const t=[...u.value];e.isDefault?t.forEach(e=>{e.isDefault=!1}):0===t.length?e.isDefault=!0:t.some(e=>e.isDefault)||(e.isDefault=!0),t.push(e);try{const e=await(0,ea.ql)("agents",{agents:t});if(!e.success)throw new Error(e.error||"添加失败");l("update:agents",t),r.value.resetFields(),i.nk.success("添加成功"),s.value=!1}catch(a){console.error("保存失败:",a),i.nk.error(`添加智能体失败: ${a instanceof Error?a.message:"未知错误"}`)}}})};return(a,t)=>{const l=(0,n.g2)("el-option"),o=(0,n.g2)("el-select"),i=(0,n.g2)("el-form-item"),v=(0,n.g2)("el-input"),g=(0,n.g2)("el-switch"),k=(0,n.g2)("el-form"),h=(0,n.g2)("el-button"),f=(0,n.g2)("el-dialog");return(0,n.uX)(),(0,n.Wv)(f,{modelValue:s.value,"onUpdate:modelValue":t[6]||(t[6]=e=>s.value=e),title:"添加智能体",width:"500px"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",mn,[u.value.length?((0,n.uX)(),(0,n.CE)("div",pn)):(0,n.Q3)("",!0),(0,n.bF)(k,{ref_key:"agentFormRef",ref:r,model:c.value,rules:d,"label-width":"100px",class:"agent-form"},{default:(0,n.k6)(()=>[(0,n.bF)(i,{label:"平台",prop:"platform"},{default:(0,n.k6)(()=>[(0,n.bF)(o,{modelValue:c.value.platform,"onUpdate:modelValue":t[0]||(t[0]=e=>c.value.platform=e),placeholder:"请选择平台"},{default:(0,n.k6)(()=>[(0,n.bF)(l,{label:"Coze",value:"coze"}),(0,n.bF)(l,{label:"Dify",value:"dify"})]),_:1},8,["modelValue"])]),_:1}),(0,n.bF)(i,{label:"智能体名称",prop:"name"},{default:(0,n.k6)(()=>[(0,n.bF)(v,{modelValue:c.value.name,"onUpdate:modelValue":t[1]||(t[1]=e=>c.value.name=e),onKeydown:t[2]||(t[2]=(0,Se.jR)((0,Se.D$)(()=>{},["prevent"]),["enter"])),placeholder:"请输入智能体名称"},null,8,["modelValue"])]),_:1}),(0,n.bF)(i,{label:"coze"===c.value.platform?"Bot ID":"API 秘钥",prop:"botId"},{default:(0,n.k6)(()=>[(0,n.bF)(v,{modelValue:c.value.botId,"onUpdate:modelValue":t[3]||(t[3]=e=>c.value.botId=e),onKeydown:t[4]||(t[4]=(0,Se.jR)((0,Se.D$)(()=>{},["prevent"]),["enter"])),placeholder:"coze"===c.value.platform?"请输入 Bot ID":"请输入 API 秘钥",type:"dify"===c.value.platform?"password":"text","show-password":"dify"===c.value.platform},null,8,["modelValue","placeholder","type","show-password"])]),_:1},8,["label"]),(0,n.bF)(i,{label:"默认接待"},{default:(0,n.k6)(()=>[(0,n.bF)(g,{modelValue:c.value.isDefault,"onUpdate:modelValue":t[5]||(t[5]=e=>c.value.isDefault=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),(0,n.Lk)("div",gn,[(0,n.bF)(h,{onClick:m},{default:(0,n.k6)(()=>[...t[7]||(t[7]=[(0,n.eW)("取消",-1)])]),_:1}),(0,n.bF)(h,{type:"primary",onClick:p,disabled:e.agents.length>10},{default:(0,n.k6)(()=>[...t[8]||(t[8]=[(0,n.eW)(" 添加智能体 ",-1)])]),_:1},8,["disabled"])])])]),_:1},8,["modelValue"])}}}),hn=(0,S.A)(kn,[["__scopeId","data-v-438be38a"]]),fn=hn,yn=async e=>{try{const a=await fetch(`${ea.JR}/api/external-api/test-connection`,{method:"POST",headers:{...ea.b3,"Content-Type":"application/json"},body:JSON.stringify({identifier:e})});if(!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);const t=await a.json();return{success:t.success||!1,message:t.message||(t.success?"连接成功":"连接失败"),data:t.data}}catch(a){return console.error("测试外部API连接失败:",a),{success:!1,message:a instanceof Error?a.message:"网络错误或服务不可用"}}},bn=async()=>{try{const e=await fetch(`${ea.JR}/api/config/external_api_settings`,{method:"GET",headers:ea.b3});if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);const a=await e.json();return a.data||null}catch(e){return console.error("获取外部API配置失败:",e),null}},_n="http://127.0.0.1:9922/api",wn="yoko_test",Ln={"Content-Type":"application/json","X-API-Key":wn},Fn=async(e,a)=>{try{const t=await fetch(`${_n}/agent/test`,{method:"POST",headers:Ln,body:JSON.stringify({agent_id:e,platform:a})});return await t.json()}catch(t){return console.error("测试智能体失败:",t),{success:!1,error:t instanceof Error?t.message:"网络错误"}}};var Cn=t(8761);const En={class:"greeting-config"},In={class:"header"},Rn={class:"greeting-groups"},Tn={class:"group-header"},Vn={class:"group-content"},xn={class:"greetings-list"},An={class:"greeting-content"},Wn={class:"dialog-footer"},Sn={class:"file-upload"},Kn={key:0,class:"selected-file"},Xn={class:"agent-option"},$n=["src","alt"],Un={class:"dialog-footer"},jn=(0,n.pM)({__name:"GreetingConfig",setup(e){const a=(0,n.WQ)("emitter"),t=(0,o.KR)([]),l=(0,o.KR)([]),c=(0,o.KR)(!1),u=(0,o.KR)(!1),d=(0,o.KR)(0),v=(0,o.KR)([]),m=(0,o.KR)({name:"",greetings:[]}),p=(0,o.KR)({type:"text",content:"",prompt:"请按要求生成话术"}),g=async()=>{try{const e=await(0,ea.zj)("agents");if(e?.success&&e?.data){const a=Array.isArray(e.data)?e.data:Array.isArray(e.data.agents)?e.data.agents:[];v.value=a.filter(e=>e.name&&e.botId)}}catch(e){console.error("加载智能体配置失败:",e)}},k=e=>"dify"===e||"yuanqi"===e?"png":"svg",h=e=>{switch(e){case"text":return"success";case"file":return"warning";case"agent":return"info";default:return"info"}},f=e=>{switch(e){case"text":return"文本";case"file":return"文件";case"agent":return"智能体";default:return"未知"}},y=async()=>{try{const e=await(0,ea.zj)("greeting_config");if(e?.success&&e?.data){const a=e.data?.greeting_config?.greeting_config||e.data?.greeting_config||[];l.value=Array.isArray(a)?a.map(e=>({...e,greetings:Array.isArray(e.greetings)?e.greetings:[]})):[]}}catch(e){console.error("加载打招呼配置失败:",e),l.value=[]}},b=async()=>{try{const e={greeting_config:l.value||[]};await(0,ea.ql)("greeting_config",e),i.nk.success("保存成功")}catch(e){console.error("保存配置失败:",e),i.nk.error("保存失败")}},_=()=>{m.value={name:"",greetings:[]},c.value=!0},w=async()=>{m.value.name.trim()?(l.value.push({name:m.value.name,greetings:[]}),await b(),c.value=!1):i.nk.warning("请输入组名")},L=async e=>{l.value.splice(e,1),await b()},F=e=>{d.value=e,p.value={type:"text",content:"",prompt:"请按要求生成话术"},u.value=!0};(0,n.sV)(()=>{a.on("updateGreetingConfig",e=>{let a=[];e?.greeting_config?.greeting_config?a=e.greeting_config.greeting_config:e?.greeting_config&&(a=e.greeting_config),l.value=Array.isArray(a)?a.map(e=>({...e,greetings:Array.isArray(e.greetings)?e.greetings:[]})):[]}),y(),g()}),(0,n.hi)(()=>{a.off("updateGreetingConfig")});const C=async()=>{if("text"===p.value.type&&!p.value.content.trim())return void i.nk.warning("请输入打招呼内容");if("file"===p.value.type&&!p.value.filePath)return void i.nk.warning("请选择文件");if("agent"===p.value.type){if(!p.value.agentId)return void i.nk.warning("请选择智能体");if(!p.value.prompt?.trim())return void i.nk.warning("请输入提示词")}let e;e="text"===p.value.type?{type:"text",content:p.value.content}:"file"===p.value.type?{type:"file",content:p.value.content,filePath:p.value.filePath}:"agent"===p.value.type?{type:"agent",content:p.value.content,agentId:p.value.agentId,prompt:p.value.prompt}:{...p.value},l.value[d.value].greetings.push(e),await b(),u.value=!1},E=async(e,a)=>{l.value[e].greetings.splice(a,1),await b()},I=e=>{if("text"===e.type)return e.content;if("file"===e.type)return e.filePath||"未知文件";if("agent"===e.type){const a=v.value.find(a=>a.botId===e.agentId);return`${a?.name||"未知智能体"} - ${e.prompt||"无提示词"}`}return"未知类型"},R=async()=>{try{const e=document.createElement("input");e.type="file",e.accept="*/*",e.onchange=async e=>{const a=e.target.files?.[0];if(a)try{const e=await(0,Cn.QM)(a);p.value.content=e.filename,p.value.filePath=e.filepath,i.nk.success("文件上传成功")}catch(t){i.nk.error(`文件上传失败: ${t instanceof Error?t.message:"未知错误"}`)}},e.click()}catch(e){console.error("选择文件失败:",e)}};return(e,a)=>{const i=(0,n.g2)("el-button"),d=(0,n.g2)("el-tag"),g=(0,n.g2)("el-icon"),y=(0,n.g2)("el-collapse-item"),b=(0,n.g2)("el-collapse"),T=(0,n.g2)("el-input"),V=(0,n.g2)("el-form-item"),x=(0,n.g2)("el-form"),A=(0,n.g2)("el-dialog"),W=(0,n.g2)("el-radio"),S=(0,n.g2)("el-radio-group"),K=(0,n.g2)("el-option"),X=(0,n.g2)("el-select");return(0,n.uX)(),(0,n.CE)("div",En,[(0,n.Lk)("div",In,[a[11]||(a[11]=(0,n.Lk)("h4",null,"打招呼话术配置",-1)),(0,n.bF)(i,{type:"primary",onClick:_,disabled:l.value.length>=30},{default:(0,n.k6)(()=>[...a[10]||(a[10]=[(0,n.eW)(" 添加话术组 ",-1)])]),_:1},8,["disabled"])]),(0,n.Lk)("div",Rn,[(0,n.bF)(b,{modelValue:t.value,"onUpdate:modelValue":a[0]||(a[0]=e=>t.value=e)},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(l.value,(e,t)=>((0,n.uX)(),(0,n.Wv)(y,{key:t,name:t},{title:(0,n.k6)(()=>[(0,n.Lk)("div",Tn,[(0,n.Lk)("span",null,(0,s.v_)(e.name),1),(0,n.bF)(i,{type:"danger",size:"small",onClick:(0,Se.D$)(e=>L(t),["stop"])},{default:(0,n.k6)(()=>[...a[12]||(a[12]=[(0,n.eW)(" 删除 ",-1)])]),_:1},8,["onClick"])])]),default:(0,n.k6)(()=>[(0,n.Lk)("div",Vn,[(0,n.Lk)("div",xn,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(e.greetings,(e,a)=>((0,n.uX)(),(0,n.CE)("div",{key:a,class:"greeting-item"},[(0,n.bF)(d,{type:h(e.type)},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(f(e.type)),1)]),_:2},1032,["type"]),(0,n.Lk)("span",An,(0,s.v_)(I(e)),1),(0,n.bF)(i,{type:"danger",size:"small",circle:"",onClick:e=>E(t,a)},{default:(0,n.k6)(()=>[(0,n.bF)(g,null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(r.Delete))]),_:1})]),_:1},8,["onClick"])]))),128))]),(0,n.bF)(i,{plain:"",type:"info",class:"add-content-btn",onClick:e=>F(t),disabled:e.greetings.length>=5},{default:(0,n.k6)(()=>[(0,n.bF)(g,{class:"add-icon"},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(r.Plus))]),_:1}),a[13]||(a[13]=(0,n.eW)(" 添加内容 ",-1))]),_:1},8,["onClick","disabled"])])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),(0,n.bF)(A,{modelValue:c.value,"onUpdate:modelValue":a[3]||(a[3]=e=>c.value=e),title:"添加话术组",width:"400px"},{footer:(0,n.k6)(()=>[(0,n.Lk)("span",Wn,[(0,n.bF)(i,{onClick:a[2]||(a[2]=e=>c.value=!1)},{default:(0,n.k6)(()=>[...a[14]||(a[14]=[(0,n.eW)("取消",-1)])]),_:1}),(0,n.bF)(i,{type:"primary",onClick:w},{default:(0,n.k6)(()=>[...a[15]||(a[15]=[(0,n.eW)("确认",-1)])]),_:1})])]),default:(0,n.k6)(()=>[(0,n.bF)(x,{model:m.value,"label-width":"80px"},{default:(0,n.k6)(()=>[(0,n.bF)(V,{label:"组名",required:""},{default:(0,n.k6)(()=>[(0,n.bF)(T,{modelValue:m.value.name,"onUpdate:modelValue":a[1]||(a[1]=e=>m.value.name=e),placeholder:"请输入组名"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),(0,n.bF)(A,{modelValue:u.value,"onUpdate:modelValue":a[9]||(a[9]=e=>u.value=e),title:"添加话术内容",width:"500px"},{footer:(0,n.k6)(()=>[(0,n.Lk)("span",Un,[(0,n.bF)(i,{onClick:a[8]||(a[8]=e=>u.value=!1)},{default:(0,n.k6)(()=>[...a[20]||(a[20]=[(0,n.eW)("取消",-1)])]),_:1}),(0,n.bF)(i,{type:"primary",onClick:C},{default:(0,n.k6)(()=>[...a[21]||(a[21]=[(0,n.eW)("确认",-1)])]),_:1})])]),default:(0,n.k6)(()=>[(0,n.bF)(x,{model:p.value,"label-width":"80px"},{default:(0,n.k6)(()=>[(0,n.bF)(V,{label:"类型"},{default:(0,n.k6)(()=>[(0,n.bF)(S,{modelValue:p.value.type,"onUpdate:modelValue":a[4]||(a[4]=e=>p.value.type=e)},{default:(0,n.k6)(()=>[(0,n.bF)(W,{label:"text"},{default:(0,n.k6)(()=>[...a[16]||(a[16]=[(0,n.eW)("文本",-1)])]),_:1}),(0,n.bF)(W,{label:"file"},{default:(0,n.k6)(()=>[...a[17]||(a[17]=[(0,n.eW)("文件",-1)])]),_:1}),(0,n.bF)(W,{label:"agent"},{default:(0,n.k6)(()=>[...a[18]||(a[18]=[(0,n.eW)("智能体",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),"text"===p.value.type?((0,n.uX)(),(0,n.Wv)(V,{key:0,label:"内容"},{default:(0,n.k6)(()=>[(0,n.bF)(T,{modelValue:p.value.content,"onUpdate:modelValue":a[5]||(a[5]=e=>p.value.content=e),type:"textarea",rows:4,maxlength:300,"show-word-limit":"",placeholder:"请输入话术文本"},null,8,["modelValue"])]),_:1})):"file"===p.value.type?((0,n.uX)(),(0,n.Wv)(V,{key:1,label:"文件"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",Sn,[(0,n.bF)(i,{type:"primary",onClick:R},{default:(0,n.k6)(()=>[...a[19]||(a[19]=[(0,n.eW)("选择文件",-1)])]),_:1}),p.value.content?((0,n.uX)(),(0,n.CE)("span",Kn," 已选择: "+(0,s.v_)(p.value.content),1)):(0,n.Q3)("",!0)])]),_:1})):"agent"===p.value.type?((0,n.uX)(),(0,n.CE)(n.FK,{key:2},[(0,n.bF)(V,{label:"智能体"},{default:(0,n.k6)(()=>[(0,n.bF)(X,{modelValue:p.value.agentId,"onUpdate:modelValue":a[6]||(a[6]=e=>p.value.agentId=e),placeholder:"请选择智能体"},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(v.value,e=>((0,n.uX)(),(0,n.Wv)(K,{key:e.botId,label:e.name,value:e.botId},{default:(0,n.k6)(()=>[(0,n.Lk)("div",Xn,[(0,n.Lk)("img",{src:`/icon/${e.platform||"coze"}.${k(e.platform)}`,alt:e.platform||"coze",class:"agent-icon"},null,8,$n),(0,n.eW)(" "+(0,s.v_)(e.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,n.bF)(V,{label:"提示词"},{default:(0,n.k6)(()=>[(0,n.bF)(T,{modelValue:p.value.prompt,"onUpdate:modelValue":a[7]||(a[7]=e=>p.value.prompt=e),type:"textarea",rows:3,maxlength:500,"show-word-limit":"",placeholder:"提示词会作为问题传给智能体"},null,8,["modelValue"])]),_:1})],64)):(0,n.Q3)("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Dn=(0,S.A)(jn,[["__scopeId","data-v-621a7709"]]),Pn=Dn;var zn=t(8626),Mn=t(595);const Nn={class:"settings-page-container"},On={class:"settings-nav"},Gn={class:"nav-items"},qn=["onClick"],Jn={class:"setting-section"},Bn={class:"platform-title"},Qn={key:0,class:"token-reminder"},Hn={class:"setting-section"},Yn={class:"card-header"},Zn={class:"agents-list"},es={class:"agent-info"},as=["src","alt"],ts={class:"agent-details"},ls={class:"agent-name"},ns={class:"agent-botid"},ss={class:"agent-actions"},os={class:"actions"},is={class:"setting-section"},rs={class:"actions"},cs={class:"setting-section"},us={class:"form-item-content"},ds={class:"form-item-content"},vs={class:"form-item-content"},ms={class:"transfer-content"},ps={class:"config-section"},gs={class:"section-header"},ks={class:"form-item"},hs={class:"phrases-list"},fs={class:"setting-section"},ys={class:"api-description"},bs={class:"custom-info-box"},_s={class:"info-icon"},ws={class:"api-identifier-container"},Ls={class:"api-identifier-input"},Fs={class:"connection-status-container"},Cs={class:"setting-section"},Es={class:"api-description"},Is={class:"custom-info-box"},Rs={class:"info-icon"},Ts={class:"alert-container"},Vs={class:"alert-container"},xs={class:"alert-container"},As={class:"setting-section"},Ws={class:"api-description"},Ss={class:"custom-info-box"},Ks={class:"info-icon"},Xs={class:"rest-time-display"},$s={class:"current-setting"},Us={class:"setting-value"},js={class:"timeline-container"},Ds={class:"timeline-track"},Ps={class:"time-inputs"},zs={class:"time-input-group"},Ms={class:"time-input-group"},Ns={class:"task-selection"},Os={class:"task-options"},Gs=["checked","onChange"],qs={class:"task-icon"},Js={class:"task-name"},Bs={key:0,class:"applied-badge"},Qs={style:{display:"flex","align-items":"center"}},Hs=["src","alt"],Ys={class:"dialog-footer"},Zs={class:"clear-cache-content"},eo={class:"dialog-footer"},ao=96,to=(0,n.pM)({name:"SettingsPage",__name:"SettingsPage",setup(e){const a=(0,o.KR)({baseUrl:""}),t=(0,o.KR)(!1),c=(0,o.KR)({agentId:""}),u=(0,o.KR)(!1),d=(0,o.KR)(!1),v=(0,o.KR)(!1),m=(0,o.KR)(""),p=(0,o.KR)(null),g=()=>{if(!be.value?.length)return void i.nk.warning("请先添加一个智能体");const e=be.value.find(e=>e.isDefault);c.value.agentId=e?e.botId:be.value[0].botId,t.value=!0},k=(0,o.KR)({identifier:""}),h=(0,o.KR)(!1),f=(0,o.KR)(null),y=(0,zn.debounce)(async()=>{try{await(0,ea.ql)("dify_settings",a.value),i.nk.success("Dify配置已保存")}catch(e){console.error("保存Dify配置失败:",e),i.nk.error(`保存失败: ${e instanceof Error?e.message:"未知错误"}`)}},500),b=(0,zn.debounce)(async()=>{try{he.value.tokenLastUpdated=(new Date).toISOString(),await(0,ea.ql)("coze_settings",{coze_settings:{token:he.value.token,tokenLastUpdated:he.value.tokenLastUpdated}}),i.nk.success("Coze配置已保存")}catch(e){console.error("保存Coze配置失败:",e),i.nk.error(`保存失败: ${e instanceof Error?e.message:"未知错误"}`)}},500),_=[{id:"ai-settings",name:"AI接入设置"},{id:"agent-settings",name:"智能体管理"},{id:"moment-settings",name:"朋友圈评论"},{id:"greeting-settings",name:"话术组配置"},{id:"chat-history-settings",name:"AI回复配置"},{id:"external-api-settings",name:"外部API配置"},{id:"feishu-settings",name:"飞书通知"},{id:"rest-time-settings",name:"休息时间"}],w=e=>!e||e.length<=10?e:`${e.substring(0,5)}******${e.substring(e.length-5)}`,L=(0,o.KR)(window.innerWidth<=650),F=(0,o.KR)("ai-settings"),C=(0,o.KR)(null),E=(0,o.KR)(!1),I=e=>{E.value=!0,F.value=e;const a=document.getElementById(e);if(a){const e=20,t=a.getBoundingClientRect().top+window.pageYOffset,l=t-e;C.value?.scrollTo({top:l,behavior:"smooth"}),setTimeout(()=>{E.value=!1},800)}else E.value=!1},R=()=>{L.value=window.innerWidth<=650},T=()=>{if(!C.value||E.value)return;const e=_.map(e=>({id:e.id,element:document.getElementById(e.id)})),a=window.innerHeight;let t=e[0],l=1/0;e.forEach(e=>{if(!e.element)return;const n=e.element.getBoundingClientRect(),s=Math.abs(n.top);n.top<=a/3&&s<l&&(l=s,t=e)}),t&&(F.value=t.id)},V=(0,o.KR)({appId:"",appSecret:"",phone:""}),x=(0,o.KR)(""),A=(0,o.KR)(void 0),W=(0,o.KR)({agentId:"",commentLimit:100,perFriendLimit:2,autoLike:!1,interactionMode:"like_and_comment",blacklist:"",prompt:""}),S=(0,o.KR)({autoSave:!1,includeContext:!1,contextCount:5,includeUserInfo:!1,messageMerge:{mode:"none",interval:5},transferConfig:{phrases:[],notifyWechat:""}}),K=(0,l.rd)(),X=(0,o.KR)(!1);K.beforeEach(async(e,a,t)=>{"settings"===e.name&&await we(),t()});const $=async()=>{try{const e=await(0,ea.ql)("feishu_settings",{feishu_settings:V.value});if(!e.success)throw new Error("飞书设置保存失败");i.nk.success("飞书设置已保存")}catch(e){console.error("飞书设置保存失败:",e),i.nk.error("飞书设置保存失败")}},U=async()=>{const e=(V.value.appId||"").trim();e.startsWith("cli_")?await $():i.nk.warning("APP ID 必须以 cli_ 开头")},j=async()=>{const e=(V.value.appSecret||"").trim();e.length<=10?i.nk.warning("App Secret 长度必须大于 10"):await $()},D=()=>{V.value.phone=(V.value.phone||"").replace(/\D/g,"").slice(0,11)},P=async()=>{const e=(V.value.phone||"").trim();/^\d{11}$/.test(e)?await $():i.nk.warning("手机号必须为 11 位大陆手机号")},z=()=>{S.value.transferConfig.phrases.length<3&&(v.value=!0,(0,n.dY)(()=>{p.value?.focus()}))},M=()=>{m.value.trim()&&(S.value.transferConfig.phrases.includes(m.value.trim())||(S.value.transferConfig.phrases.push(m.value.trim()),ge())),v.value=!1,m.value=""},N=e=>{S.value.transferConfig.phrases.splice(e,1),ge()},O=async()=>{if(!c.value.agentId)return void i.nk.warning("请选择要测试的智能体");const e=be.value.find(e=>e.botId===c.value.agentId);if(e)if("coze"!==e.platform||he.value.token){X.value=!0;try{const a=await Fn(e.botId,e.platform||"coze");a.success?(i.nk.success("测试通过！"),t.value=!1):i.nk.error(a.error||"测试失败")}catch(a){console.error("测试失败:",a),i.nk.error(a instanceof Error?a.message:"测试失败")}finally{X.value=!1}}else i.nk.warning("请先配置 Coze Token");else i.nk.warning("未找到选中的智能体")},G=async()=>{try{const e=await(0,ea.ql)("moment_settings",{moment_settings:W.value});if(!e.success)throw new Error("保存失败");i.nk.success("朋友圈设置保存成功")}catch(e){console.error("保存朋友圈设置失败:",e),i.nk.error("保存朋友圈设置失败")}},q=async e=>{try{const a=be.value.map(a=>({...a,isDefault:a.botId===e.botId})),t=await(0,ea.ql)("agents",{agents:a});if(!t.success)throw new Error("设置失败");be.value=a,i.nk.success("设置默认智能体成功")}catch(a){console.error("设置默认智能体失败:",a),i.nk.error("设置默认智能体失败")}},J=(0,o.KR)({startTime:0,endTime:28,selectedTasks:["自动加好友","自动通过好友"]}),B=(0,o.KR)(null),Q=(0,o.KR)(null),H=(0,o.KR)(""),Y=(0,o.KR)(""),Z=[{id:"moment_comment",name:"朋友圈评论",icon:"💬"},{id:"add_friend",name:"自动加好友",icon:"👥"},{id:"accept_friend",name:"自动通过好友",icon:"✅"}],ee=e=>{const a=Math.floor(e/4),t=e%4*15;return`${a.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`},ae=e=>{const[a,t]=e.split(":").map(Number);return 4*a+t/15},te=e=>e/(ao-1)*100,le=(0,n.EW)(()=>{const e=J.value.startTime,a=J.value.endTime;return e<=a?{start:te(e),width:te(a)-te(e)}:[{start:0,width:te(a)},{start:te(e),width:100-te(e)}]}),ne=e=>{const a=J.value.selectedTasks;a.includes(e)?J.value.selectedTasks=a.filter(a=>a!==e):J.value.selectedTasks=[...a,e],ue()},se=(e,a)=>{a.preventDefault(),B.value=e},oe=e=>{if(!B.value||!Q.value)return;const a=Q.value.getBoundingClientRect(),t=Math.max(0,Math.min(e.clientX-a.left,a.width)),l=Math.round(t/a.width*(ao-1));"start"===B.value?(J.value.startTime=l,H.value=ee(l)):"end"===B.value&&(J.value.endTime=l,Y.value=ee(l)),ue()},ie=()=>{B.value=null},re=e=>{J.value.startTime=ae(e),ue()},ce=e=>{J.value.endTime=ae(e),ue()},ue=async()=>{try{const e=await(0,ea.ql)("rest_time_settings",{rest_time_settings:J.value});e.success&&console.log("休息时间设置保存成功")}catch(e){console.error("保存休息时间设置失败:",e),i.nk.error("保存失败")}},de=e=>!e||e.length<=8?e:e.substring(0,4)+"*".repeat(e.length-8)+e.substring(e.length-4),ve=e=>e,me=(0,zn.debounce)(async e=>{const a=e.trim();k.value.identifier=a;try{await(0,ea.ql)("external_api_settings",{identifier:a}),f.value=null,a||i.nk.info("API标识符已清空")}catch(t){console.error("保存API配置失败:",t),i.nk.error("保存失败")}},1e3),pe=async()=>{if(k.value.identifier){h.value=!0,f.value=null;try{const e=await yn(k.value.identifier);f.value={success:e.success,message:e.message},e.success?i.nk.success("API连接测试成功"):i.nk.error(`连接测试失败: ${e.message}`)}catch(e){console.error("测试连接失败:",e),f.value={success:!1,message:"网络错误或服务不可用"},i.nk.error("测试连接失败")}finally{h.value=!1}}},ge=async()=>{try{const e=await(0,ea.ql)("chat_history_settings",{chat_history_settings:S.value});if(!e.success)throw new Error("保存失败");i.nk.success("聊天配置保存成功")}catch(e){console.error("保存聊天配置失败:",e),i.nk.error("保存聊天配置失败")}},ke=async e=>{if(e.isDefault)i.nk.warning("默认智能体不能删除，请先设置其他智能体为默认");else try{await Ke.s.confirm("确定要删除该智能体吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=be.value.filter(a=>a.botId!==e.botId),t=await(0,ea.ql)("agents",{agents:a});if(!t.success)throw new Error("删除失败");be.value=a,i.nk.success("删除成功")}catch(a){"cancel"!==a&&(console.error("删除智能体失败:",a),i.nk.error("删除智能体失败"))}},he=(0,o.KR)({token:"",tokenLastUpdated:void 0}),fe=(0,o.KR)({platform:"DeepSeek",platformConfigs:{DeepSeek:{baseUrl:"",apiKey:"",modelName:""},通义千问:{baseUrl:"",apiKey:"",modelName:""},硅基流动:{baseUrl:"",apiKey:"",modelName:""}}}),ye=(0,o.KR)(!1),be=(0,o.KR)([]),_e=()=>{ye.value=!0},we=async()=>{try{console.debug("开始加载配置...");const[e,t,l,n,s,o,i,r,c]=await Promise.all([(0,ea.zj)("agents"),(0,ea.zj)("coze_settings"),(0,ea.zj)("model_settings"),(0,ea.zj)("moment_settings"),(0,ea.zj)("greeting_config"),(0,ea.zj)("chat_history_settings"),(0,ea.zj)("feishu_settings"),(0,ea.zj)("dify_settings"),(0,ea.zj)("external_api_settings")]);if(r?.success&&r?.data&&(a.value={baseUrl:r.data.baseUrl}),e.success&&e.data){const a=Array.isArray(e.data)?e.data:Array.isArray(e.data.agents)?e.data.agents:[],t=new Map;a.forEach(e=>{e.botId&&!t.has(e.botId)&&t.set(e.botId,{name:e.name||"",botId:e.botId,isDefault:Boolean(e.isDefault),id:e.id,platform:e.platform||"coze"})}),be.value=Array.from(t.values()).filter(e=>e.name&&e.botId);const l=be.value.filter(e=>e.isDefault);l.length>1?be.value=be.value.map((e,a)=>({...e,isDefault:l[0].botId===e.botId})):be.value.length>0&&!be.value.some(e=>e.isDefault)&&(be.value[0].isDefault=!0)}if(t?.success&&t?.data?.coze_settings&&(he.value={token:t.data.coze_settings.token||"",tokenLastUpdated:t.data.coze_settings.tokenLastUpdated},x.value=he.value.token,A.value=he.value.tokenLastUpdated),c?.success&&c?.data?.identifier&&(k.value.identifier=c.data.identifier),l.success&&l.data){const e=l.data.model_settings||{};e.platformConfigs&&(fe.value={platform:e.platform||"DeepSeek",platformConfigs:{DeepSeek:{baseUrl:"",apiKey:"",modelName:""},通义千问:{baseUrl:"",apiKey:"",modelName:""},硅基流动:{baseUrl:"",apiKey:"",modelName:""},...e.platformConfigs}})}n.success&&n.data&&(W.value={...W.value,...n.data.moment_settings}),s.success&&s.data&&Le.emit("updateGreetingConfig",s.data),o.success&&o.data&&(S.value={...S.value,...o.data.chat_history_settings}),i?.success&&i?.data?.feishu_settings&&(V.value={appId:i.data.feishu_settings.appId||"",appSecret:i.data.feishu_settings.appSecret||"",phone:i.data.feishu_settings.phone||""})}catch(e){console.error("加载配置失败:",e),i.nk.error("加载配置失败")}};(0,n.KC)(()=>{we()});const Le=(0,Mn.A)();(0,n.Gt)("emitter",Le);const Fe=e=>"dify"===e||"yuanqi"===e?"png":"svg",Ce=e=>"dify"===e?"API 秘钥":"Bot ID",Ee=(0,n.EW)(()=>{if(he.value.token&&he.value.tokenLastUpdated){const e=new Date(he.value.tokenLastUpdated),a=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate()),l=new Date(a.getFullYear(),a.getMonth(),a.getDate()),n=l.getTime()-t.getTime(),s=Math.round(n/864e5);return s+1}return 0}),Ie=()=>{u.value=!0},Re=()=>{u.value=!1},Te=async()=>{try{d.value=!0;const e=await fetch("/api/coze/clear-cache",{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":"yoko_test"}}),a=await e.json();a.success?(i.nk.success("Coze会话缓存已清除"),u.value=!1):i.nk.error(a.error||"清除缓存失败")}catch(e){console.error("清除缓存失败:",e),i.nk.error("清除缓存失败")}finally{d.value=!1}};return(0,n.sV)(async()=>{try{C.value?.addEventListener("scroll",T),await we(),await(0,n.dY)()}catch(e){console.error("组件挂载时加载配置失败:",e)}R(),window.addEventListener("resize",R),document.addEventListener("mousemove",oe),document.addEventListener("mouseup",ie),H.value=ee(J.value.startTime),Y.value=ee(J.value.endTime);try{const e=await(0,ea.zj)("rest_time_settings");e.success&&e.data&&(J.value={...J.value,...e.data.rest_time_settings},H.value=ee(J.value.startTime),Y.value=ee(J.value.endTime))}catch(e){console.error("加载休息时间配置失败:",e)}}),(0,n.hi)(()=>{C.value?.removeEventListener("scroll",T),window.removeEventListener("resize",R),document.removeEventListener("mousemove",oe),document.removeEventListener("mouseup",ie)}),(e,l)=>{const i=(0,n.g2)("el-button"),E=(0,n.g2)("el-input"),R=(0,n.g2)("el-form-item"),T=(0,n.g2)("el-form"),x=(0,n.g2)("el-card"),A=(0,n.g2)("el-tag"),K=(0,n.g2)("Delete"),$=(0,n.g2)("el-icon"),B=(0,n.g2)("el-empty"),ae=(0,n.g2)("el-input-number"),oe=(0,n.g2)("el-option"),ie=(0,n.g2)("el-select"),ue=(0,n.g2)("el-tooltip"),fe=(0,n.g2)("el-switch"),we=(0,n.g2)("InfoFilled"),Le=(0,n.g2)("el-dialog"),Ve=(0,n.g2)("el-alert");return(0,n.uX)(),(0,n.CE)(n.FK,null,[(0,n.Lk)("div",Nn,[(0,n.bo)((0,n.Lk)("div",On,[l[37]||(l[37]=(0,n.Lk)("div",{class:"nav-title"},"配置导航",-1)),(0,n.Lk)("div",Gn,[((0,n.uX)(),(0,n.CE)(n.FK,null,(0,n.pI)(_,e=>(0,n.Lk)("div",{key:e.id,class:(0,s.C4)(["nav-item",{active:F.value===e.id}]),onClick:a=>I(e.id)},(0,s.v_)(e.name),11,qn)),64))])],512),[[Se.aG,!L.value]]),(0,n.Lk)("div",{class:(0,s.C4)(["settings-content",{"full-width":L.value}]),ref_key:"contentRef",ref:C},[(0,n.bF)(x,{class:"setting-card",id:"ai-settings"},{header:(0,n.k6)(()=>[...l[38]||(l[38]=[(0,n.Lk)("div",{class:"card-header"},[(0,n.Lk)("span",null,"AI接入配置")],-1)])]),default:(0,n.k6)(()=>[(0,n.Lk)("div",Jn,[(0,n.Lk)("h4",Bn,[l[40]||(l[40]=(0,n.Lk)("img",{src:"/icon/coze.svg",alt:"Coze",class:"platform-icon"},null,-1)),l[41]||(l[41]=(0,n.eW)(" Coze平台 ",-1)),(0,n.bF)(i,{type:"info",size:"small",plain:"",class:"clear-cache-btn",onClick:Ie},{default:(0,n.k6)(()=>[...l[39]||(l[39]=[(0,n.eW)(" 清除会话缓存 ",-1)])]),_:1})]),(0,n.bF)(T,{model:he.value,"label-width":"120px"},{default:(0,n.k6)(()=>[(0,n.bF)(R,{label:"Coze Token"},{default:(0,n.k6)(()=>[(0,n.bF)(E,{modelValue:he.value.token,"onUpdate:modelValue":l[0]||(l[0]=e=>he.value.token=e),type:"password","show-password":"",onKeydown:l[1]||(l[1]=(0,Se.jR)((0,Se.D$)(()=>{},["prevent"]),["enter"])),placeholder:"请输入Coze Token",onInput:(0,o.R1)(b)},null,8,["modelValue","onInput"]),he.value.token&&he.value.tokenLastUpdated?((0,n.uX)(),(0,n.CE)("div",Qn," token已绑定 "+(0,s.v_)(Ee.value)+" 天，如非永久期限，记得到期及时更换 ",1)):(0,n.Q3)("",!0)]),_:1})]),_:1},8,["model"])]),(0,n.Lk)("div",Hn,[l[42]||(l[42]=(0,n.Lk)("h4",{class:"platform-title"},[(0,n.Lk)("img",{src:"/icon/dify.png",alt:"Dify",class:"platform-icon"}),(0,n.eW)(" Dify平台 ")],-1)),(0,n.bF)(T,{model:a.value,"label-width":"120px"},{default:(0,n.k6)(()=>[(0,n.bF)(R,{label:"服务器地址"},{default:(0,n.k6)(()=>[(0,n.bF)(E,{modelValue:a.value.baseUrl,"onUpdate:modelValue":l[2]||(l[2]=e=>a.value.baseUrl=e),placeholder:"如果是本地则默认可填入：http://localhost/v1",onInput:(0,o.R1)(y)},null,8,["modelValue","onInput"])]),_:1})]),_:1},8,["model"])]),(0,n.bF)(fn,{visible:ye.value,"onUpdate:visible":l[3]||(l[3]=e=>ye.value=e),agents:be.value,"onUpdate:agents":l[4]||(l[4]=e=>be.value=e)},null,8,["visible","agents"])]),_:1}),(0,n.bF)(x,{class:"setting-card",id:"agent-settings"},{header:(0,n.k6)(()=>[(0,n.Lk)("div",Yn,[l[44]||(l[44]=(0,n.Lk)("span",null,"智能体管理",-1)),(0,n.bF)(i,{type:"primary",size:"small",loading:X.value,onClick:g},{default:(0,n.k6)(()=>[...l[43]||(l[43]=[(0,n.eW)(" 测试 ",-1)])]),_:1},8,["loading"])])]),default:(0,n.k6)(()=>[(0,n.Lk)("div",Zn,[be.value.length?((0,n.uX)(!0),(0,n.CE)(n.FK,{key:0},(0,n.pI)(be.value,e=>((0,n.uX)(),(0,n.CE)("div",{key:e.botId,class:"agent-item"},[(0,n.Lk)("div",es,[(0,n.Lk)("img",{src:`/icon/${e.platform||"coze"}.${Fe(e.platform)}`,alt:e.platform||"coze",class:"platform-icon"},null,8,as),(0,n.Lk)("div",ts,[(0,n.Lk)("span",ls,(0,s.v_)(e.name),1),(0,n.Lk)("span",ns,(0,s.v_)(Ce(e.platform))+": "+(0,s.v_)(w(e.botId)),1)])]),(0,n.Lk)("div",ss,[e.isDefault?((0,n.uX)(),(0,n.Wv)(A,{key:0,size:"small",type:"success",class:"default-tag"},{default:(0,n.k6)(()=>[...l[45]||(l[45]=[(0,n.eW)(" 默认 ",-1)])]),_:1})):(0,n.Q3)("",!0),e.isDefault?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(i,{key:1,type:"primary",link:"",onClick:a=>q(e)},{default:(0,n.k6)(()=>[...l[46]||(l[46]=[(0,n.eW)(" 设为默认 ",-1)])]),_:1},8,["onClick"])),(0,n.bF)(i,{type:"danger",link:"",onClick:a=>ke(e)},{default:(0,n.k6)(()=>[(0,n.bF)($,null,{default:(0,n.k6)(()=>[(0,n.bF)(K)]),_:1})]),_:1},8,["onClick"])])]))),128)):((0,n.uX)(),(0,n.Wv)(B,{key:1,description:"暂无配置的智能体"}))]),(0,n.Lk)("div",os,[(0,n.bF)(i,{type:"primary",onClick:_e},{default:(0,n.k6)(()=>[...l[47]||(l[47]=[(0,n.eW)(" 添加智能体 ",-1)])]),_:1})])]),_:1}),(0,n.bF)(x,{class:"setting-card",id:"moment-settings"},{header:(0,n.k6)(()=>[...l[48]||(l[48]=[(0,n.Lk)("div",{class:"card-header"},[(0,n.Lk)("span",null,"朋友圈评论设置")],-1)])]),default:(0,n.k6)(()=>[(0,n.Lk)("div",is,[(0,n.bF)(T,{model:W.value,"label-width":"120px"},{default:(0,n.k6)(()=>[(0,n.bF)(R,{label:"总评论条数限制"},{default:(0,n.k6)(()=>[(0,n.bF)(ae,{modelValue:W.value.commentLimit,"onUpdate:modelValue":l[5]||(l[5]=e=>W.value.commentLimit=e),min:1,max:1e3,placeholder:"每次评论条数上限",onKeydown:l[6]||(l[6]=(0,Se.jR)((0,Se.D$)(()=>{},["prevent"]),["enter"]))},null,8,["modelValue"])]),_:1}),(0,n.bF)(R,{label:"单好友评论次数"},{default:(0,n.k6)(()=>[(0,n.bF)(ae,{modelValue:W.value.perFriendLimit,"onUpdate:modelValue":l[7]||(l[7]=e=>W.value.perFriendLimit=e),min:1,max:10,"default-value":2,placeholder:"单个好友评论次数上限",onKeydown:l[8]||(l[8]=(0,Se.jR)((0,Se.D$)(()=>{},["prevent"]),["enter"]))},null,8,["modelValue"])]),_:1}),(0,n.bF)(R,{label:"互动模式"},{default:(0,n.k6)(()=>[(0,n.bF)(ie,{modelValue:W.value.interactionMode,"onUpdate:modelValue":l[9]||(l[9]=e=>W.value.interactionMode=e),placeholder:"请选择点评模式"},{default:(0,n.k6)(()=>[(0,n.bF)(oe,{label:"仅点赞",value:"like_only"}),(0,n.bF)(oe,{label:"仅评论",value:"comment_only"}),(0,n.bF)(oe,{label:"点赞&评论",value:"like_and_comment"})]),_:1},8,["modelValue"])]),_:1}),(0,n.bF)(R,{label:"选择智能体"},{default:(0,n.k6)(()=>[(0,n.bF)(ie,{modelValue:W.value.agentId,"onUpdate:modelValue":l[10]||(l[10]=e=>W.value.agentId=e),placeholder:"请选择智能体"},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(be.value,e=>((0,n.uX)(),(0,n.Wv)(oe,{key:e.botId,label:e.name,value:e.botId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,n.bF)(R,{label:"黑名单"},{default:(0,n.k6)(()=>[(0,n.bF)(E,{modelValue:W.value.blacklist,"onUpdate:modelValue":l[11]||(l[11]=e=>W.value.blacklist=e),type:"textarea",rows:4,placeholder:"黑名单用户默认不评论和点赞，多个黑名单中间用、隔开"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),(0,n.Lk)("div",rs,[(0,n.bF)(i,{type:"primary",onClick:G},{default:(0,n.k6)(()=>[...l[49]||(l[49]=[(0,n.eW)("保存设置",-1)])]),_:1})])])]),_:1}),(0,n.bF)(fn,{visible:ye.value,"onUpdate:visible":l[12]||(l[12]=e=>ye.value=e),agents:be.value,"onUpdate:agents":l[13]||(l[13]=e=>be.value=e)},null,8,["visible","agents"]),(0,n.bF)(x,{class:"setting-card",id:"greeting-settings"},{header:(0,n.k6)(()=>[...l[50]||(l[50]=[(0,n.Lk)("div",{class:"card-header"},[(0,n.Lk)("span",null,"话术组配置（可配合智能体）")],-1)])]),default:(0,n.k6)(()=>[(0,n.bF)(Pn)]),_:1}),(0,n.bF)(x,{class:"setting-card",id:"chat-history-settings"},{header:(0,n.k6)(()=>[...l[51]||(l[51]=[(0,n.Lk)("div",{class:"card-header"},[(0,n.Lk)("span",null,"AI回复配置")],-1),(0,n.Lk)("div",{class:"tip-text"},"聊天记录自动保存本地data文件夹",-1)])]),default:(0,n.k6)(()=>[(0,n.Lk)("div",cs,[(0,n.bF)(T,{model:S.value,"label-width":"0px"},{default:(0,n.k6)(()=>[(0,n.bF)(R,{class:"chat-history-form-item"},{default:(0,n.k6)(()=>[l[52]||(l[52]=(0,n.Lk)("span",{class:"form-item-label"},"消息合并回复",-1)),(0,n.Lk)("div",us,[(0,n.bF)(ie,{modelValue:S.value.messageMerge.mode,"onUpdate:modelValue":l[14]||(l[14]=e=>S.value.messageMerge.mode=e),onChange:ge,class:"merge-mode-select"},{default:(0,n.k6)(()=>[(0,n.bF)(oe,{label:"不合并",value:"none"}),(0,n.bF)(oe,{label:"消息合并",value:"concat"})]),_:1},8,["modelValue"]),(0,n.bF)(ue,{content:"一个监听周期内，好友连续发消息可合并回复",placement:"left"},{default:(0,n.k6)(()=>[(0,n.bF)($,{class:"help-icon"},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(r.QuestionFilled))]),_:1})]),_:1})])]),_:1}),(0,n.bF)(R,{class:"chat-history-form-item"},{default:(0,n.k6)(()=>[l[53]||(l[53]=(0,n.Lk)("span",{class:"form-item-label"},"消息监听间隔(秒)",-1)),(0,n.Lk)("div",ds,[(0,n.bF)(ae,{modelValue:S.value.messageMerge.interval,"onUpdate:modelValue":l[15]||(l[15]=e=>S.value.messageMerge.interval=e),min:4,max:20,step:1,onChange:ge,class:"interval-input",onKeydown:l[16]||(l[16]=(0,Se.jR)((0,Se.D$)(()=>{},["prevent"]),["enter"]))},null,8,["modelValue"]),(0,n.bF)(ue,{content:"读取会话列表的频率，默认5秒",placement:"left"},{default:(0,n.k6)(()=>[(0,n.bF)($,{class:"help-icon"},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(r.QuestionFilled))]),_:1})]),_:1})])]),_:1}),(0,n.bF)(R,{class:"chat-history-form-item"},{default:(0,n.k6)(()=>[l[54]||(l[54]=(0,n.Lk)("span",{class:"form-item-label"},"AI智能体上下文",-1)),(0,n.bF)(fe,{modelValue:S.value.includeContext,"onUpdate:modelValue":l[17]||(l[17]=e=>S.value.includeContext=e),"active-text":"开启","inactive-text":"关闭",onChange:ge},null,8,["modelValue"])]),_:1}),S.value.includeContext?((0,n.uX)(),(0,n.Wv)(R,{key:0,class:"chat-history-form-item"},{default:(0,n.k6)(()=>[l[55]||(l[55]=(0,n.Lk)("span",{class:"form-item-label"},"携带上下文条数",-1)),(0,n.Lk)("div",vs,[(0,n.bF)(ae,{modelValue:S.value.contextCount,"onUpdate:modelValue":l[18]||(l[18]=e=>S.value.contextCount=e),min:3,max:15,step:1,onChange:ge,class:"context-count-input",onKeydown:l[19]||(l[19]=(0,Se.jR)((0,Se.D$)(()=>{},["prevent"]),["enter"]))},null,8,["modelValue"]),(0,n.bF)(ue,{content:"上下文可提升AI回复质量，推荐3-10条",placement:"left"},{default:(0,n.k6)(()=>[(0,n.bF)($,{class:"help-icon"},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(r.QuestionFilled))]),_:1})]),_:1})])]),_:1})):(0,n.Q3)("",!0),(0,n.bF)(R,{class:"transfer-form-item"},{default:(0,n.k6)(()=>[l[59]||(l[59]=(0,n.Lk)("div",{class:"transfer-title"},[(0,n.Lk)("span",{class:"form-item-label"},"转人工配置")],-1)),(0,n.Lk)("div",ms,[(0,n.Lk)("div",ps,[(0,n.Lk)("div",gs,[l[57]||(l[57]=(0,n.Lk)("h3",null,"话术词",-1)),(0,n.bF)(i,{type:"primary",size:"small",onClick:z,disabled:S.value.transferConfig.phrases.length>=3},{default:(0,n.k6)(()=>[...l[56]||(l[56]=[(0,n.eW)(" +添加 ",-1)])]),_:1},8,["disabled"])]),l[58]||(l[58]=(0,n.Lk)("p",{class:"description"},"当AI回复命中话术词时，触发飞书通知",-1)),(0,n.Lk)("div",ks,[(0,n.Lk)("div",hs,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(S.value.transferConfig.phrases,(e,a)=>((0,n.uX)(),(0,n.Wv)(A,{key:a,closable:"",onClose:e=>N(a)},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(e),1)]),_:2},1032,["onClose"]))),128)),v.value?((0,n.uX)(),(0,n.Wv)(E,{key:0,ref_key:"phraseInputRef",ref:p,modelValue:m.value,"onUpdate:modelValue":l[20]||(l[20]=e=>m.value=e),class:"phrase-input",size:"small",placeholder:"请输入识别话术",onKeyup:(0,Se.jR)(M,["enter"]),onBlur:M},null,8,["modelValue"])):(0,n.Q3)("",!0)])])])])]),_:1})]),_:1},8,["model"])])]),_:1}),(0,n.bF)(x,{class:"setting-card",id:"external-api-settings"},{header:(0,n.k6)(()=>[...l[60]||(l[60]=[(0,n.Lk)("div",{class:"card-header"},[(0,n.Lk)("span",null,"外部API配置")],-1)])]),default:(0,n.k6)(()=>[(0,n.Lk)("div",fs,[(0,n.Lk)("div",ys,[(0,n.Lk)("div",bs,[(0,n.Lk)("div",_s,[(0,n.bF)($,null,{default:(0,n.k6)(()=>[(0,n.bF)(we)]),_:1})]),l[61]||(l[61]=(0,n.Lk)("div",{class:"info-content"},[(0,n.Lk)("div",{class:"info-text"},"定制API需要对接调试，可联系客服咨询")],-1))])]),(0,n.bF)(T,{model:k.value,"label-width":"0",class:"external-api-form"},{default:(0,n.k6)(()=>[(0,n.bF)(R,{class:"api-identifier-form-item"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",ws,[l[63]||(l[63]=(0,n.Lk)("span",{class:"form-item-label"},"API标识符",-1)),(0,n.Lk)("div",Ls,[(0,n.bF)(E,{modelValue:k.value.identifier,"onUpdate:modelValue":l[21]||(l[21]=e=>k.value.identifier=e),placeholder:"请输入API标识符",onInput:(0,o.R1)(me),formatter:de,parser:ve,maxlength:"50"},null,8,["modelValue","onInput"]),(0,n.bF)(i,{type:"primary",icon:(0,o.R1)(r.Connection),loading:h.value,disabled:!k.value.identifier||k.value.identifier.length<4,onClick:pe,class:"test-connection-btn"},{default:(0,n.k6)(()=>[...l[62]||(l[62]=[(0,n.eW)(" 测试 ",-1)])]),_:1},8,["icon","loading","disabled"])])])]),_:1}),f.value?((0,n.uX)(),(0,n.Wv)(R,{key:0,class:"connection-status-form-item"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",Fs,[l[64]||(l[64]=(0,n.Lk)("span",{class:"form-item-label"},"连接状态",-1)),(0,n.bF)(A,{type:f.value.success?"success":"danger",icon:f.value.success?(0,o.R1)(r.SuccessFilled):(0,o.R1)(r.CircleCloseFilled)},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(f.value.message),1)]),_:1},8,["type","icon"])])]),_:1})):(0,n.Q3)("",!0)]),_:1},8,["model"])])]),_:1}),(0,n.bF)(x,{class:"setting-card",id:"feishu-settings"},{header:(0,n.k6)(()=>[...l[65]||(l[65]=[(0,n.Lk)("div",{class:"card-header"},[(0,n.Lk)("span",null,"飞书通知")],-1)])]),default:(0,n.k6)(()=>[(0,n.Lk)("div",Cs,[(0,n.Lk)("div",Es,[(0,n.Lk)("div",Is,[(0,n.Lk)("div",Rs,[(0,n.bF)($,null,{default:(0,n.k6)(()=>[(0,n.bF)(we)]),_:1})]),l[66]||(l[66]=(0,n.Lk)("div",{class:"info-content"},[(0,n.Lk)("div",{class:"info-text"},"配置飞书应用与账号，开启转人工等飞书提醒")],-1))])]),(0,n.bF)(T,{model:V.value,"label-width":"0"},{default:(0,n.k6)(()=>[(0,n.bF)(R,{class:"feishu-form-item"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",Ts,[l[67]||(l[67]=(0,n.Lk)("span",{class:"form-item-label"},"APP ID",-1)),(0,n.bF)(E,{modelValue:V.value.appId,"onUpdate:modelValue":l[22]||(l[22]=e=>V.value.appId=e),placeholder:"形如：cli_a9bfed9574f8dcd5",onBlur:U,onKeydown:l[23]||(l[23]=(0,Se.jR)((0,Se.D$)(()=>{},["prevent"]),["enter"])),class:"alert-input"},null,8,["modelValue"])])]),_:1}),(0,n.bF)(R,{class:"feishu-form-item"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",Vs,[l[68]||(l[68]=(0,n.Lk)("span",{class:"form-item-label"},"App Secret",-1)),(0,n.bF)(E,{modelValue:V.value.appSecret,"onUpdate:modelValue":l[24]||(l[24]=e=>V.value.appSecret=e),type:"password","show-password":"",placeholder:"应用密钥，长度需大于10",onBlur:j,onKeydown:l[25]||(l[25]=(0,Se.jR)((0,Se.D$)(()=>{},["prevent"]),["enter"])),class:"alert-input"},null,8,["modelValue"])])]),_:1}),(0,n.bF)(R,{class:"feishu-form-item"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",xs,[l[70]||(l[70]=(0,n.Lk)("span",{class:"form-item-label"},"手机号",-1)),(0,n.bF)(E,{modelValue:V.value.phone,"onUpdate:modelValue":l[26]||(l[26]=e=>V.value.phone=e),placeholder:"请输入飞书注册手机号",maxlength:"11",onInput:D,onBlur:P,onKeydown:l[27]||(l[27]=(0,Se.jR)((0,Se.D$)(()=>{},["prevent"]),["enter"])),class:"alert-input"},{prepend:(0,n.k6)(()=>[...l[69]||(l[69]=[(0,n.eW)("+86",-1)])]),_:1},8,["modelValue"])])]),_:1})]),_:1},8,["model"])])]),_:1}),(0,n.bF)(x,{class:"setting-card",id:"rest-time-settings"},{header:(0,n.k6)(()=>[...l[71]||(l[71]=[(0,n.Lk)("div",{class:"card-header"},[(0,n.Lk)("span",null,"休息时间")],-1)])]),default:(0,n.k6)(()=>[(0,n.Lk)("div",As,[(0,n.Lk)("div",Ws,[(0,n.Lk)("div",Ss,[(0,n.Lk)("div",Ks,[(0,n.bF)($,null,{default:(0,n.k6)(()=>[(0,n.bF)(we)]),_:1})]),l[72]||(l[72]=(0,n.Lk)("div",{class:"info-content"},[(0,n.Lk)("div",{class:"info-text"},"设置任务休息的时间，此期间任务将暂停执行")],-1))])]),(0,n.Lk)("div",Xs,[(0,n.Lk)("div",$s,[l[73]||(l[73]=(0,n.Lk)("div",{class:"setting-indicator"},null,-1)),l[74]||(l[74]=(0,n.Lk)("span",{class:"setting-label"},"休息时间：",-1)),(0,n.Lk)("span",Us,(0,s.v_)(ee(J.value.startTime))+" - "+(0,s.v_)(ee(J.value.endTime)),1)])]),(0,n.Lk)("div",js,[(0,n.Lk)("div",{class:"timeline-wrapper",ref_key:"timelineRef",ref:Q},[(0,n.Lk)("div",Ds,[l[75]||(l[75]=(0,n.Lk)("div",{class:"enabled-range"},null,-1)),Array.isArray(le.value)?((0,n.uX)(!0),(0,n.CE)(n.FK,{key:0},(0,n.pI)(le.value,(e,a)=>((0,n.uX)(),(0,n.CE)("div",{key:a,class:"disabled-range",style:(0,s.Tr)({left:`${e.start}%`,width:`${e.width}%`})},null,4))),128)):((0,n.uX)(),(0,n.CE)("div",{key:1,class:"disabled-range",style:(0,s.Tr)({left:`${le.value.start}%`,width:`${le.value.width}%`})},null,4)),(0,n.Lk)("div",{class:"time-control start-control",style:(0,s.Tr)({left:`${te(J.value.startTime)}%`}),onMousedown:l[28]||(l[28]=e=>se("start",e))},null,36),(0,n.Lk)("div",{class:"time-control end-control",style:(0,s.Tr)({left:`${te(J.value.endTime)}%`}),onMousedown:l[29]||(l[29]=e=>se("end",e))},null,36)])],512)]),(0,n.Lk)("div",Ps,[(0,n.Lk)("div",zs,[(0,n.bF)(ie,{modelValue:H.value,"onUpdate:modelValue":l[30]||(l[30]=e=>H.value=e),onChange:re,placeholder:"🕐 休息开始时间",class:"time-select"},{default:(0,n.k6)(()=>[((0,n.uX)(),(0,n.CE)(n.FK,null,(0,n.pI)(96,e=>(0,n.bF)(oe,{key:e-1,value:ee(e-1),label:ee(e-1)},null,8,["value","label"])),64))]),_:1},8,["modelValue"])]),(0,n.Lk)("div",Ms,[(0,n.bF)(ie,{modelValue:Y.value,"onUpdate:modelValue":l[31]||(l[31]=e=>Y.value=e),onChange:ce,placeholder:"🕐 休息结束时间",class:"time-select"},{default:(0,n.k6)(()=>[((0,n.uX)(),(0,n.CE)(n.FK,null,(0,n.pI)(96,e=>(0,n.bF)(oe,{key:e-1,value:ee(e-1),label:ee(e-1)},null,8,["value","label"])),64))]),_:1},8,["modelValue"])])]),(0,n.Lk)("div",Ns,[(0,n.Lk)("div",Os,[((0,n.uX)(),(0,n.CE)(n.FK,null,(0,n.pI)(Z,e=>(0,n.Lk)("label",{key:e.id,class:"task-option"},[(0,n.Lk)("input",{type:"checkbox",checked:J.value.selectedTasks.includes(e.name),onChange:a=>ne(e.name),class:"task-checkbox"},null,40,Gs),(0,n.Lk)("span",qs,(0,s.v_)(e.icon),1),(0,n.Lk)("span",Js,(0,s.v_)(e.name),1),J.value.selectedTasks.includes(e.name)?((0,n.uX)(),(0,n.CE)("span",Bs," 已应用 ")):(0,n.Q3)("",!0)])),64))]),l[76]||(l[76]=(0,n.Lk)("p",{class:"task-description"}," 未勾选的任务不会受休息时间限制 ",-1))])])]),_:1})],2)]),(0,n.bF)(Le,{modelValue:t.value,"onUpdate:modelValue":l[34]||(l[34]=e=>t.value=e),title:"测试智能体",width:"60%","close-on-click-modal":!1},{footer:(0,n.k6)(()=>[(0,n.Lk)("span",Ys,[(0,n.bF)(i,{onClick:l[33]||(l[33]=e=>t.value=!1)},{default:(0,n.k6)(()=>[...l[77]||(l[77]=[(0,n.eW)("取消",-1)])]),_:1}),(0,n.bF)(i,{type:"primary",loading:X.value,onClick:O},{default:(0,n.k6)(()=>[...l[78]||(l[78]=[(0,n.eW)("测试",-1)])]),_:1},8,["loading"])])]),default:(0,n.k6)(()=>[(0,n.bF)(T,{model:c.value,"label-width":"100px"},{default:(0,n.k6)(()=>[(0,n.bF)(R,{label:"选择智能体"},{default:(0,n.k6)(()=>[(0,n.bF)(ie,{modelValue:c.value.agentId,"onUpdate:modelValue":l[32]||(l[32]=e=>c.value.agentId=e),placeholder:"请选择智能体"},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(be.value,e=>((0,n.uX)(),(0,n.Wv)(oe,{key:e.botId,label:e.name,value:e.botId},{default:(0,n.k6)(()=>[(0,n.Lk)("div",Qs,[(0,n.Lk)("img",{src:`/icon/${e.platform||"coze"}.${Fe(e.platform)}`,alt:e.platform||"coze",style:{width:"20px","margin-right":"8px"}},null,8,Hs),(0,n.eW)(" "+(0,s.v_)(e.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),(0,n.bF)(Le,{modelValue:u.value,"onUpdate:modelValue":l[36]||(l[36]=e=>u.value=e),title:"清除Coze会话缓存",width:"500px","before-close":Re},{footer:(0,n.k6)(()=>[(0,n.Lk)("span",eo,[(0,n.bF)(i,{onClick:l[35]||(l[35]=e=>u.value=!1)},{default:(0,n.k6)(()=>[...l[80]||(l[80]=[(0,n.eW)("取消",-1)])]),_:1}),(0,n.bF)(i,{type:"primary",loading:d.value,onClick:Te},{default:(0,n.k6)(()=>[...l[81]||(l[81]=[(0,n.eW)("清除会话",-1)])]),_:1},8,["loading"])])]),default:(0,n.k6)(()=>[(0,n.Lk)("div",Zs,[(0,n.bF)(Ve,{type:"warning","show-icon":"",closable:!1,class:"cache-warning-banner"},{default:(0,n.k6)(()=>[...l[79]||(l[79]=[(0,n.Lk)("span",{class:"cache-warning-text"}," 为了提高Coze回复的上下文连贯性，机器人会缓存Coze的会话记录。如果你切换了不同的Coze账号，则一定要清除下本地会话缓存，不同Coze账号之间的会话是隔离的。 ",-1)])]),_:1})])]),_:1},8,["modelValue"])],64)}}}),lo=(0,S.A)(to,[["__scopeId","data-v-194f8cd9"]]),no=lo,so={class:"ops-bar"},oo={class:"filters"},io={class:"actions"},ro=(0,n.pM)({__name:"FriendListDialog",props:{visible:{type:Boolean}},emits:["update:visible","refresh"],setup(e,{emit:a}){const t=(0,o.KR)(window.innerWidth),l=e,r=()=>{t.value=window.innerWidth},c=a;(0,n.sV)(()=>{window.addEventListener("resize",r)}),(0,n.hi)(()=>{window.removeEventListener("resize",r)});const u=(0,o.KR)(l.visible),d=(0,o.KR)([]),v=(0,o.KR)([]),m=(0,o.KR)("__ALL__"),p=(0,o.KR)("__ALL__"),g=(0,n.EW)(()=>{const e=new Set;return v.value.forEach(a=>{const t=String(a.tags||"").trim();t&&t.split(",").map(e=>e.trim()).filter(Boolean).forEach(a=>e.add(a))}),Array.from(e)}),k=(0,n.EW)(()=>{let e=v.value.slice();return"__ALL__"!==m.value&&(e=e.filter(e=>String(e.status||"")===m.value)),"__ALL__"!==p.value&&(e=e.filter(e=>{const a=String(e.tags||""),t=p.value;return a===t||a.startsWith(`${t},`)||a.includes(`,${t},`)||a.endsWith(`,${t}`)})),e});(0,n.wB)(()=>l.visible,e=>{u.value=e,e&&h()}),(0,n.wB)(()=>u.value,e=>{c("update:visible",e)});const h=async()=>{try{const e=await(0,Cn.H8)();e.success?(v.value=e.data||[],d.value=k.value):i.nk.error("获取名单失败")}catch(e){console.error("获取名单失败:",e),i.nk.error("获取名单失败")}},f=async()=>{d.value=k.value},y=async e=>{try{const a=await(0,Cn.Y8)(e);a.success?(i.nk.success("删除成功"),await h(),c("refresh")):i.nk.error("删除失败")}catch(a){console.error("删除失败:",a),i.nk.error("删除失败")}},b=async()=>{if(0!==k.value.length)try{await Ke.s.confirm("确认删除当前筛选出的所有记录吗？此操作不可恢复","批量删除",{type:"warning"});const e=k.value.map(e=>String(e.wxid)),a=await(0,Cn.WS)(e);a&&a.success?(i.nk.success("批量删除成功"),await h(),c("refresh")):i.nk.error(a?.error||"批量删除失败")}catch{}else i.nk.warning("没有可删除的数据")},_=async()=>{try{const e="__ALL__"===m.value?"":m.value,a="__ALL__"===p.value?"":p.value,t=await(0,Cn.UV)(e,a);await(0,Ke.s)({title:"文件导出成功",message:`文件保存路径：${t}`,showCancelButton:!0,confirmButtonText:"查看",cancelButtonText:"关闭",callback:async e=>{if("confirm"===e){const e=t.replace(/\\\\/g,"\\").replace(/\\/g,"/"),a=e.lastIndexOf("/"),l=a>-1?e.substring(0,a):e;await(0,Cn.S6)(l)}}})}catch(e){i.nk.error("导出失败")}},w=e=>{const a={pending:"info",added:"success",failed:"danger",unknown:"warning",already:"warning"};return a[e]||"info"},L=e=>{const a={pending:"待添加",added:"已添加",failed:"添加失败",unknown:"账号不存在",already:"已是好友"};return a[e]||e};return(e,a)=>{const l=(0,n.g2)("el-option"),o=(0,n.g2)("el-select"),i=(0,n.g2)("el-button"),r=(0,n.g2)("el-table-column"),c=(0,n.g2)("el-tag"),v=(0,n.g2)("el-table"),h=(0,n.g2)("el-dialog");return(0,n.uX)(),(0,n.Wv)(h,{modelValue:u.value,"onUpdate:modelValue":a[2]||(a[2]=e=>u.value=e),title:"好友名单",width:t.value<=700?"95%":"600px"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",so,[(0,n.Lk)("div",oo,[(0,n.bF)(o,{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=e=>m.value=e),placeholder:"状态",size:"small",class:"filter-select",onChange:f},{default:(0,n.k6)(()=>[(0,n.bF)(l,{label:"全部状态",value:"__ALL__"}),(0,n.bF)(l,{label:"待添加",value:"pending"}),(0,n.bF)(l,{label:"已添加",value:"added"}),(0,n.bF)(l,{label:"添加失败",value:"failed"}),(0,n.bF)(l,{label:"账号不存在",value:"unknown"}),(0,n.bF)(l,{label:"已是好友",value:"already"})]),_:1},8,["modelValue"]),(0,n.bF)(o,{modelValue:p.value,"onUpdate:modelValue":a[1]||(a[1]=e=>p.value=e),placeholder:"标签",size:"small",class:"filter-select",filterable:"",onChange:f},{default:(0,n.k6)(()=>[(0,n.bF)(l,{label:"全部标签",value:"__ALL__"}),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(g.value,e=>((0,n.uX)(),(0,n.Wv)(l,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),(0,n.Lk)("div",io,[(0,n.bF)(i,{type:"primary",plain:"",size:"small",onClick:_},{default:(0,n.k6)(()=>[...a[3]||(a[3]=[(0,n.eW)("导出名单",-1)])]),_:1}),(0,n.bF)(i,{type:"primary",size:"small",onClick:b,disabled:0===k.value.length},{default:(0,n.k6)(()=>[...a[4]||(a[4]=[(0,n.eW)("批量删除",-1)])]),_:1},8,["disabled"])])]),(0,n.bF)(v,{data:d.value,style:{width:"100%"}},{default:(0,n.k6)(()=>[(0,n.bF)(r,{prop:"wxid",label:"微信号",width:"120"}),(0,n.bF)(r,{prop:"remark",label:"备注名",width:"120"}),(0,n.bF)(r,{prop:"tags",label:"标签"}),(0,n.bF)(r,{prop:"status",label:"状态"},{default:(0,n.k6)(({row:e})=>[(0,n.bF)(c,{type:w(e.status)},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(L(e.status)),1)]),_:2},1032,["type"])]),_:1}),(0,n.bF)(r,{label:"操作",width:"100"},{default:(0,n.k6)(({row:e})=>[(0,n.bF)(i,{type:"danger",size:"small",onClick:a=>y(e.wxid)},{default:(0,n.k6)(()=>[...a[5]||(a[5]=[(0,n.eW)(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue","width"])}}}),co=(0,S.A)(ro,[["__scopeId","data-v-69ce074c"]]),uo=co,vo={class:"import-tip"},mo={class:"tip-content"},po={class:"agent-import-tip"},go={class:"tip-content"},ko={class:"agent-select-container"},ho={class:"api-import-tip"},fo={class:"tip-content"},yo={class:"api-status-container"},bo={class:"api-status-item"},_o={key:0,class:"status-value configured"},wo={key:1,class:"status-value not-configured"},Lo={class:"dialog-footer"},Fo="https://healthyeveryday.oss-cn-shanghai.aliyuncs.com/file/%E5%90%8D%E5%8D%95%E6%A8%A1%E6%9D%BF%20.xlsx",Co=(0,n.pM)({__name:"ImportFriendListDialog",props:{visible:{type:Boolean,default:!1},cozeAgents:{type:Array,default:()=>[]}},emits:["update:visible","import","importByAgent","importByApi"],setup(e,{emit:a}){const t=e,l=a,c=(0,o.KR)(!1),u=(0,o.KR)(!1),d=(0,o.KR)([]),v=(0,o.KR)("excel"),m=(0,o.KR)(""),p=(0,o.KR)(""),g=async()=>{try{await navigator.clipboard.writeText(Fo),i.nk.success("已复制下载地址，请前往浏览器下载")}catch(e){i.nk.error("复制失败，请手动复制")}},k=e=>e.length<=8?e:e.substring(0,4)+"****"+e.substring(e.length-4),h=()=>{switch(v.value){case"api":return"立即同步";case"agent":return"立即上传";default:return"立即上传"}},f=async()=>{try{const e=await bn();e&&e.identifier?p.value=e.identifier:p.value=""}catch(e){console.error("加载API配置失败:",e),p.value=""}};(0,n.wB)(()=>t.visible,e=>{c.value=e,e&&f()}),(0,n.wB)(()=>c.value,e=>{e||l("update:visible",!1)}),(0,n.wB)(()=>t.cozeAgents,e=>{e&&e.length>0&&!m.value&&(m.value=e[0].botId)},{immediate:!0});const y=e=>{const a="application/vnd.ms-excel"===e.type||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===e.type||e.name.endsWith(".csv");return!!a||(i.nk.error("只能上传 Excel/CSV 文件!"),!1)},b=e=>{d.value=[e.raw]},_=async()=>{if("excel"===v.value){if(0===d.value.length)return void i.nk.warning("请先选择文件");u.value=!0;try{l("import",d.value[0]),c.value=!1}catch(e){i.nk.error("上传失败")}finally{u.value=!1}}else if("agent"===v.value){if(!m.value)return void i.nk.warning("请先选择智能体");u.value=!0;try{l("importByAgent",m.value),c.value=!1}catch(e){i.nk.error("智能体导入失败")}finally{u.value=!1}}else if("api"===v.value){if(!p.value)return void i.nk.warning("未配置API接口，请先完成配置");u.value=!0;try{const e=await(0,Cn.N2)();e.success?(i.nk.success(`同步成功，共导入 ${e.count} 条数据`),l("importByApi",e),c.value=!1):i.nk.error("同步失败")}catch(e){console.error("API同步失败:",e);const a=e instanceof Error?e.message:"API同步失败";i.nk.error(a)}finally{u.value=!1}}};return(a,t)=>{const l=(0,n.g2)("el-icon"),i=(0,n.g2)("el-button"),d=(0,n.g2)("el-upload"),f=(0,n.g2)("el-tab-pane"),w=(0,n.g2)("el-option"),L=(0,n.g2)("el-select"),F=(0,n.g2)("el-form-item"),C=(0,n.g2)("el-form"),E=(0,n.g2)("el-tabs"),I=(0,n.g2)("el-dialog");return(0,n.uX)(),(0,n.Wv)(I,{title:"导入微信号/手机号名单",modelValue:c.value,"onUpdate:modelValue":t[3]||(t[3]=e=>c.value=e),width:"500px"},{footer:(0,n.k6)(()=>[(0,n.Lk)("span",Lo,[(0,n.bF)(i,{onClick:t[2]||(t[2]=e=>c.value=!1)},{default:(0,n.k6)(()=>[...t[12]||(t[12]=[(0,n.eW)("取消",-1)])]),_:1}),(0,n.bF)(i,{type:"primary",onClick:_,loading:u.value,disabled:"api"===v.value&&!p.value},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(h()),1)]),_:1},8,["loading","disabled"])])]),default:(0,n.k6)(()=>[(0,n.bF)(E,{modelValue:v.value,"onUpdate:modelValue":t[1]||(t[1]=e=>v.value=e)},{default:(0,n.k6)(()=>[(0,n.bF)(f,{label:"Excel导入",name:"excel"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",vo,[(0,n.Lk)("div",mo,[(0,n.bF)(l,{class:"info-icon"},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(r.InfoFilled))]),_:1}),t[5]||(t[5]=(0,n.Lk)("p",null,"将名单录入到表格中，然后导入即可",-1)),(0,n.bF)(i,{type:"primary",link:"",onClick:g,class:"template-btn"},{default:(0,n.k6)(()=>[...t[4]||(t[4]=[(0,n.eW)(" 复制模板下载地址 ",-1)])]),_:1})])]),(0,n.bF)(d,{class:"upload-demo",action:"","auto-upload":!1,"on-change":b,"before-upload":y,accept:".xlsx,.xls,.csv"},{trigger:(0,n.k6)(()=>[(0,n.bF)(i,{plain:""},{default:(0,n.k6)(()=>[...t[6]||(t[6]=[(0,n.eW)("选择文件",-1)])]),_:1})]),tip:(0,n.k6)(()=>[...t[7]||(t[7]=[(0,n.Lk)("div",{class:"el-upload__tip"}," 仅支持 xlsx、xls、csv 格式文件 ",-1)])]),_:1})]),_:1}),(0,n.bF)(f,{label:"智能体导入",name:"agent"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",po,[(0,n.Lk)("div",go,[(0,n.bF)(l,{class:"info-icon"},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(r.InfoFilled))]),_:1}),t[8]||(t[8]=(0,n.Lk)("p",null,"通过智能体连接飞书获取名单数据",-1))])]),(0,n.Lk)("div",ko,[(0,n.bF)(C,{"label-width":"0px"},{default:(0,n.k6)(()=>[(0,n.bF)(F,{class:"agent-select-form-item"},{default:(0,n.k6)(()=>[t[9]||(t[9]=(0,n.Lk)("span",{class:"form-item-label"},"选择智能体",-1)),(0,n.bF)(L,{modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=e=>m.value=e),placeholder:"请选择智能体",class:"agent-select"},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(e.cozeAgents,e=>((0,n.uX)(),(0,n.Wv)(w,{key:e.botId,label:e.name,value:e.botId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})])]),_:1}),(0,n.bF)(f,{label:"API导入",name:"api"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",ho,[(0,n.Lk)("div",fo,[(0,n.bF)(l,{class:"info-icon"},{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(r.InfoFilled))]),_:1}),t[10]||(t[10]=(0,n.Lk)("p",null,"每次执行任务自动同步数据，也可手动点击同步",-1))])]),(0,n.Lk)("div",yo,[(0,n.Lk)("div",bo,[t[11]||(t[11]=(0,n.Lk)("span",{class:"status-label"},"API接口标识：",-1)),p.value?((0,n.uX)(),(0,n.CE)("span",_o,(0,s.v_)(k(p.value))+"（已配置） ",1)):((0,n.uX)(),(0,n.CE)("span",wo," 尚未配置接口，请先完成配置 "))])])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}}),Eo=(0,S.A)(Co,[["__scopeId","data-v-34f2ff2a"]]),Io=Eo;var Ro=t(4962);const To={class:"mass-sending-panel"},Vo={class:"section-title"},xo={class:"header-actions"},Ao={class:"task-list"},Wo={class:"task-info"},So={class:"task-row task-header"},Ko={class:"task-time"},Xo={class:"task-row task-tags"},$o={class:"tag-list"},Uo={class:"task-row task-group"},jo={class:"group-name"},Do={key:0,class:"task-row task-progress"},Po={key:1,class:"task-row task-actions"},zo=(0,n.pM)({__name:"MassSendingPanel",props:{greetingGroups:{},currentInstanceNickname:{}},setup(e){const a=(0,o.KR)([]),t=(0,o.KR)(!1),l=(0,n.EW)(()=>a.value.filter(e=>"pending"===e.status||"scheduled"===e.status).length),c=()=>{t.value=!0},u=e=>{try{return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(a){return"无效时间"}},d=e=>{const a={pending:"info",running:"warning",scheduled:"info",paused:"info",completed:"success",failed:"danger",cancelled:"info"};return a[e]||"info"},v=e=>{const a={pending:"等待执行",running:"执行中",scheduled:"等待执行",paused:"已暂停",completed:"已完成",failed:"执行失败",cancelled:"已取消"};return a[e]||e},m=e=>e&&0!==e.length?e.length<=2?e.join("、"):`${e[0]}、${e[1]}..等${e.length}人`:"",p=e=>e.map(e=>{const a=e?.params?.task_params||e?.params||{};return{id:e.task_id||e.id,sendTime:e.next_run_time||e.schedule_time||e.sendTime||(new Date).toISOString(),tagId:a.tagIds||e.tagId||[],tagName:a.tagIds||e.tagName||[],selectedFriends:a.selectedFriends||e.selectedFriends||[],greetingGroupId:a.greetingGroupId||e.greetingGroupId||"",greetingGroupName:a.greetingGroupId||e.greetingGroupName||"",contentType:a.contentType||e.contentType||"greeting",agentId:a.agentId||e.agentId||"",status:e.status||"pending",progress:e.progress||0,total:e.total||0,error:e.error}}),g=async()=>{try{const e=await(0,Cn._t)();if(e.success){console.debug("加载群发任务列表成功:",e?.data);const{pending:t,running:l}=e.data||{},n=p(l||[]),s=p(t||[]);a.value=[...n,...s]}else console.error("加载群发任务列表失败:",e.error)}catch(e){console.error("加载群发任务列表失败:",e)}},k=async e=>{try{const a={...e,..."agent"===e.contentType?{agentId:e.agentId}:{}},t=await(0,Cn.Gc)(a);console.debug("创建任务。。。",t),await g(),i.nk.success("任务创建成功")}catch(a){console.error("创建任务失败:",a),i.nk.error("创建任务失败")}},h=async e=>{try{await(0,Cn.OV)(e),await g(),i.nk.success("任务已取消")}catch(a){i.nk.error("取消任务失败")}},f=async()=>{try{await Ke.s.confirm("是否取消全部【等待执行】的任务？","确认取消",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await(0,Cn.ky)();e.success?(i.nk.success(e.message||"批量取消成功"),await g()):i.nk.error(e.error||"批量取消失败")}catch(e){"cancel"!==e&&(console.error("批量取消任务失败:",e),i.nk.error("批量取消任务失败"))}},y=e=>{const t=e.detail;if("mass_sending_list_update"===t.type)return console.debug("收到群发任务列表更新通知，重新加载任务列表..."),void g();if("mass_sending"===t.type)if("running"===t.status&&t.task_id){const e=a.value.find(e=>e.id===t.task_id);e&&(e.progress=t.progress,e.total=t.total,"running"!==e.status&&(e.status="running"))}else console.debug(`收到群发任务状态变更(${t.status})，重新加载任务列表...`),g()};return(0,n.sV)(()=>{g(),window.addEventListener("taskStatus",y)}),(0,n.hi)(()=>{window.removeEventListener("taskStatus",y)}),(i,p)=>{const g=(0,n.g2)("el-button"),y=(0,n.g2)("el-empty"),b=(0,n.g2)("el-icon"),_=(0,n.g2)("el-tag"),w=(0,n.g2)("el-scrollbar");return(0,n.uX)(),(0,n.CE)("div",To,[(0,n.Lk)("div",Vo,[p[3]||(p[3]=(0,n.Lk)("span",null,"群发任务",-1)),(0,n.Lk)("div",xo,[l.value>3?((0,n.uX)(),(0,n.Wv)(g,{key:0,type:"danger",link:"",onClick:f},{default:(0,n.k6)(()=>[...p[1]||(p[1]=[(0,n.eW)(" 全部取消 ",-1)])]),_:1})):(0,n.Q3)("",!0),(0,n.bF)(g,{type:"primary",class:"create-task-btn",onClick:c},{default:(0,n.k6)(()=>[...p[2]||(p[2]=[(0,n.eW)(" 新任务 ",-1)])]),_:1})])]),(0,n.bF)(w,{height:"calc(100vh - 100px)"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",Ao,[0===a.value.length?((0,n.uX)(),(0,n.Wv)(y,{key:0,description:"暂无进行中任务"})):((0,n.uX)(!0),(0,n.CE)(n.FK,{key:1},(0,n.pI)(a.value,e=>((0,n.uX)(),(0,n.CE)("div",{key:e.id,class:"task-item"},[(0,n.Lk)("div",Wo,[(0,n.Lk)("div",So,[(0,n.Lk)("span",Ko,[(0,n.bF)(b,null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(r.Clock))]),_:1}),(0,n.eW)(" "+(0,s.v_)(u(e.sendTime)),1)]),(0,n.bF)(_,{type:d(e.status),size:"small"},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(v(e.status)),1)]),_:2},1032,["type"])]),(0,n.Lk)("div",Xo,[p[4]||(p[4]=(0,n.Lk)("span",{class:"label"},"群发人群：",-1)),(0,n.Lk)("div",$o,[e.selectedFriends&&e.selectedFriends.length?((0,n.uX)(),(0,n.CE)(n.FK,{key:0},[(0,n.eW)((0,s.v_)(m(e.selectedFriends)),1)],64)):((0,n.uX)(!0),(0,n.CE)(n.FK,{key:1},(0,n.pI)(e.tagName,e=>((0,n.uX)(),(0,n.Wv)(_,{size:"small",key:e},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(e),1)]),_:2},1024))),128))])]),(0,n.Lk)("div",Uo,[p[5]||(p[5]=(0,n.Lk)("span",{class:"label"},"话术方式：",-1)),(0,n.Lk)("span",jo,(0,s.v_)("agent"===e.contentType?"智能体生成":"固定话术组"),1)]),"running"===e.status||e.progress&&e.total?((0,n.uX)(),(0,n.CE)("div",Do," 进度: "+(0,s.v_)(e.progress||0)+"/"+(0,s.v_)(e.total||0),1)):(0,n.Q3)("",!0),"pending"===e.status||"scheduled"===e.status?((0,n.uX)(),(0,n.CE)("div",Po,[(0,n.bF)(g,{type:"danger",size:"small",onClick:(0,Se.D$)(a=>h(e.id),["stop"])},{default:(0,n.k6)(()=>[...p[6]||(p[6]=[(0,n.eW)(" 取消任务 ",-1)])]),_:1},8,["onClick"])])):(0,n.Q3)("",!0)])]))),128))])]),_:1}),(0,n.bF)(Ro.A,{visible:t.value,"onUpdate:visible":p[0]||(p[0]=e=>t.value=e),"greeting-groups":e.greetingGroups,"wechat-nickname":e.currentInstanceNickname,"is-from-sop":!0,onCreate:k},null,8,["visible","greeting-groups","wechat-nickname"])])}}}),Mo=(0,S.A)(zo,[["__scopeId","data-v-1b1c8390"]]),No=Mo,Oo={class:"auto-follow-task-list"},Go={class:"section-title"},qo={class:"task-count"},Jo={class:"title-buttons"},Bo={class:"filter-item"},Qo={class:"filter-item"},Ho={class:"task-list"},Yo={key:0,class:"task-checkbox"},Zo={class:"task-info"},ei={class:"task-row task-header"},ai={class:"friend-info"},ti={class:"friend-name"},li={class:"friend-wxid"},ni={class:"task-row task-time"},si={class:"time"},oi={class:"task-row task-next"},ii={class:"time"},ri={class:"task-row task-agent"},ci={class:"agent-name"},ui={class:"task-row task-stats"},di={class:"stats-text"},vi={class:"stats-detail"},mi={class:"batch-operations fixed"},pi={class:"batch-left"},gi={class:"select-all"},ki={class:"selected-count"},hi={class:"batch-right"},fi={class:"dialog-item"},yi={class:"dialog-footer"},bi=(0,n.pM)({__name:"AutoFollowTaskList",setup(e,{expose:a}){const t=(0,o.KR)([]),l=(0,o.KR)(new Set),r=(0,o.KR)(!1),c=(0,o.KR)([]),u=(0,o.KR)(!1),d=(0,o.KR)(""),v=(0,o.KR)(""),m=(0,o.KR)(null),p=(0,o.KR)(0),g=(0,o.KR)(!1),k=(0,o.KR)(!1),h=(0,o.KR)(""),f=(0,n.EW)({get:()=>t.value.length>0&&t.value.every(e=>e.selected),set:e=>{t.value.forEach(a=>a.selected=e),w()}}),y=()=>{u.value=!u.value,u.value||(b(),_())},b=()=>{d.value="",v.value="",T()},_=()=>{t.value.forEach(e=>e.selected=!1),w()},w=()=>{p.value=t.value.filter(e=>e.selected).length},L=async()=>{try{if(r.value=!0,v.value||d.value){const e=await(0,Ze.KY)(v.value||void 0,d.value||void 0);e&&Array.isArray(e)?t.value=e.map(e=>({...e,selected:!1})):t.value=[]}else await T()}catch(e){console.error("筛选任务失败:",e),i.nk.error(e instanceof Error?e.message:"筛选任务失败")}finally{r.value=!1}},F=async()=>{await L()},C=async()=>{const e=t.value.filter(e=>e.selected);if(0!==e.length)try{await Ke.s.confirm(`确定要批量取消选中的 ${e.length} 个自动跟单任务吗？`,"确认取消",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),g.value=!0;const a=e.map(e=>e.task_info.task_id);await(0,Ze.J9)(a),i.nk.success("批量取消成功"),await L()}catch(a){"cancel"!==a&&(console.error("批量取消任务失败:",a),i.nk.error(a instanceof Error?a.message:"批量取消任务失败"))}finally{g.value=!1}},E=()=>{const e=t.value.filter(e=>e.selected);0!==e.length?(h.value="",k.value=!0):i.nk.warning("请先选择需要修改的任务")},I=async()=>{try{const e=await(0,ea.zj)("agents");if(e.success&&e.data){const a=Array.isArray(e.data)?e.data:Array.isArray(e.data.agents)?e.data.agents:[];c.value=a.filter(e=>e.name&&e.botId)}}catch(e){console.error("获取智能体配置失败:",e)}},R=e=>{if(!e)return"—";const a=c.value.find(a=>a.botId===e);return a?.name||"未知智能体"},T=async()=>{try{r.value=!0;const e=await(0,Cn.DT)();t.value=(e||[]).map(e=>({...e,selected:!1}))}catch(e){console.error("获取自动跟单任务列表失败:",e),i.nk.error(e instanceof Error?e.message:"获取任务列表失败")}finally{r.value=!1}},V=async e=>{try{await Ke.s.confirm(`确定要取消对 ${e.friend_info.name} 的自动跟单吗？`,"确认取消",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),l.value.add(e.friend_info.wxid),await(0,Cn.WA)(e.task_info.task_id),i.nk.success("取消成功"),await T()}catch(a){"cancel"!==a&&(console.error("取消任务失败:",a),i.nk.error(a instanceof Error?a.message:"取消任务失败"))}finally{l.value.delete(e.friend_info.wxid)}},x=()=>{i.nk.info("开发中，下个版本支持...如需创建任务，请前往客户管理创建")},A=e=>{if(!e)return"--";try{const a=new Date(e),t=String(a.getMonth()+1).padStart(2,"0"),l=String(a.getDate()).padStart(2,"0"),n=String(a.getHours()).padStart(2,"0"),s=String(a.getMinutes()).padStart(2,"0");return`${t}月${l}日 ${n}:${s}`}catch{return"--"}},W=e=>e?A(e):"计算中...";(0,n.sV)(()=>{I(),T()}),a({refresh:T});const S=async()=>{if(!h.value)return void i.nk.warning("请选择智能体");const e=t.value.filter(e=>e.selected);if(0!==e.length)try{r.value=!0;const a=e.map(e=>e.task_info.task_id),t=await(0,Ze.LD)(a,h.value);t&&t.success?i.nk.success("批量修改成功"):i.nk.error(t?.error||"批量修改失败"),k.value=!1,await L()}catch(a){console.error("批量修改任务失败:",a),i.nk.error(a instanceof Error?a.message:"批量修改任务失败")}finally{r.value=!1}else i.nk.warning("请先选择需要修改的任务")},K=()=>{k.value=!1};return(e,a)=>{const o=(0,n.g2)("el-button"),i=(0,n.g2)("el-option"),r=(0,n.g2)("el-select"),b=(0,n.g2)("el-date-picker"),_=(0,n.g2)("el-empty"),L=(0,n.g2)("el-checkbox"),I=(0,n.g2)("el-scrollbar"),T=(0,n.g2)("el-dialog");return(0,n.uX)(),(0,n.CE)("div",Oo,[(0,n.Lk)("div",Go,[a[6]||(a[6]=(0,n.Lk)("span",null,"自动跟单",-1)),(0,n.Lk)("span",qo,(0,s.v_)(t.value.length)+"人",1),(0,n.Lk)("div",Jo,[(0,n.bF)(o,{type:"text",class:"settings-btn",onClick:x},{default:(0,n.k6)(()=>[...a[5]||(a[5]=[(0,n.eW)(" 跟单设置 ",-1)])]),_:1}),(0,n.bF)(o,{type:"text",class:(0,s.C4)(["edit-btn",{active:u.value}]),onClick:y},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(u.value?"完成":"编辑"),1)]),_:1},8,["class"])])]),(0,n.bF)(Se.eB,{name:"slide-fade"},{default:(0,n.k6)(()=>[(0,n.bo)((0,n.Lk)("div",{class:"filter-panel",ref_key:"filterPanel",ref:m},[(0,n.Lk)("div",Bo,[a[7]||(a[7]=(0,n.Lk)("span",{class:"filter-label"},"智能体：",-1)),(0,n.bF)(r,{modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=e=>d.value=e),placeholder:"选择智能体",onChange:F,clearable:"",style:{width:"160px"}},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(c.value,e=>((0,n.uX)(),(0,n.Wv)(i,{key:e.botId,label:e.name,value:e.botId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),(0,n.Lk)("div",Qo,[a[8]||(a[8]=(0,n.Lk)("span",{class:"filter-label"},"创建日期：",-1)),(0,n.bF)(b,{modelValue:v.value,"onUpdate:modelValue":a[1]||(a[1]=e=>v.value=e),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:F,clearable:"",style:{width:"160px"}},null,8,["modelValue"])])],512),[[Se.aG,u.value]])]),_:1}),(0,n.bF)(I,{height:"calc(100vh - 100px)"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",Ho,[0===t.value.length?((0,n.uX)(),(0,n.Wv)(_,{key:0,description:"暂无跟进任务","image-size":80})):((0,n.uX)(!0),(0,n.CE)(n.FK,{key:1},(0,n.pI)(t.value,e=>((0,n.uX)(),(0,n.CE)("div",{key:e.task_info.task_id,class:"task-item"},[u.value?((0,n.uX)(),(0,n.CE)("div",Yo,[(0,n.bF)(L,{modelValue:e.selected,"onUpdate:modelValue":a=>e.selected=a,onChange:w},null,8,["modelValue","onUpdate:modelValue"])])):(0,n.Q3)("",!0),(0,n.Lk)("div",Zo,[(0,n.Lk)("div",ei,[(0,n.Lk)("div",ai,[(0,n.Lk)("span",ti,(0,s.v_)(e.friend_info.name),1),(0,n.Lk)("span",li,(0,s.v_)(e.friend_info.wxid),1)]),u.value?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(o,{key:0,type:"danger",size:"small",text:"",onClick:a=>V(e),loading:l.value.has(e.friend_info.wxid)},{default:(0,n.k6)(()=>[...a[9]||(a[9]=[(0,n.eW)(" 取消 ",-1)])]),_:1},8,["onClick","loading"]))]),(0,n.Lk)("div",ni,[a[10]||(a[10]=(0,n.Lk)("span",{class:"label"},"创建时间：",-1)),(0,n.Lk)("span",si,(0,s.v_)(A(e.task_info.created_at)),1)]),(0,n.Lk)("div",oi,[a[11]||(a[11]=(0,n.Lk)("span",{class:"label"},"下次跟进：",-1)),(0,n.Lk)("span",ii,(0,s.v_)(W(e.schedule_info?.next_fire_time)),1)]),(0,n.Lk)("div",ri,[a[12]||(a[12]=(0,n.Lk)("span",{class:"label"},"智能体：",-1)),(0,n.Lk)("span",ci,(0,s.v_)(R(e.task_config?.agent_id)),1)]),(0,n.Lk)("div",ui,[a[13]||(a[13]=(0,n.Lk)("span",{class:"label stats-label"},"跟进统计：",-1)),(0,n.Lk)("span",di,[(0,n.eW)(" 共"+(0,s.v_)(e.execution_stats?.execution_count||0)+"次 ",1),(0,n.Lk)("span",vi," （成功"+(0,s.v_)(e.execution_stats?.total_success||0)+"次） ",1)])])])]))),128))]),(0,n.bF)(Se.eB,{name:"slide-fade"},{default:(0,n.k6)(()=>[(0,n.bo)((0,n.Lk)("div",mi,[(0,n.Lk)("div",pi,[(0,n.Lk)("div",gi,[(0,n.bF)(L,{modelValue:f.value,"onUpdate:modelValue":a[2]||(a[2]=e=>f.value=e)},{default:(0,n.k6)(()=>[...a[14]||(a[14]=[(0,n.eW)(" 全选 ",-1)])]),_:1},8,["modelValue"])]),(0,n.Lk)("div",ki,"已选："+(0,s.v_)(p.value)+"个",1)]),(0,n.Lk)("div",hi,[(0,n.bF)(o,{type:"danger",size:"small",onClick:C,disabled:0===p.value,loading:g.value},{default:(0,n.k6)(()=>[...a[15]||(a[15]=[(0,n.eW)(" 批量取消 ",-1)])]),_:1},8,["disabled","loading"]),(0,n.bF)(o,{type:"primary",size:"small",onClick:E,disabled:0===p.value},{default:(0,n.k6)(()=>[...a[16]||(a[16]=[(0,n.eW)(" 批量修改 ",-1)])]),_:1},8,["disabled"])])],512),[[Se.aG,u.value]])]),_:1})]),_:1}),(0,n.bF)(T,{modelValue:k.value,"onUpdate:modelValue":a[4]||(a[4]=e=>k.value=e),title:"修改跟单任务",width:"480px"},{footer:(0,n.k6)(()=>[(0,n.Lk)("span",yi,[(0,n.bF)(o,{onClick:K},{default:(0,n.k6)(()=>[...a[18]||(a[18]=[(0,n.eW)("取消",-1)])]),_:1}),(0,n.bF)(o,{type:"primary",disabled:!h.value,onClick:S},{default:(0,n.k6)(()=>[...a[19]||(a[19]=[(0,n.eW)("确定",-1)])]),_:1},8,["disabled"])])]),default:(0,n.k6)(()=>[a[20]||(a[20]=(0,n.Lk)("div",{class:"dialog-subtitle"},"可修改跟单任务的智能体",-1)),(0,n.Lk)("div",fi,[a[17]||(a[17]=(0,n.Lk)("span",{class:"filter-label"},"选择智能体：",-1)),(0,n.bF)(r,{modelValue:h.value,"onUpdate:modelValue":a[3]||(a[3]=e=>h.value=e),placeholder:"请选择智能体",style:{width:"240px"}},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(c.value,e=>((0,n.uX)(),(0,n.Wv)(i,{key:e.botId,label:e.name,value:e.botId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])])}}}),_i=(0,S.A)(bi,[["__scopeId","data-v-689993da"]]),wi=_i,Li={class:"auto-follow-logs"},Fi={class:"logs-container"},Ci={class:"log-header"},Ei={class:"friend-info"},Ii={class:"friend-details"},Ri={class:"friend-name"},Ti={class:"friend-wxid"},Vi={class:"status-text"},xi={class:"log-time"},Ai={key:0,class:"log-content"},Wi={class:"content-text"},Si={class:"content-main"},Ki={key:0,class:"content-actions"},Xi=30,$i=(0,n.pM)({__name:"AutoFollowLogs",setup(e,{expose:a}){const t=(0,o.KR)([]),l=(0,o.KR)(!1),r=(0,o.KR)(new Set),c=async()=>{try{l.value=!0;const e=await(0,Cn.A2)();t.value=e||[]}catch(e){console.error("获取自动跟单执行日志失败:",e),i.nk.error(e instanceof Error?e.message:"获取执行日志失败")}finally{l.value=!1}},u=e=>{if(!e)return"--";try{const a=new Date(e),t=String(a.getMonth()+1).padStart(2,"0"),l=String(a.getDate()).padStart(2,"0"),n=String(a.getHours()).padStart(2,"0"),s=String(a.getMinutes()).padStart(2,"0"),o=String(a.getSeconds()).padStart(2,"0");return`${t}-${l} ${n}:${s}:${o}`}catch{return"--"}},d=(e,a)=>{if(!e)return"--";const t=e.replace(/\n+/g," ").replace(/\s+/g," ").trim();return m(a)||t.length<=Xi?t:t.substring(0,Xi)+"..."},v=e=>{if(!e)return!1;const a=e.replace(/\n+/g," ").replace(/\s+/g," ").trim();return a.length>Xi},m=e=>r.value.has(e),p=e=>{r.value.has(e)?r.value.delete(e):r.value.add(e)},g=e=>{switch(e){case"success":return"status-success";case"failed":return"status-failed";case"pending":return"status-pending";default:return"status-unknown"}},k=e=>{switch(e){case"success":return"发送成功";case"failed":return"发送失败";case"pending":return"发送中";default:return"未知状态"}};return(0,n.sV)(()=>{c()}),a({refresh:c}),(e,a)=>{const o=(0,n.g2)("el-empty"),i=(0,n.g2)("el-button"),r=(0,n.g2)("el-scrollbar");return(0,n.uX)(),(0,n.CE)("div",Li,[(0,n.bF)(r,{height:"calc(100vh - 100px)"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",Fi,[0!==t.value.length||l.value?((0,n.uX)(!0),(0,n.CE)(n.FK,{key:1},(0,n.pI)(t.value,e=>((0,n.uX)(),(0,n.CE)("div",{key:e.id,class:(0,s.C4)(["log-item",{"failed-item":"failed"===e.status}])},[(0,n.Lk)("div",Ci,[(0,n.Lk)("div",Ei,[(0,n.Lk)("div",Ii,[(0,n.Lk)("span",Ri,(0,s.v_)(e.friend_name),1),(0,n.Lk)("span",Ti,(0,s.v_)(e.friend_wxid),1)]),(0,n.Lk)("div",{class:(0,s.C4)(["log-status",g(e.status)])},[(0,n.Lk)("span",Vi,(0,s.v_)(k(e.status)),1)],2)])]),(0,n.Lk)("div",xi,"跟进日期:"+(0,s.v_)(u(e.execution_time)),1),"failed"!==e.status?((0,n.uX)(),(0,n.CE)("div",Ai,[a[0]||(a[0]=(0,n.Lk)("div",{class:"content-label"},"跟进内容：",-1)),(0,n.Lk)("div",Wi,[(0,n.Lk)("div",Si,(0,s.v_)(d(e.message_content,e.id)),1),v(e.message_content)?((0,n.uX)(),(0,n.CE)("div",Ki,[(0,n.bF)(i,{type:"text",size:"small",class:"toggle-btn",onClick:a=>p(e.id)},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(m(e.id)?"收起":"展开"),1)]),_:2},1032,["onClick"])])):(0,n.Q3)("",!0)])])):(0,n.Q3)("",!0)],2))),128)):((0,n.uX)(),(0,n.Wv)(o,{key:0,description:"暂无执行日志","image-size":80}))])]),_:1})])}}}),Ui=(0,S.A)($i,[["__scopeId","data-v-6c6d9c38"]]),ji=Ui;var Di=t(4963);const Pi={class:"cosmic-toggle"},zi=["id"],Mi=["for"],Ni={__name:"CosmicSwitch",props:{modelValue:{type:Boolean,default:!1},activeText:{type:String,default:"停止任务"},inactiveText:{type:String,default:"启动任务"},loading:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(e,{emit:a}){const t=e,l=a,s=(0,n.EW)(()=>`cosmic-switch-${(0,Di.A)().substring(0,8)}`),i=(0,o.KR)(t.modelValue);(0,n.wB)(()=>t.modelValue,e=>{i.value=e}),(0,n.wB)(i,e=>{l("update:modelValue",e)});const r=()=>{t.loading?i.value=t.modelValue:l("change",i.value)};return(e,a)=>((0,n.uX)(),(0,n.CE)("div",Pi,[(0,n.bo)((0,n.Lk)("input",{type:"checkbox",class:"toggle",id:s.value,"onUpdate:modelValue":a[0]||(a[0]=e=>i.value=e),onChange:r},null,40,zi),[[Se.lH,i.value]]),(0,n.Lk)("label",{for:s.value,class:"slider"},[...a[1]||(a[1]=[(0,n.Fv)('<div class="cosmos" data-v-ad99a1d2></div><div class="toggle-orb" data-v-ad99a1d2><div class="inner-orb" data-v-ad99a1d2><div class="ring" data-v-ad99a1d2></div></div></div><div class="particles" data-v-ad99a1d2><div class="particle" style="--angle:0deg;" data-v-ad99a1d2></div><div class="particle" style="--angle:60deg;" data-v-ad99a1d2></div><div class="particle" style="--angle:120deg;" data-v-ad99a1d2></div><div class="particle" style="--angle:180deg;" data-v-ad99a1d2></div><div class="particle" style="--angle:240deg;" data-v-ad99a1d2></div><div class="particle" style="--angle:300deg;" data-v-ad99a1d2></div></div>',3)])],8,Mi)]))}},Oi=(0,S.A)(Ni,[["__scopeId","data-v-ad99a1d2"]]),Gi=Oi;var qi=t(4373);const Ji=qi.A.create({baseURL:ea.JR,timeout:15e3,headers:ea.b3});Ji.interceptors.response.use(e=>e.data,e=>(console.error("响应错误:",e),i.nk.error(e.message||"请求失败"),Promise.reject(e)));const Bi=async e=>{try{const a=await Ji(e);return a}catch(a){throw a}},Qi=async()=>await Bi({url:"/api/moment-material/select-folder",method:"GET"}),Hi=async e=>await Bi({url:"/api/moment-material/open-folder",method:"GET",params:{path:e}}),Yi=async()=>await Bi({url:"/api/instances/active",method:"GET"}),Zi=async e=>await Bi({url:"/api/moment/post-task",method:"POST",data:e}),er=async()=>await Bi({url:"/api/moment/post-tasks",method:"GET"}),ar=async e=>await Bi({url:"/api/moment/post-task/cancel",method:"POST",data:{task_id:e}}),tr=async()=>await Bi({url:"/api/moment/post-logs",method:"GET"}),lr={class:"auto-sop-container"},nr={class:"function-section"},sr={class:"function-list"},or={class:"function-icon"},ir=["src"],rr={class:"function-icon"},cr=["src"],ur={class:"function-icon"},dr=["src"],vr={class:"function-icon"},mr=["src"],pr={class:"function-icon"},gr=["src"],kr={class:"content-wrapper"},hr={class:"config-section"},fr={class:"config-content"},yr={style:{background:"linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%)",border:"1px solid #e1bee7",padding:"6px 8px","border-radius":"8px",color:"#4a148c","font-weight":"500","box-shadow":"0 2px 6px rgba(74, 20, 140, 0.1)",position:"relative",overflow:"hidden"}},br={style:{position:"relative","z-index":"1"}},_r={key:0,style:{"font-size":"13px"}},wr={key:1,style:{"font-size":"13px"}},Lr={class:"comment-action"},Fr={key:0,class:"comment-tip"},Cr={key:0,class:"config-tip"},Er={class:"config-content"},Ir={class:"section-title"},Rr={class:"button-group"},Tr={class:"remaining-count"},Vr={key:0,class:"config-tip"},xr={class:"config-content"},Ar={class:"log-content"},Wr={class:"log-time"},Sr={class:"log-info"},Kr={class:"publisher"},Xr={class:"moment-content"},$r={class:"comment-info"},Ur={key:0,class:"like-action"},jr={key:1,class:"comment-action"},Dr={class:"comment-text"},Pr={key:1,class:"empty-state"},zr={class:"log-header"},Mr={class:"log-status-time"},Nr={class:"log-time"},Or={class:"log-info"},Gr={class:"task-details"},qr={key:0,class:"task-progress"},Jr={class:"task-group"},Br={key:1,class:"task-schedule"},Qr={key:0,class:"task-error"},Hr={key:1,class:"empty-state"},Yr={class:"log-header"},Zr={class:"log-status-time"},ec={class:"log-time"},ac={class:"log-info"},tc={class:"task-details"},lc={class:"friend-count"},nc={key:0,class:"friend-tag"},sc={key:1,class:"empty-state"},oc={class:"log-header"},ic={class:"log-status-time"},rc={class:"log-time"},cc={class:"log-info"},uc={class:"task-details"},dc={class:"friend-info"},vc={key:0,class:"friend-tags"},mc={class:"greeting-text"},pc={key:1,class:"empty-state"},gc={class:"auth-dialog-content"},kc={class:"auth-actions"},hc={class:"tag-selection-content"},fc={class:"tag-name"},yc={class:"tag-count"},bc={class:"dialog-footer-custom"},_c={class:"action-buttons"},wc=(0,n.pM)({__name:"AutoSOP",setup(e){const a=(0,l.lq)(),t=(0,o.KR)([]),c=(0,o.KR)({commentLimit:10,perFriendLimit:2,autoLike:!1,interactionMode:"like_and_comment",checkInterval:120,reachLastPosition:"stop",blacklist:"",agentId:"",enabled:!1,multiCycleEnabled:!1,selectedAccounts:[],selectedTags:[],selectedTagNames:[]}),u=(0,o.KR)({maxFriendsPerDay:10,interval:30,batchSize:1,targetGroup:"",verifyMessage:"",enabled:!1,multiCycleEnabled:!1,selectedAccounts:[]}),d=(0,o.KR)({startTime:0,endTime:28,selectedTasks:[]}),v=(0,o.KR)([]),m=(0,o.KR)(0),p=(0,o.KR)(0),g=(0,o.KR)(!1),k=(0,o.KR)(!1),h=(0,o.KR)(),f=(0,o.KR)(),{getIconPath:y,handleImageLoad:b,handleImageError:_,preloadImages:w}=((0,o.KR)(!1),(0,o.KR)([]),P({comment:{path:"/icon/wechat_moment.svg",fallback:"/icon/empty.svg"},activate:{path:"/icon/activate_icon.svg",fallback:"/icon/empty.svg"},addFriend:{path:"/icon/friend_request.svg",fallback:"/icon/empty.svg"},addNewFriend:{path:"/icon/add_new_friend_icon.svg",fallback:"/icon/empty.svg"},autoFollow:{path:"/icon/follow_up_icon.svg",fallback:"/icon/empty.svg"},chatAnalysis:{path:"/icon/collect_message.svg",fallback:"/icon/empty.svg"}})),L=(0,o.KR)({maxFriendsPerDay:100,checkInterval:10,maxProcessPerTime:5,tag:"",targetGroup:"",greetingGroupId:"",enabled:!1}),F=()=>{g.value=!0},C=(0,o.KR)(!1),E=(0,o.KR)(""),I=(0,o.KR)(!1),R=()=>{E.value&&(window.open(E.value,"_blank"),I.value=!0)},T=(0,n.EW)(()=>d.value.selectedTasks.includes("自动通过好友")?x(d.value.startTime,d.value.endTime):null),V=(0,n.EW)(()=>d.value.selectedTasks.includes("自动加好友")?x(d.value.startTime,d.value.endTime):null),x=(e,a)=>{const t=e=>{const a=Math.floor(e/4),t=e%4*15;return`${a.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`},l=t(e),n=t(a);return e<=a?`${l}-${n}为休息时间，暂停执行任务，可前往配置页修改`:`${l}-次日${n}为休息时间，暂停执行任务，可前往配置页修改`},A=async()=>{try{const e=await(0,ea.zj)("rest_time_settings");e.success&&e.data?.rest_time_settings&&(d.value={startTime:e.data.rest_time_settings.startTime||0,endTime:e.data.rest_time_settings.endTime||28,selectedTasks:e.data.rest_time_settings.selectedTasks||[]})}catch(e){console.error("加载休息时间配置失败:",e)}},W=async e=>{try{i.nk.info("正在通过智能体导入名单...");const a=await(0,Cn.uV)(e);if(a.needsAuth&&a.authUrl)return E.value=a.authUrl,void(C.value=!0);a.success&&(i.nk.success(`成功导入${a.count}条数据，剩余${a.remaining}条待添加`),m.value=a.remaining)}catch(a){i.nk.error(`导入失败: ${a instanceof Error?a.message:"未知错误"}`)}},S=()=>{k.value=!0},K=()=>{try{localStorage.setItem("addFriendConfig",JSON.stringify(u.value)),Ce("addFriendConfig")}catch(e){console.error("保存评论配置失败:",e)}},X=async()=>{if(0===t.value.length)try{t.value=await(0,Ze.f)()}catch(e){console.error("获取群聊列表失败:",e),i.nk.error("获取群聊列表失败")}},$=(0,o.KR)([]),U=async()=>{try{const e=await Yi();e.success&&($.value=e.instances||[],u.value.multiCycleEnabled&&0===u.value.selectedAccounts.length&&$.value.length>0&&(u.value.selectedAccounts=[$.value[0].account_id]))}catch(e){console.error("获取活跃实例失败:",e)}},j=async e=>{u.value.enabled||(Boolean(e)&&(await U(),0===u.value.selectedAccounts.length&&$.value.length>0&&(u.value.selectedAccounts=[$.value[0].account_id])),K())},D=async()=>{try{const e=await Yi();e.success&&($.value=e.instances||[],c.value.multiCycleEnabled&&0===c.value.selectedAccounts.length&&$.value.length>0&&(c.value.selectedAccounts=[$.value[0].account_id]))}catch(e){console.error("获取活跃实例失败:",e)}},z=async e=>{c.value.enabled||(Boolean(e)&&(await D(),0===c.value.selectedAccounts.length&&$.value.length>0&&(c.value.selectedAccounts=[$.value[0].account_id])),Ee())},M=async e=>{const a=Boolean(e);try{const e=await(0,Cn.lG)(a,u.value);e.success?i.nk.success(a?"已开启自动加好友":"已关闭自动加好友"):(u.value.enabled=!a,i.nk.error(e.error||"操作失败")),K()}catch(t){u.value.enabled=!a,i.nk.error("操作失败"),K()}},N=async e=>{try{const a=await(0,Cn.M5)(e);a.success?(i.nk.success("导入成功"),await Te()):i.nk.error("导入失败")}catch(a){i.nk.error("导入失败"),console.error("导入名单失败",a)}},O=async e=>{try{await(0,Cn.ZD)(e,e?c.value:{}),Ee(),i.nk.success("自动评论已"+(e?"开启":"关闭"))}catch(a){i.nk.error((e?"开启":"关闭")+"自动评论失败"),c.value.enabled=!e,Ee()}},G=e=>{const a=/^[a-zA-Z0-9\u4e00-\u9fa5]+$/;e&&!a.test(e)&&(L.value.tag=e.replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g,""),i.nk.warning("标签只能包含中文、英文和数字"))},q=(0,o.KR)([]),J=(0,o.KR)(!1),B=(0,o.KR)([]),Q=async()=>{try{q.value=await(0,Ze.IZ)(),B.value=[...c.value.selectedTags],J.value=!0}catch(e){console.error("获取标签列表失败:",e),i.nk.error("获取标签列表失败")}},H=()=>{B.value=[],c.value.selectedTags=[],c.value.selectedTagNames=[],Ee(),i.nk.success("标签已重置")},Y=()=>{c.value.selectedTags=[...B.value],c.value.selectedTagNames=B.value.map(e=>{const a=q.value.find(a=>a.id===e);return a?a.name:e}),J.value=!1,Ee()},Z=()=>{B.value=[...c.value.selectedTags],J.value=!1},ee=async()=>{try{q.value=await(0,Ze.IZ)()}catch(e){console.error("加载用户标签失败:",e),i.nk.error("加载用户标签失败")}},ae=e=>{const a={pending:"等待执行",running:"执行中",completed:"已完成",failed:"执行失败",cancelled:"已取消"};return a[e]||e},te=e=>{const a={pending:"info",running:"warning",completed:"success",failed:"danger",cancelled:"info"};return a[e]||"info"},le=e=>{try{return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(a){return"时间格式错误"}},ne=(0,o.KR)([]),se=async()=>{try{const e=await(0,Cn.rY)();ne.value=e,console.debug("好友请求日志:",e)}catch(e){console.error("加载好友请求日志失败:",e),i.nk.error("加载好友请求日志失败")}},oe=(0,n.EW)(()=>"addFriend"===ue.value?ne.value.map(e=>({id:e.task_id,timestamp:e.time,processed_count:e.processed_count,tag:e.tag,status:e.status||"completed",type:"friend_request",error:e.error,progress:e.processed_count,total:void 0,params:{content:`通过了 ${e.processed_count} 个好友申请`,scheduleTime:void 0,progress:e.processed_count,total:void 0,greetingGroupId:void 0}})):"comment"===ue.value?ie.value.map(e=>({id:e.timestamp,timestamp:new Date(e.timestamp).getTime(),taskType:"comment",status:"completed",publisher:e.publisher,content:e.content,comment_content:e.comment_content,description:`${e.publisher} 的朋友圈`,progress:void 0,total:void 0,params:{content:e.content,scheduleTime:void 0,progress:void 0,total:void 0,greetingGroupId:void 0},error:null})):"activate"===ue.value?(console.debug("群发日志信息。。。",me.value),me.value.map(e=>({...e,progress:e.params?.progress,total:e.params?.total,params:{content:e.params?.content||"",scheduleTime:e.params?.scheduleTime,contentType:e.params?.contentType,progress:e.params?.progress,total:e.params?.total,greetingGroupId:e.params?.greetingGroupId}}))):"chatAnalysis"===ue.value?(console.debug("聊天采集日志信息。。。",me.value),me.value.map(e=>({...e,params:{total:e.params?.total||0,progress:e.params?.progress||0}}))):me.value),ie=(0,o.KR)([]),re=async()=>{try{const e=await fetch("/api/moment/interactions"),a=await e.json();a.success?(console.debug("加载朋友圈日志:",a),ie.value=a.data||[]):console.error("加载朋友圈日志失败:",a.error)}catch(e){console.error("加载朋友圈日志失败:",e)}},ce=(0,o.KR)([]),ue=(0,o.KR)("comment"),de=(0,o.KR)(!1),ve=(0,o.KR)([]),me=(0,o.KR)([]),pe=async()=>{try{const e=await(0,Cn.pW)();me.value=e}catch(e){console.error("加载任务日志失败:",e),me.value=[]}},ge=async()=>{try{const e=await(0,ea.zj)("greeting_config");if(e?.data?.greeting_config?.greeting_config){const a=e.data.greeting_config.greeting_config;ve.value=a.map(e=>({id:e.name,name:e.name,greetings:Array.isArray(e.greetings)?e.greetings:[]}))}}catch(e){console.error("加载话术组失败:",e),i.nk.error("加载话术组失败")}},ke=async e=>{const a=L.value.enabled,t=Boolean(e);try{const e=await(0,Cn.zL)(t,L.value);e.success?(i.nk.success(t?"已开启自动通过好友，3秒后会开始执行任务":"已关闭自动通过好友"),L.value.enabled=t,localStorage.setItem("friendConfig",JSON.stringify(L.value)),Ce("friendConfig")):(L.value.enabled=a,L.value={...L.value},i.nk.error(e.error||"操作失败"))}catch(l){L.value.enabled=a,L.value={...L.value},console.error("切换自动通过好友失败:",l),i.nk.error("操作失败")}},he=(0,o.KR)(window.innerWidth>650),fe=()=>{he.value=window.innerWidth>650};(0,n.sV)(async()=>{await _e(),await re(),await ee(),await ge(),await we(),await Ve(),await xe(),await A(),fe(),await w(),window.addEventListener("resize",fe),await U(),await ye()}),(0,n.hi)(()=>{window.removeEventListener("resize",fe)});const ye=async()=>{try{const e=await Yi();e.success&&($.value=e.instances||[])}catch(e){console.error("获取活跃实例失败:",e)}};(0,n.n)(()=>{ye()});const be=(0,n.EW)(()=>{const e=$.value||[],a=e.find(e=>e.is_active);return a?a.nickname:e[0]?.nickname||""}),_e=async()=>{try{const e=await(0,ea.zj)("agents");if(e.success&&e.data){const a=Array.isArray(e.data)?e.data:Array.isArray(e.data.agents)?e.data.agents:[];ce.value=a.filter(e=>e.name&&e.botId);const t=ce.value.find(e=>e.isDefault);t?c.value.agentId=t.botId:ce.value.length>0&&(c.value.agentId=ce.value[0].botId)}}catch(e){console.error("加载智能体配置失败:",e)}},we=async()=>{try{const e=localStorage.getItem("commentConfig");if(e)return void(c.value=JSON.parse(e));if(await Fe(),Le.value?.commentConfig){const e=Le.value.commentConfig,{selectedAccounts:a,...t}=e;return void(c.value={...c.value,...t,enabled:!1})}const a=await(0,ea.zj)("moment_settings");a.success&&a.data?.moment_settings&&(c.value={commentLimit:a.data.moment_settings.commentLimit,perFriendLimit:a.data.moment_settings.perFriendLimit||2,autoLike:a.data.moment_settings.autoLike,interactionMode:a.data.moment_settings.interactionMode||"like_and_comment",blacklist:a.data.moment_settings.blacklist||"",agentId:a.data.moment_settings.agentId||c.value.agentId,checkInterval:120,reachLastPosition:"stop",enabled:!1,multiCycleEnabled:c.value.multiCycleEnabled||!1,selectedAccounts:Array.isArray(c.value.selectedAccounts)?c.value.selectedAccounts:[],selectedTags:[],selectedTagNames:[]})}catch(e){console.error("加载评论配置失败:",e)}},Le=(0,o.KR)(null),Fe=async()=>{try{if(!Le.value){const e=await(0,ea.zj)("sop_cache");e.success&&(Le.value=e.data||{})}}catch(e){console.error("加载SOP缓存失败:",e)}},Ce=async e=>{try{const a=await(0,ea.zj)("sop_cache"),t=a.success&&a.data?a.data:{};let l={};if("commentConfig"===e){const{selectedAccounts:e,...a}=c.value;l=a}else l="addFriendConfig"===e?u.value:L.value;const n={commentConfig:{...t.commentConfig||{},..."commentConfig"===e?l:{},enabled:!1},addFriendConfig:{...t.addFriendConfig||{},..."addFriendConfig"===e?u.value:{},enabled:!1},friendConfig:{...t.friendConfig||{},..."friendConfig"===e?L.value:{},enabled:!1}};await(0,ea.ql)("sop_cache",n)}catch(a){console.error("保存SOP缓存失败:",a)}},Ee=()=>{try{localStorage.setItem("commentConfig",JSON.stringify(c.value)),Ce("commentConfig")}catch(e){console.error("保存评论配置失败:",e)}},Ie=e=>{console.debug("切换功能到:",e),ue.value=e,"addFriend"===e?se():"activate"===e?pe():"addNewFriend"===e?(Re(),Te()):"chatAnalysis"===e&&pe()},Re=async()=>{try{const e=await(0,Cn.Zs)();v.value=e}catch(e){console.error("加载添加好友日志失败:",e),i.nk.error("加载日志失败")}},Te=async()=>{try{const e=await(0,Cn.MV)();"object"===typeof e&&null!==e?(m.value=e.remaining,p.value=e.today_added||0):(m.value=Number(e),p.value=0)}catch(e){console.error("获取剩余可添加好友数量失败:",e)}},Ve=async()=>{try{const e=localStorage.getItem("friendConfig");if(e)return void(L.value=JSON.parse(e));await Fe(),Le.value?.friendConfig&&(L.value={...L.value,...Le.value.friendConfig,enabled:!1})}catch(e){console.error("加载好友配置失败:",e)}},xe=async()=>{try{const e=localStorage.getItem("addFriendConfig");if(e)return void(u.value=JSON.parse(e));await Fe(),Le.value?.addFriendConfig&&(u.value={...u.value,...Le.value.addFriendConfig,enabled:!1})}catch(e){console.error("加载好友配置失败:",e)}},Ae=e=>{try{if(!e)return"时间未知";const a=e.endsWith("Z")?e:e+(e.includes("T")?"Z":""),t=new Date(a),l=t.getUTCFullYear(),n=String(t.getUTCMonth()+1).padStart(2,"0"),s=String(t.getUTCDate()).padStart(2,"0"),o=String(t.getUTCHours()).padStart(2,"0"),i=String(t.getUTCMinutes()).padStart(2,"0"),r=String(t.getUTCSeconds()).padStart(2,"0");return`${l}-${n}-${s} ${o}:${i}:${r}`}catch(a){return console.error("时间格式化错误:",a,"timestamp:",e),e||"时间格式错误"}};return(0,n.wB)(()=>a.query.function,e=>{if(console.debug("AutoSOP==>watch",e),console.debug("AutoSOP类型检查:",{value:e,type:typeof e,isString:"string"===typeof e,isValid:["comment","activate","addFriend","autofollow"].includes(e)}),e&&"string"===typeof e&&["comment","activate","addFriend","autofollow"].includes(e)){console.debug("AutoSOP条件判断通过，准备切换功能");try{console.debug("当前功能值:",ue.value);const a="autofollow"===e?"autoFollow":e;ue.value=a,console.debug("AutoSOP当前功能已切换到:",ue.value),"addFriend"===e?(console.debug("AutoSOP准备加载好友日志"),se()):"activate"===e?(console.debug("AutoSOP准备加载任务日志"),pe()):"autofollow"===e&&console.debug("AutoSOP准备加载自动跟单任务")}catch(a){console.error("AutoSOP切换功能时发生错误:",a)}}else console.debug("AutoSOP条件判断未通过，不执行切换")},{immediate:!0}),(e,a)=>{const l=(0,n.g2)("el-input-number"),i=(0,n.g2)("el-form-item"),d=(0,n.g2)("el-option"),w=(0,n.g2)("el-select"),E=(0,n.g2)("el-button"),x=(0,n.g2)("el-checkbox"),A=(0,n.g2)("el-checkbox-group"),K=(0,n.g2)("el-form"),U=(0,n.g2)("el-icon"),D=(0,n.g2)("el-input"),P=(0,n.g2)("el-tag"),ee=(0,n.g2)("el-scrollbar"),se=(0,n.g2)("el-alert"),re=(0,n.g2)("el-dialog"),me=(0,n.gN)("tooltip");return(0,n.uX)(),(0,n.CE)(n.FK,null,[(0,n.Lk)("div",lr,[(0,n.Lk)("div",nr,[a[52]||(a[52]=(0,n.Lk)("div",{class:"section-title"},"功能",-1)),(0,n.Lk)("div",sr,[(0,n.Lk)("div",{class:(0,s.C4)(["function-item",{active:"comment"===ue.value}]),onClick:a[2]||(a[2]=e=>Ie("comment")),"data-function":"comment"},[(0,n.Lk)("div",or,[(0,n.Lk)("img",{src:(0,o.R1)(y)("comment"),class:(0,s.C4)(["icon",{"active-icon":"comment"===ue.value}]),onError:a[0]||(a[0]=(...e)=>(0,o.R1)(_)&&(0,o.R1)(_)(...e)),onLoad:a[1]||(a[1]=(...e)=>(0,o.R1)(b)&&(0,o.R1)(b)(...e)),alt:"朋友圈运营"},null,42,ir)]),a[47]||(a[47]=(0,n.Lk)("div",{class:"function-tooltip"},"朋友圈运营",-1))],2),(0,n.Lk)("div",{class:(0,s.C4)(["function-item",{active:"activate"===ue.value}]),onClick:a[5]||(a[5]=e=>Ie("activate")),"data-function":"activate"},[(0,n.Lk)("div",rr,[(0,n.Lk)("img",{src:(0,o.R1)(y)("activate"),class:(0,s.C4)(["icon",{"active-icon":"activate"===ue.value}]),onError:a[3]||(a[3]=(...e)=>(0,o.R1)(_)&&(0,o.R1)(_)(...e)),onLoad:a[4]||(a[4]=(...e)=>(0,o.R1)(b)&&(0,o.R1)(b)(...e)),alt:"主动推送"},null,42,cr)]),a[48]||(a[48]=(0,n.Lk)("div",{class:"function-tooltip"},"主动推送",-1))],2),(0,n.Lk)("div",{class:(0,s.C4)(["function-item",{active:"addFriend"===ue.value}]),onClick:a[8]||(a[8]=e=>Ie("addFriend")),"data-function":"addFriend"},[(0,n.Lk)("div",ur,[(0,n.Lk)("img",{src:(0,o.R1)(y)("addFriend"),class:(0,s.C4)(["icon",{"active-icon":"addFriend"===ue.value}]),onError:a[6]||(a[6]=(...e)=>(0,o.R1)(_)&&(0,o.R1)(_)(...e)),onLoad:a[7]||(a[7]=(...e)=>(0,o.R1)(b)&&(0,o.R1)(b)(...e)),alt:"通过好友"},null,42,dr)]),a[49]||(a[49]=(0,n.Lk)("div",{class:"function-tooltip"},"通过好友",-1))],2),(0,n.Lk)("div",{class:(0,s.C4)(["function-item",{active:"addNewFriend"===ue.value}]),onClick:a[11]||(a[11]=e=>Ie("addNewFriend")),"data-function":"addNewFriend"},[(0,n.Lk)("div",vr,[(0,n.Lk)("img",{src:(0,o.R1)(y)("addNewFriend"),class:(0,s.C4)(["icon",{"active-icon":"addNewFriend"===ue.value}]),onError:a[9]||(a[9]=(...e)=>(0,o.R1)(_)&&(0,o.R1)(_)(...e)),onLoad:a[10]||(a[10]=(...e)=>(0,o.R1)(b)&&(0,o.R1)(b)(...e)),alt:"添加好友"},null,42,mr)]),a[50]||(a[50]=(0,n.Lk)("div",{class:"function-tooltip"},"添加好友",-1))],2),(0,n.Lk)("div",{class:(0,s.C4)(["function-item",{active:"autoFollow"===ue.value}]),onClick:a[14]||(a[14]=e=>Ie("autoFollow")),"data-function":"autoFollow"},[(0,n.Lk)("div",pr,[(0,n.Lk)("img",{src:(0,o.R1)(y)("autoFollow"),class:(0,s.C4)(["icon",{"active-icon":"autoFollow"===ue.value}]),onError:a[12]||(a[12]=(...e)=>(0,o.R1)(_)&&(0,o.R1)(_)(...e)),onLoad:a[13]||(a[13]=(...e)=>(0,o.R1)(b)&&(0,o.R1)(b)(...e)),alt:"自动跟单"},null,42,gr)]),a[51]||(a[51]=(0,n.Lk)("div",{class:"function-tooltip"},"自动跟单",-1))],2)])]),(0,n.Lk)("div",kr,[(0,n.Lk)("div",hr,["activate"===ue.value?((0,n.uX)(),(0,n.Wv)(No,{key:0,"greeting-groups":ve.value,"current-instance-nickname":be.value},null,8,["greeting-groups","current-instance-nickname"])):(0,n.Q3)("",!0),"comment"===ue.value?((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[a[59]||(a[59]=(0,n.Lk)("div",{class:"section-title"},"自动评论朋友圈配置",-1)),(0,n.Lk)("div",fr,[(0,n.bF)(K,{model:c.value,"label-width":"120px"},{default:(0,n.k6)(()=>[(0,n.bF)(i,{label:"条数上限"},{default:(0,n.k6)(()=>[(0,n.bo)((0,n.bF)(l,{modelValue:c.value.commentLimit,"onUpdate:modelValue":a[15]||(a[15]=e=>c.value.commentLimit=e),min:1,max:1e3,placeholder:"请输入条数限制"},null,8,["modelValue"]),[[me,"请输入条数限制"]])]),_:1}),(0,n.bF)(i,{label:"单好友次数"},{default:(0,n.k6)(()=>[(0,n.bo)((0,n.bF)(l,{modelValue:c.value.perFriendLimit,"onUpdate:modelValue":a[16]||(a[16]=e=>c.value.perFriendLimit=e),min:1,max:10,placeholder:"单个好友评论次数上限"},null,8,["modelValue"]),[[me,"单个好友评论次数的上限"]])]),_:1}),(0,n.bF)(i,{label:"循环间隔(分钟)"},{default:(0,n.k6)(()=>[(0,n.bo)((0,n.bF)(l,{modelValue:c.value.checkInterval,"onUpdate:modelValue":a[17]||(a[17]=e=>c.value.checkInterval=e),min:1,max:1440,"default-value":120,placeholder:"任务循环执行间隔时间"},null,8,["modelValue"]),[[me,"任务循环执行间隔时间"]])]),_:1}),(0,n.bF)(i,{label:"到达上次位置"},{default:(0,n.k6)(()=>[(0,n.bF)(w,{modelValue:c.value.reachLastPosition,"onUpdate:modelValue":a[18]||(a[18]=e=>c.value.reachLastPosition=e),placeholder:"请选择处理方式"},{default:(0,n.k6)(()=>[(0,n.bF)(d,{label:"终止本次任务",value:"stop"}),(0,n.bF)(d,{label:"跳过并继续",value:"skip"})]),_:1},8,["modelValue"])]),_:1}),(0,n.bF)(i,{label:"互动模式"},{default:(0,n.k6)(()=>[(0,n.bF)(w,{modelValue:c.value.interactionMode,"onUpdate:modelValue":a[19]||(a[19]=e=>c.value.interactionMode=e),placeholder:"请选择互动模式"},{default:(0,n.k6)(()=>[(0,n.bF)(d,{label:"仅点赞",value:"like_only"}),(0,n.bF)(d,{label:"仅评论",value:"comment_only"}),(0,n.bF)(d,{label:"点赞&评论",value:"like_and_comment"})]),_:1},8,["modelValue"])]),_:1}),(0,n.bF)(i,{label:"标签(非必须)"},{default:(0,n.k6)(()=>[(0,n.bF)(E,{type:"default",plain:"",onClick:Q,style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none",color:"white",padding:"8px 16px","border-radius":"6px","font-weight":"500",transition:"all 0.3s ease","box-shadow":"0 2px 4px rgba(102, 126, 234, 0.3)"},onMouseenter:a[20]||(a[20]=e=>{e.target.style.transform="translateY(-1px)",e.target.style.boxShadow="0 4px 8px rgba(102, 126, 234, 0.4)"}),onMouseleave:a[21]||(a[21]=e=>{e.target.style.transform="translateY(0)",e.target.style.boxShadow="0 2px 4px rgba(102, 126, 234, 0.3)"})},{default:(0,n.k6)(()=>[...a[53]||(a[53]=[(0,n.Lk)("i",{class:"el-icon-price-tag",style:{"margin-right":"4px"}},null,-1),(0,n.eW)(" 选择标签 ",-1)])]),_:1})]),_:1}),c.value.selectedTagNames.length>0?((0,n.uX)(),(0,n.Wv)(i,{key:0,label:""},{default:(0,n.k6)(()=>[(0,n.Lk)("div",yr,[(0,n.Lk)("div",br,[a[54]||(a[54]=(0,n.Lk)("i",{class:"el-icon-collection-tag",style:{"margin-right":"6px",color:"#7b1fa2"}},null,-1)),a[55]||(a[55]=(0,n.Lk)("span",{style:{"font-size":"13px",color:"#7b1fa2","margin-right":"6px"}},"已选：",-1)),c.value.selectedTagNames.length<=3?((0,n.uX)(),(0,n.CE)("span",_r,(0,s.v_)(c.value.selectedTagNames.join("、")),1)):((0,n.uX)(),(0,n.CE)("span",wr,(0,s.v_)(c.value.selectedTagNames.slice(0,3).join("、"))+"...等"+(0,s.v_)(c.value.selectedTagNames.length)+"个标签 ",1))])])]),_:1})):(0,n.Q3)("",!0),(0,n.bF)(i,{label:"选择智能体",class:"custom-label-form-item last-form-item"},{default:(0,n.k6)(()=>[(0,n.bF)(w,{modelValue:c.value.agentId,"onUpdate:modelValue":a[22]||(a[22]=e=>c.value.agentId=e),placeholder:"请选择智能体"},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(ce.value,e=>((0,n.uX)(),(0,n.Wv)(d,{key:e.botId,label:e.name,value:e.botId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,n.bF)(i,{label:"",class:"align-right-form-item"},{default:(0,n.k6)(()=>[(0,n.bF)(x,{modelValue:c.value.multiCycleEnabled,"onUpdate:modelValue":a[23]||(a[23]=e=>c.value.multiCycleEnabled=e),onChange:z,disabled:c.value.enabled},{default:(0,n.k6)(()=>[...a[56]||(a[56]=[(0,n.eW)(" 多微信循环 ",-1)])]),_:1},8,["modelValue","disabled"])]),_:1}),c.value.multiCycleEnabled?((0,n.uX)(),(0,n.CE)("div",{key:1,class:(0,s.C4)(["multi-cycle-box",{disabled:c.value.enabled}]),"aria-disabled":"commentConfig.enabled"},[a[57]||(a[57]=(0,n.Lk)("div",{class:"multi-cycle-tip"},"按勾选的账号循环执行朋友圈评论",-1)),(0,n.bF)(A,{modelValue:c.value.selectedAccounts,"onUpdate:modelValue":a[24]||(a[24]=e=>c.value.selectedAccounts=e)},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)($.value,e=>((0,n.uX)(),(0,n.Wv)(x,{key:e.account_id,label:e.account_id,class:"instance-item",disabled:c.value.enabled},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(e.nickname),1)]),_:2},1032,["label","disabled"]))),128))]),_:1},8,["modelValue"])],2)):(0,n.Q3)("",!0),(0,n.bF)(i,null,{default:(0,n.k6)(()=>[(0,n.Lk)("div",Lr,[(0,n.bF)(Gi,{modelValue:c.value.enabled,"onUpdate:modelValue":a[25]||(a[25]=e=>c.value.enabled=e),loading:de.value,onChange:O,"active-text":"开启任务","inactive-text":"关闭任务"},null,8,["modelValue","loading"])])]),_:1})]),_:1},8,["model"]),c.value.enabled?((0,n.uX)(),(0,n.CE)("div",Fr,[(0,n.bF)(U,null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(r.InfoFilled))]),_:1}),a[58]||(a[58]=(0,n.Lk)("span",null,"多次按shift键，可以终止执行中的评论任务",-1))])):(0,n.Q3)("",!0)])],64)):(0,n.Q3)("",!0),"addFriend"===ue.value?((0,n.uX)(),(0,n.CE)(n.FK,{key:2},[a[60]||(a[60]=(0,n.Lk)("div",{class:"section-title"},"自动通过好友配置",-1)),T.value?((0,n.uX)(),(0,n.CE)("div",Cr,[(0,n.bF)(U,null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(r.InfoFilled))]),_:1}),(0,n.Lk)("span",null,(0,s.v_)(T.value),1)])):(0,n.Q3)("",!0),(0,n.Lk)("div",Er,[(0,n.bF)(K,{model:L.value,"label-width":"120px"},{default:(0,n.k6)(()=>[(0,n.bF)(i,{label:"每日通过上限"},{default:(0,n.k6)(()=>[(0,n.bF)(l,{modelValue:L.value.maxFriendsPerDay,"onUpdate:modelValue":a[26]||(a[26]=e=>L.value.maxFriendsPerDay=e),min:1,max:100,step:1},null,8,["modelValue"])]),_:1}),(0,n.bF)(i,{label:"检查间隔(分钟)"},{default:(0,n.k6)(()=>[(0,n.bF)(l,{modelValue:L.value.checkInterval,"onUpdate:modelValue":a[27]||(a[27]=e=>L.value.checkInterval=e),min:5,max:120,step:5},null,8,["modelValue"])]),_:1}),(0,n.bF)(i,{label:"单次最大处理"},{default:(0,n.k6)(()=>[(0,n.bF)(l,{modelValue:L.value.maxProcessPerTime,"onUpdate:modelValue":a[28]||(a[28]=e=>L.value.maxProcessPerTime=e),min:1,max:20,step:1},null,8,["modelValue"])]),_:1}),(0,n.bF)(i,{label:"打招呼话术"},{default:(0,n.k6)(()=>[(0,n.bF)(w,{modelValue:L.value.greetingGroupId,"onUpdate:modelValue":a[29]||(a[29]=e=>L.value.greetingGroupId=e),placeholder:"选择打招呼话术组"},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(ve.value,e=>((0,n.uX)(),(0,n.Wv)(d,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,n.bF)(i,{label:"自动拉群"},{default:(0,n.k6)(()=>[(0,n.bF)(w,{modelValue:L.value.targetGroup,"onUpdate:modelValue":a[30]||(a[30]=e=>L.value.targetGroup=e),placeholder:"选择目标群聊",filterable:"",onFocus:X},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(t.value,e=>((0,n.uX)(),(0,n.Wv)(d,{key:e.name,label:e.name,value:e.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,n.bF)(i,{label:"好友标签",class:"friend-tag-input"},{default:(0,n.k6)(()=>[(0,n.bF)(D,{modelValue:L.value.tag,"onUpdate:modelValue":a[31]||(a[31]=e=>L.value.tag=e),placeholder:"请输入标签",maxlength:20,onInput:G},null,8,["modelValue"])]),_:1}),(0,n.bF)(i,null,{default:(0,n.k6)(()=>[(0,n.bF)(Gi,{modelValue:L.value.enabled,"onUpdate:modelValue":a[32]||(a[32]=e=>L.value.enabled=e),loading:de.value,"active-text":"开启任务","inactive-text":"关闭任务",onChange:ke},null,8,["modelValue","loading"])]),_:1})]),_:1},8,["model"])])],64)):(0,n.Q3)("",!0),"addNewFriend"===ue.value?((0,n.uX)(),(0,n.CE)(n.FK,{key:3},[(0,n.Lk)("div",Ir,[a[63]||(a[63]=(0,n.Lk)("span",null,"添加好友配置",-1)),(0,n.Lk)("div",Rr,[(0,n.bF)(E,{type:"primary",onClick:F},{default:(0,n.k6)(()=>[...a[61]||(a[61]=[(0,n.eW)(" 导入名单 ",-1)])]),_:1}),(0,n.bF)(E,{type:"info",onClick:S},{default:(0,n.k6)(()=>[...a[62]||(a[62]=[(0,n.eW)(" 记录 ",-1)])]),_:1})])]),(0,n.Lk)("div",Tr," 今日已加 "+(0,s.v_)(p.value)+" 人，剩余可加 "+(0,s.v_)(m.value)+" 人 ",1),V.value?((0,n.uX)(),(0,n.CE)("div",Vr,[(0,n.bF)(U,null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(r.InfoFilled))]),_:1}),(0,n.Lk)("span",null,(0,s.v_)(V.value),1)])):(0,n.Q3)("",!0),(0,n.Lk)("div",xr,[(0,n.bF)(K,{model:u.value,"label-width":"120px"},{default:(0,n.k6)(()=>[(0,n.bF)(i,{label:"每日添加上限"},{default:(0,n.k6)(()=>[(0,n.bF)(l,{modelValue:u.value.maxFriendsPerDay,"onUpdate:modelValue":a[33]||(a[33]=e=>u.value.maxFriendsPerDay=e),min:1,max:100,step:1},null,8,["modelValue"])]),_:1}),(0,n.bF)(i,{label:"添加间隔(分钟)"},{default:(0,n.k6)(()=>[(0,n.bF)(l,{modelValue:u.value.interval,"onUpdate:modelValue":a[34]||(a[34]=e=>u.value.interval=e),min:1,max:120,step:5},null,8,["modelValue"])]),_:1}),(0,n.bF)(i,{label:"单次添加人数"},{default:(0,n.k6)(()=>[(0,n.bF)(l,{modelValue:u.value.batchSize,"onUpdate:modelValue":a[35]||(a[35]=e=>u.value.batchSize=e),min:1,max:10,step:1},null,8,["modelValue"])]),_:1}),(0,n.bF)(i,{label:"验证消息"},{default:(0,n.k6)(()=>[(0,n.bF)(D,{modelValue:u.value.verifyMessage,"onUpdate:modelValue":a[36]||(a[36]=e=>u.value.verifyMessage=e),type:"textarea",rows:2,placeholder:"请输入添加好友时的验证消息"},null,8,["modelValue"])]),_:1}),(0,n.bF)(i,{label:""},{default:(0,n.k6)(()=>[(0,n.bF)(x,{modelValue:u.value.multiCycleEnabled,"onUpdate:modelValue":a[37]||(a[37]=e=>u.value.multiCycleEnabled=e),onChange:j,disabled:u.value.enabled},{default:(0,n.k6)(()=>[...a[64]||(a[64]=[(0,n.eW)(" 多微信循环 ",-1)])]),_:1},8,["modelValue","disabled"])]),_:1}),u.value.multiCycleEnabled?((0,n.uX)(),(0,n.CE)("div",{key:0,class:(0,s.C4)(["multi-cycle-box",{disabled:u.value.enabled}]),"aria-disabled":"addFriendConfig.enabled"},[a[65]||(a[65]=(0,n.Lk)("div",{class:"multi-cycle-tip"},"按勾选的账号循环添加好友",-1)),(0,n.bF)(A,{modelValue:u.value.selectedAccounts,"onUpdate:modelValue":a[38]||(a[38]=e=>u.value.selectedAccounts=e)},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)($.value,e=>((0,n.uX)(),(0,n.Wv)(x,{key:e.account_id,label:e.account_id,class:"instance-item",disabled:u.value.enabled},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(e.nickname),1)]),_:2},1032,["label","disabled"]))),128))]),_:1},8,["modelValue"])],2)):(0,n.Q3)("",!0),(0,n.bF)(i,null,{default:(0,n.k6)(()=>[(0,n.bF)(Gi,{modelValue:u.value.enabled,"onUpdate:modelValue":a[39]||(a[39]=e=>u.value.enabled=e),loading:de.value,"active-text":"开启任务","inactive-text":"关闭任务",onChange:M},null,8,["modelValue","loading"])]),_:1})]),_:1},8,["model"])])],64)):(0,n.Q3)("",!0),"autoFollow"===ue.value?((0,n.uX)(),(0,n.Wv)(wi,{key:4,ref_key:"autoFollowTaskListRef",ref:h},null,512)):(0,n.Q3)("",!0)]),(0,n.Lk)("div",{class:(0,s.C4)(["log-section",{hidden:!he.value}])},[a[70]||(a[70]=(0,n.Lk)("div",{class:"section-title"},"操作日志",-1)),(0,n.Lk)("div",Ar,[(0,n.bF)(ee,null,{default:(0,n.k6)(()=>["comment"===ue.value?((0,n.uX)(),(0,n.CE)(n.FK,{key:0},[ie.value.length>0?((0,n.uX)(!0),(0,n.CE)(n.FK,{key:0},(0,n.pI)(ie.value,e=>((0,n.uX)(),(0,n.CE)("div",{key:e.id,class:"log-item moment-log"},[(0,n.Lk)("div",Wr,(0,s.v_)(Ae(e.timestamp)),1),(0,n.Lk)("div",Sr,[(0,n.Lk)("div",Kr,[(0,n.bF)(U,null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(r.User))]),_:1}),(0,n.Lk)("span",null,(0,s.v_)(e.publisher),1)]),(0,n.Lk)("div",Xr,(0,s.v_)(e.content),1),(0,n.Lk)("div",$r,[e.type.includes("like")?((0,n.uX)(),(0,n.CE)("span",Ur,"❤ 点赞")):(0,n.Q3)("",!0),e.type.includes("comment")&&e.comment_content&&""!==e.comment_content.trim()?((0,n.uX)(),(0,n.CE)("span",jr,[(0,n.Lk)("span",Dr,"AI评论："+(0,s.v_)(e.comment_content),1)])):(0,n.Q3)("",!0)])])]))),128)):((0,n.uX)(),(0,n.CE)("div",Pr,[...a[66]||(a[66]=[(0,n.Lk)("img",{src:"/icon/empty.svg",alt:"暂无数据",class:"empty-icon"},null,-1),(0,n.Lk)("div",{class:"empty-text"},"最近没有新的操作记录",-1)])]))],64)):"activate"===ue.value?((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[oe.value.length>0?((0,n.uX)(!0),(0,n.CE)(n.FK,{key:0},(0,n.pI)(oe.value,e=>((0,n.uX)(),(0,n.CE)("div",{key:e.id,class:"log-item task-log"},[(0,n.Lk)("div",zr,[(0,n.Lk)("div",Mr,[(0,n.Lk)("span",Nr,(0,s.v_)(new Date(e.timestamp).toLocaleString()),1),(0,n.bF)(P,{type:te(e.status),size:"small"},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(ae(e.status)),1)]),_:2},1032,["type"])])]),(0,n.Lk)("div",Or,[(0,n.Lk)("div",Gr,[void 0!==e.progress?((0,n.uX)(),(0,n.CE)("div",qr," 发送给 "+(0,s.v_)(e.total)+" 人，已完成 "+(0,s.v_)(e.progress)+" 人 ",1)):(0,n.Q3)("",!0),(0,n.Lk)("div",Jr," 话术方式："+(0,s.v_)("agent"===e.params?.contentType?"智能体生成":"固定话术组"),1),e.params?.scheduleTime?((0,n.uX)(),(0,n.CE)("div",Br," 定时执行："+(0,s.v_)(le(e.params.scheduleTime)),1)):(0,n.Q3)("",!0)]),e.error?((0,n.uX)(),(0,n.CE)("div",Qr,[(0,n.bF)(U,null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(r.Warning))]),_:1}),(0,n.Lk)("span",null,(0,s.v_)(e.error),1)])):(0,n.Q3)("",!0)])]))),128)):((0,n.uX)(),(0,n.CE)("div",Hr,[...a[67]||(a[67]=[(0,n.Lk)("img",{src:"/icon/empty.svg",alt:"暂无数据",class:"empty-icon"},null,-1),(0,n.Lk)("div",{class:"empty-text"},"最近没有新的操作记录",-1)])]))],64)):"addFriend"===ue.value?((0,n.uX)(),(0,n.CE)(n.FK,{key:2},[ne.value.length>0?((0,n.uX)(!0),(0,n.CE)(n.FK,{key:0},(0,n.pI)(ne.value,e=>((0,n.uX)(),(0,n.CE)("div",{key:e.task_id,class:"log-item friend-log"},[(0,n.Lk)("div",Yr,[(0,n.Lk)("div",Zr,[(0,n.Lk)("span",ec,(0,s.v_)(Ae(e.time)),1),(0,n.bF)(P,{type:te(e.status),size:"small"},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(ae(e.status)),1)]),_:2},1032,["type"])])]),(0,n.Lk)("div",ac,[(0,n.Lk)("div",tc,[(0,n.Lk)("div",lc," 本次执行通过了 "+(0,s.v_)(e.processed_count)+" 个好友申请 ",1),e.tag?((0,n.uX)(),(0,n.CE)("div",nc,[(0,n.bF)(U,null,{default:(0,n.k6)(()=>[(0,n.bF)((0,o.R1)(r.PriceTag))]),_:1}),(0,n.Lk)("span",null,"添加标签: "+(0,s.v_)(e.tag),1)])):(0,n.Q3)("",!0)])])]))),128)):((0,n.uX)(),(0,n.CE)("div",sc,[...a[68]||(a[68]=[(0,n.Lk)("img",{src:"/icon/empty.svg",alt:"暂无数据",class:"empty-icon"},null,-1),(0,n.Lk)("div",{class:"empty-text"},"最近没有新的操作记录",-1)])]))],64)):"addNewFriend"===ue.value?((0,n.uX)(),(0,n.CE)(n.FK,{key:3},[v.value.length>0?((0,n.uX)(!0),(0,n.CE)(n.FK,{key:0},(0,n.pI)(v.value,e=>((0,n.uX)(),(0,n.CE)("div",{key:e.task_id,class:"log-item friend-log"},[(0,n.Lk)("div",oc,[(0,n.Lk)("div",ic,[(0,n.Lk)("span",rc,(0,s.v_)(Ae(e.time)),1)])]),(0,n.Lk)("div",cc,[(0,n.Lk)("div",uc,[(0,n.Lk)("div",dc,[(0,n.Lk)("span",null,"尝试添加 "+(0,s.v_)(e.attempt_count)+" 人，成功 "+(0,s.v_)(e.processed_count)+" 人",1)]),e.tag?((0,n.uX)(),(0,n.CE)("div",vc,[(0,n.Lk)("span",mc,"验证信息："+(0,s.v_)(e.tag),1)])):(0,n.Q3)("",!0)])])]))),128)):((0,n.uX)(),(0,n.CE)("div",pc,[...a[69]||(a[69]=[(0,n.Lk)("img",{src:"/icon/empty.svg",alt:"暂无数据",class:"empty-icon"},null,-1),(0,n.Lk)("div",{class:"empty-text"},"最近没有新的操作记录",-1)])]))],64)):"autoFollow"===ue.value?((0,n.uX)(),(0,n.Wv)(ji,{key:4,ref_key:"autoFollowLogsRef",ref:f},null,512)):(0,n.Q3)("",!0)]),_:1})])],2)]),(0,n.bF)(Io,{visible:g.value,"onUpdate:visible":a[40]||(a[40]=e=>g.value=e),cozeAgents:ce.value,onImport:N,onImportByAgent:W},null,8,["visible","cozeAgents"])]),(0,n.bF)(uo,{visible:k.value,"onUpdate:visible":a[41]||(a[41]=e=>k.value=e),onRefresh:Te},null,8,["visible"]),(0,n.bF)(re,{title:"需要授权",modelValue:C.value,"onUpdate:modelValue":a[44]||(a[44]=e=>C.value=e),width:"400px"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",gc,[(0,n.bF)(se,{title:"需要授权访问飞书文档",type:"info",description:"智能体需要获取飞书文档的访问权限，请点击下方按钮前往授权。",closable:!1,"show-icon":""}),(0,n.Lk)("div",kc,[(0,n.bF)(E,{type:"primary",onClick:R},{default:(0,n.k6)(()=>[...a[71]||(a[71]=[(0,n.eW)("去授权",-1)])]),_:1}),(0,n.bF)(E,{onClick:a[42]||(a[42]=e=>C.value=!1)},{default:(0,n.k6)(()=>[...a[72]||(a[72]=[(0,n.eW)("取消",-1)])]),_:1}),I.value?((0,n.uX)(),(0,n.Wv)(E,{key:0,type:"success",onClick:a[43]||(a[43]=e=>C.value=!1)},{default:(0,n.k6)(()=>[...a[73]||(a[73]=[(0,n.eW)("我已授权",-1)])]),_:1})):(0,n.Q3)("",!0)])])]),_:1},8,["modelValue"]),(0,n.bF)(re,{modelValue:J.value,"onUpdate:modelValue":a[46]||(a[46]=e=>J.value=e),title:"选择标签",width:"500px",onClose:Z,class:"tag-selection-dialog"},{footer:(0,n.k6)(()=>[(0,n.Lk)("div",bc,[(0,n.bF)(E,{onClick:H,class:"reset-btn"},{default:(0,n.k6)(()=>[...a[74]||(a[74]=[(0,n.eW)("重置",-1)])]),_:1}),(0,n.Lk)("div",_c,[(0,n.bF)(E,{onClick:Z},{default:(0,n.k6)(()=>[...a[75]||(a[75]=[(0,n.eW)("取消",-1)])]),_:1}),(0,n.bF)(E,{type:"primary",onClick:Y},{default:(0,n.k6)(()=>[...a[76]||(a[76]=[(0,n.eW)("确定",-1)])]),_:1})])])]),default:(0,n.k6)(()=>[(0,n.Lk)("div",hc,[(0,n.bF)(A,{modelValue:B.value,"onUpdate:modelValue":a[45]||(a[45]=e=>B.value=e),class:"tag-checkbox-group"},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(q.value,e=>((0,n.uX)(),(0,n.Wv)(x,{key:e.id,label:e.id,class:"tag-checkbox-item"},{default:(0,n.k6)(()=>[(0,n.Lk)("span",fc,(0,s.v_)(e.name),1),(0,n.Lk)("span",yc,"("+(0,s.v_)(e.count)+")",1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])],64)}}}),Lc=(0,S.A)(wc,[["__scopeId","data-v-6d38101f"]]),Fc=Lc,Cc=async e=>{try{console.log("发送激活请求:",e);const a=await fetch(`${ea.JR}/api/license/activate`,{method:"POST",headers:{...ea.b3,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)});if(console.log("激活响应状态:",a.status),!a.ok){const e=await a.json().catch(()=>null);throw console.error("激活失败响应:",e),new Error(e?.detail||`激活失败: ${a.status}`)}const t=await a.json();return console.log("激活响应数据:",t),t}catch(a){throw console.error("激活请求失败:",a),new Error(a instanceof Error?a.message:"激活失败")}},Ec=async()=>{try{const e=await fetch(`${ea.JR}/api/license/machine-code`,{method:"GET",headers:ea.b3});if(!e.ok){const a=await e.json().catch(()=>null);throw new Error(a?.detail||"获取机器码失败")}const a=await e.json();if(console.log("获取机器码响应:",a),!a.machine_code)throw new Error("获取机器码失败：响应数据格式错误");return a.machine_code}catch(e){throw console.error("获取机器码失败:",e),e}},Ic=async()=>{try{const e=await fetch(`${ea.JR}/api/license/verify`,{method:"GET",headers:{...ea.b3,Accept:"application/json"}});if(!e.ok){const a=await e.json().catch(()=>null);throw new Error(a?.detail||`验证失败: ${e.status}`)}const a=await e.json();return console.log("验证响应数据:",a),a}catch(e){throw console.error("验证请求失败:",e),new Error(e instanceof Error?e.message:"验证失败")}},Rc=(0,$.nY)("license",{state:()=>({isValid:!1,isVerified:!1,licenseInfo:null,lastVerifyTime:0}),getters:{isLicenseValid:e=>e.isValid&&e.isVerified},actions:{async verifyLicenseOnce(){const e=Date.now();if(this.isVerified&&e-this.lastVerifyTime<864e5)return this.isValid;try{const a=await Ic();return this.isValid=a.valid,this.licenseInfo=a.data||null,this.isVerified=!0,this.lastVerifyTime=e,this.isValid}catch(a){return console.error("验证授权失败:",a),this.isValid=!1,this.isVerified=!0,this.lastVerifyTime=e,!1}}}}),Tc={class:"license-container"},Vc={class:"license-content"},xc=(0,n.pM)({__name:"LicenseView",setup(e){const a=(0,l.rd)(),t=Rc(),s=(0,o.KR)(!1),r=(0,o.KR)(!1),c=(0,o.KR)(""),u=(0,o.KR)(""),d=(0,o.KR)(""),v=(0,o.KR)({activationCode:""}),m=async()=>{try{d.value=await Ec()}catch(e){console.error("获取机器码失败:",e),c.value=e instanceof Error?e.message:"获取机器码失败，请重试"}},p=()=>{navigator.clipboard.writeText(d.value).then(()=>{i.nk.success("机器码已复制到剪贴板")}).catch(()=>{i.nk.error("复制失败，请手动复制")})},g=async()=>{try{await a.push("/startup")}catch(e){console.error("路由跳转失败，尝试使用location:",e),window.location.href="/startup"}},k=async()=>{if(v.value.activationCode){s.value=!0,c.value="";try{const a=await Cc({activation_code:v.value.activationCode,machine_code:d.value});if(a.valid||"此设备已激活"===a.message)try{let e=a.data?.license_info;if(!e){const a=await Ic();if(console.log("验证结果:",a),!a?.valid)throw new Error(a?.message||"验证授权失败，请重试");e=a.data}e&&(t.$patch({isValid:!0,isVerified:!0,licenseInfo:e,lastVerifyTime:Date.now()}),r.value=!0,u.value="软件激活成功，即将跳转到主页...",i.nk.success("激活成功"),setTimeout(()=>{g()},1e3))}catch(e){console.error("验证过程详细错误:",e),c.value=e instanceof Error?e.message:"授权验证失败，请重试"}else c.value=a.message}catch(a){c.value=a instanceof Error?a.message:"激活失败，请稍后重试"}finally{s.value=!1}}else c.value="请输入激活码"},h=async()=>{try{const e=await Ic();e.valid&&(t.$patch({isValid:!0,isVerified:!0,licenseInfo:e.data,lastVerifyTime:Date.now()}),r.value=!0,u.value=`激活时间: ${new Date(e.data?.activated_at||"").toLocaleString()}`,setTimeout(()=>g(),1500))}catch(e){console.error("验证授权失败:",e),c.value="验证授权失败，请重试"}};return(0,n.sV)(async()=>{await m(),console.log("检查授权信息..."),h()}),(e,a)=>{const t=(0,n.g2)("el-button"),l=(0,n.g2)("el-alert"),o=(0,n.g2)("el-input"),i=(0,n.g2)("el-form-item"),m=(0,n.g2)("el-form"),h=(0,n.g2)("el-result"),f=(0,n.g2)("el-card");return(0,n.uX)(),(0,n.CE)("div",Tc,[(0,n.bF)(f,{class:"license-card"},{header:(0,n.k6)(()=>[...a[1]||(a[1]=[(0,n.Lk)("div",{class:"card-header"},[(0,n.Lk)("span",null,"软件授权激活")],-1)])]),default:(0,n.k6)(()=>[(0,n.Lk)("div",Vc,[r.value?((0,n.uX)(),(0,n.Wv)(h,{key:1,icon:"success",title:"软件已激活","sub-title":u.value},{extra:(0,n.k6)(()=>[(0,n.bF)(t,{type:"primary",onClick:g},{default:(0,n.k6)(()=>[...a[4]||(a[4]=[(0,n.eW)("进入首页",-1)])]),_:1})]),_:1},8,["sub-title"])):((0,n.uX)(),(0,n.CE)(n.FK,{key:0},[(0,n.bF)(l,{type:"info",title:`您的机器码: ${d.value||"正在获取..."}`,class:"mb-3"},{default:(0,n.k6)(()=>[(0,n.bF)(t,{type:"text",onClick:p},{default:(0,n.k6)(()=>[...a[2]||(a[2]=[(0,n.eW)(" 复制机器码 ",-1)])]),_:1})]),_:1},8,["title"]),c.value?((0,n.uX)(),(0,n.Wv)(l,{key:0,title:c.value,type:"error","show-icon":"",class:"mb-3"},null,8,["title"])):(0,n.Q3)("",!0),(0,n.bF)(m,{model:v.value,"label-width":"100px"},{default:(0,n.k6)(()=>[(0,n.bF)(i,{label:"激活码"},{default:(0,n.k6)(()=>[(0,n.bF)(o,{modelValue:v.value.activationCode,"onUpdate:modelValue":a[0]||(a[0]=e=>v.value.activationCode=e),placeholder:"请输入激活码"},null,8,["modelValue"])]),_:1}),(0,n.bF)(i,null,{default:(0,n.k6)(()=>[(0,n.bF)(t,{type:"primary",loading:s.value,onClick:k},{default:(0,n.k6)(()=>[...a[3]||(a[3]=[(0,n.eW)(" 激活软件 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])],64))])]),_:1})])}}}),Ac=(0,S.A)(xc,[["__scopeId","data-v-77fa1de1"]]),Wc=Ac,Sc={class:"task-main-info"},Kc={class:"task-header"},Xc={class:"task-title"},$c={class:"task-grid"},Uc={class:"info-value"},jc={class:"info-value"},Dc={class:"info-value sent"},Pc={class:"info-value"},zc={class:"task-rule"},Mc=(0,n.pM)({__name:"TaskList",props:{tasks:{}},emits:["cancel"],setup(e){return(a,t)=>{const l=(0,n.g2)("el-empty"),o=(0,n.g2)("el-button");return(0,n.uX)(),(0,n.CE)("div",null,[0===e.tasks.length?((0,n.uX)(),(0,n.Wv)(l,{key:0,description:"暂无发朋友圈计划，请先创建"})):((0,n.uX)(!0),(0,n.CE)(n.FK,{key:1},(0,n.pI)(e.tasks,e=>((0,n.uX)(),(0,n.CE)("div",{key:e.id,class:"task-item"},[(0,n.Lk)("div",Sc,[(0,n.Lk)("div",Kc,[(0,n.Lk)("div",Xc,[t[0]||(t[0]=(0,n.Lk)("span",{class:"status-dot"},null,-1)),(0,n.eW)(" "+(0,s.v_)(e.name),1)]),(0,n.bF)(o,{class:"cancel-btn",type:"danger",plain:"",onClick:t=>a.$emit("cancel",e.id)},{default:(0,n.k6)(()=>[...t[1]||(t[1]=[(0,n.eW)("取消任务",-1)])]),_:1},8,["onClick"])]),(0,n.Lk)("div",$c,[(0,n.Lk)("div",null,[t[2]||(t[2]=(0,n.Lk)("span",{class:"info-label"},"创建日期",-1)),(0,n.Lk)("span",Uc,(0,s.v_)(e.createdAt),1)]),(0,n.Lk)("div",null,[t[3]||(t[3]=(0,n.Lk)("span",{class:"info-label"},"微信账号",-1)),(0,n.Lk)("span",jc,(0,s.v_)(e.account),1)]),(0,n.Lk)("div",null,[t[4]||(t[4]=(0,n.Lk)("span",{class:"info-label"},"任务进度",-1)),(0,n.Lk)("span",Dc,"已发 "+(0,s.v_)(e.sentCount)+" 次",1)]),(0,n.Lk)("div",null,[t[5]||(t[5]=(0,n.Lk)("span",{class:"info-label"},"下次执行",-1)),(0,n.Lk)("span",Pc,(0,s.v_)(e.nextRunAt),1)])]),(0,n.Lk)("div",zc,"执行规则："+(0,s.v_)(e.ruleDesc),1)])]))),128))])}}}),Nc=(0,S.A)(Mc,[["__scopeId","data-v-11835d24"]]),Oc=Nc,Gc={class:"card"},qc={class:"stepper"},Jc={key:0},Bc={class:"form-group"},Qc={class:"form-content"},Hc={class:"form-group"},Yc={class:"form-content"},Zc={class:"mode-row"},eu={key:1,class:"range-row"},au={key:0,class:"interval-hint"},tu={class:"form-group"},lu={class:"form-content"},nu={key:0,class:"week-wrap"},su={class:"btn-row"},ou={key:1},iu={class:"form-group"},ru={class:"form-content"},cu={key:0,class:"select-left"},uu={key:1,class:"select-left"},du={key:2,class:"select-actions"},vu={class:"group-preview"},mu={key:0,class:"group-hint"},pu={key:1,class:"group-count"},gu={key:2,class:"group-list"},ku=["onClick"],hu={class:"form-group"},fu={class:"form-content"},yu={class:"form-group"},bu={class:"form-content"},_u={class:"account-option"},wu={class:"nickname"},Lu={class:"account-id"},Fu={class:"btn-row"},Cu=(0,n.pM)({__name:"CreateTaskWizard",emits:["created","cancel"],setup(e,{emit:a}){const t=(0,o.KR)(1),l=(0,o.KR)({name:"",execMode:"fixed",fixedTime:"",rangeStart:"",rangeEnd:"",cycle:"weekly",materialFolder:"",publishMode:"sequence",account:"",postCount:3}),r=(0,o.KR)([]),c=(0,o.KR)([]),u=(0,o.KR)([{label:"一",value:"1",checked:!0},{label:"二",value:"2",checked:!0},{label:"三",value:"3",checked:!0},{label:"四",value:"4",checked:!0},{label:"五",value:"5",checked:!0},{label:"六",value:"6",checked:!1},{label:"日",value:"0",checked:!1}]),d=e=>{if(2===e&&"range"===l.value.execMode){const e=F(l.value.rangeStart),a=F(l.value.rangeEnd),t=Number(l.value.postCount)||0;if(null!=e&&null!=a&&a>e&&t>0){const l=a-e,n=Math.floor(l/(t+1));if(n<15)return void i.nk.error("发圈间隔不得低于15分钟")}}t.value=e,2===e&&0===c.value.length&&E()},v=async()=>{const e=await Qi();e.success&&e.selected&&(l.value.materialFolder=e.selected,r.value=e.groups||[])},m=()=>{l.value.materialFolder="",r.value=[]},p=async e=>{if(!l.value.materialFolder)return;const a=`${l.value.materialFolder}/${e}`;await Hi(a)},g=(0,n.EW)(()=>{if(!l.value.materialFolder)return"";const e=l.value.materialFolder.split(/\\|\//);return e[e.length-1]||""}),k=a,h=e=>{if(e){if(e instanceof Date){const a=`${e.getHours()}`.padStart(2,"0"),t=`${e.getMinutes()}`.padStart(2,"0");return`${a}:${t}`}return"string"===typeof e?e:void 0}},f=async()=>{const e=u.value.filter(e=>e.checked).map(e=>e.value),a={name:l.value.name,execMode:l.value.execMode,fixedTime:h(l.value.fixedTime),rangeStart:h(l.value.rangeStart),rangeEnd:h(l.value.rangeEnd),postCount:l.value.postCount,cycle:l.value.cycle,weekDays:e,materialFolder:l.value.materialFolder,publishMode:l.value.publishMode,account:l.value.account},t=await Zi(a);t.success?(i.nk.success("任务创建成功"),k("created")):i.nk.error(t.error||"任务创建失败")},y=()=>{l.value.materialFolder||v()},b=(0,n.EW)(()=>u.value.filter(e=>e.checked).length),_=(0,n.EW)(()=>"fixed"===l.value.execMode?!!l.value.fixedTime:!!l.value.rangeStart&&!!l.value.rangeEnd),w=(0,n.EW)(()=>{const e=!!l.value.name&&l.value.name.trim().length>0,a="daily"===l.value.cycle||b.value>0;return e&&_.value&&a}),L=e=>{"weekly"===l.value.cycle&&(e.checked||0!==b.value||(e.checked=!0,i.nk.warning("最少需要选择一天")))},F=e=>{if(!e)return null;if(e instanceof Date)return 60*e.getHours()+e.getMinutes();if("string"===typeof e){const a=e.split(":");if(2===a.length){const e=Number(a[0]),t=Number(a[1]);if(!isNaN(e)&&!isNaN(t))return 60*e+t}}return null},C=(0,n.EW)(()=>{if("range"!==l.value.execMode)return"";const e=F(l.value.rangeStart),a=F(l.value.rangeEnd),t=Number(l.value.postCount)||0;if(null==e||null==a||a<=e||t<=0)return"";const n=a-e,s=Math.floor(n/(t+1));return s<=0?"":`每隔 ${s} 分钟 发一次`}),E=async()=>{try{const e=await Yi();if(e.success)if(c.value=e.instances,1===e.instances.length)l.value.account=e.instances[0].account_id;else if(e.instances.length>1){const a=e.instances.find(e=>e.is_active);a&&(l.value.account=a.account_id)}}catch{}},I=(0,n.EW)(()=>{const e=!!l.value.materialFolder,a=r.value.length>0,t=!!l.value.account;return e&&a&&t});return(e,a)=>{const o=(0,n.g2)("el-input"),i=(0,n.g2)("el-radio"),v=(0,n.g2)("el-radio-group"),k=(0,n.g2)("el-time-picker"),h=(0,n.g2)("el-input-number"),b=(0,n.g2)("el-checkbox"),_=(0,n.g2)("el-button"),F=(0,n.g2)("Close"),E=(0,n.g2)("el-icon"),R=(0,n.g2)("el-option"),T=(0,n.g2)("el-select");return(0,n.uX)(),(0,n.CE)("div",Gc,[(0,n.Lk)("div",qc,[a[14]||(a[14]=(0,n.Lk)("div",{class:"step-line"},null,-1)),(0,n.Lk)("div",{class:(0,s.C4)(["step-item",{active:1===t.value}])},[...a[12]||(a[12]=[(0,n.Lk)("div",{class:"step-circle"},"1",-1),(0,n.Lk)("div",null,"设置执行计划",-1)])],2),(0,n.Lk)("div",{class:(0,s.C4)(["step-item",{active:2===t.value}])},[...a[13]||(a[13]=[(0,n.Lk)("div",{class:"step-circle"},"2",-1),(0,n.Lk)("div",null,"配置发圈素材",-1)])],2)]),1===t.value?((0,n.uX)(),(0,n.CE)("div",Jc,[(0,n.Lk)("div",Bc,[a[15]||(a[15]=(0,n.Lk)("div",{class:"form-label"},"计划名称",-1)),(0,n.Lk)("div",Qc,[(0,n.bF)(o,{modelValue:l.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>l.value.name=e),placeholder:"请输入计划名称，如：1201-元旦发圈推广计划",style:{width:"100%"}},null,8,["modelValue"])])]),(0,n.Lk)("div",Hc,[a[20]||(a[20]=(0,n.Lk)("div",{class:"form-label"},"执行方式",-1)),(0,n.Lk)("div",Yc,[(0,n.bF)(v,{modelValue:l.value.execMode,"onUpdate:modelValue":a[1]||(a[1]=e=>l.value.execMode=e)},{default:(0,n.k6)(()=>[(0,n.bF)(i,{label:"fixed"},{default:(0,n.k6)(()=>[...a[16]||(a[16]=[(0,n.eW)("固定时间",-1)])]),_:1}),(0,n.bF)(i,{label:"range"},{default:(0,n.k6)(()=>[...a[17]||(a[17]=[(0,n.eW)("时间段(发多条)",-1)])]),_:1})]),_:1},8,["modelValue"]),(0,n.Lk)("div",Zc,["fixed"===l.value.execMode?((0,n.uX)(),(0,n.Wv)(k,{key:0,modelValue:l.value.fixedTime,"onUpdate:modelValue":a[2]||(a[2]=e=>l.value.fixedTime=e),placeholder:"选择时间",format:"HH:mm"},null,8,["modelValue"])):((0,n.uX)(),(0,n.CE)("div",eu,[(0,n.bF)(k,{modelValue:l.value.rangeStart,"onUpdate:modelValue":a[3]||(a[3]=e=>l.value.rangeStart=e),placeholder:"开始时间",format:"HH:mm",class:"time-input",style:{width:"120px"}},null,8,["modelValue"]),a[18]||(a[18]=(0,n.Lk)("span",{class:"range-sep"},"—",-1)),(0,n.bF)(k,{modelValue:l.value.rangeEnd,"onUpdate:modelValue":a[4]||(a[4]=e=>l.value.rangeEnd=e),placeholder:"结束时间",format:"HH:mm",class:"time-input",style:{width:"120px"}},null,8,["modelValue"]),(0,n.bF)(h,{modelValue:l.value.postCount,"onUpdate:modelValue":a[5]||(a[5]=e=>l.value.postCount=e),min:1,max:30,"controls-position":"right",placeholder:"发圈数",step:1,class:"post-count",style:{width:"82px"}},null,8,["modelValue"]),a[19]||(a[19]=(0,n.Lk)("span",{class:"count-unit"},"条",-1)),C.value?((0,n.uX)(),(0,n.CE)("span",au,(0,s.v_)(C.value),1)):(0,n.Q3)("",!0)]))])])]),(0,n.Lk)("div",tu,[a[23]||(a[23]=(0,n.Lk)("div",{class:"form-label"},"执行周期",-1)),(0,n.Lk)("div",lu,[(0,n.bF)(v,{modelValue:l.value.cycle,"onUpdate:modelValue":a[6]||(a[6]=e=>l.value.cycle=e)},{default:(0,n.k6)(()=>[(0,n.bF)(i,{label:"daily"},{default:(0,n.k6)(()=>[...a[21]||(a[21]=[(0,n.eW)("每天",-1)])]),_:1}),(0,n.bF)(i,{label:"weekly"},{default:(0,n.k6)(()=>[...a[22]||(a[22]=[(0,n.eW)("每周",-1)])]),_:1})]),_:1},8,["modelValue"]),"weekly"===l.value.cycle?((0,n.uX)(),(0,n.CE)("div",nu,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(u.value,e=>((0,n.uX)(),(0,n.Wv)(b,{key:e.value,modelValue:e.checked,"onUpdate:modelValue":a=>e.checked=a,onChange:a=>L(e)},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(e.label),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]))),128))])):(0,n.Q3)("",!0)])]),(0,n.Lk)("div",su,[(0,n.bF)(_,{onClick:a[7]||(a[7]=a=>e.$emit("cancel"))},{default:(0,n.k6)(()=>[...a[24]||(a[24]=[(0,n.eW)("取消",-1)])]),_:1}),(0,n.bF)(_,{type:"primary",disabled:!w.value,onClick:a[8]||(a[8]=e=>d(2))},{default:(0,n.k6)(()=>[...a[25]||(a[25]=[(0,n.eW)("下一步",-1)])]),_:1},8,["disabled"])])])):((0,n.uX)(),(0,n.CE)("div",ou,[(0,n.Lk)("div",iu,[a[26]||(a[26]=(0,n.Lk)("div",{class:"form-label"},"添加素材组",-1)),(0,n.Lk)("div",ru,[(0,n.Lk)("div",{class:(0,s.C4)(["select-module",l.value.materialFolder?"selected":"unselected"]),onClick:y},[l.value.materialFolder?((0,n.uX)(),(0,n.CE)("div",uu," 已选："+(0,s.v_)(g.value),1)):((0,n.uX)(),(0,n.CE)("div",cu,"请选择素材文件夹")),l.value.materialFolder?((0,n.uX)(),(0,n.CE)("div",du,[(0,n.bF)(_,{size:"small",type:"danger",plain:"",onClick:m},{default:(0,n.k6)(()=>[(0,n.bF)(E,null,{default:(0,n.k6)(()=>[(0,n.bF)(F)]),_:1})]),_:1})])):(0,n.Q3)("",!0)],2),(0,n.Lk)("div",vu,[l.value.materialFolder?((0,n.uX)(),(0,n.CE)("div",pu,"包含 "+(0,s.v_)(r.value.length)+" 个素材组",1)):((0,n.uX)(),(0,n.CE)("div",mu,"选择素材文件夹，可预览素材组")),l.value.materialFolder?((0,n.uX)(),(0,n.CE)("div",gu,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(r.value,e=>((0,n.uX)(),(0,n.CE)("div",{class:"group-item",key:e,onClick:a=>p(e)},(0,s.v_)(e),9,ku))),128))])):(0,n.Q3)("",!0)])])]),(0,n.Lk)("div",hu,[a[29]||(a[29]=(0,n.Lk)("div",{class:"form-label"},"发布方式",-1)),(0,n.Lk)("div",fu,[(0,n.bF)(v,{modelValue:l.value.publishMode,"onUpdate:modelValue":a[9]||(a[9]=e=>l.value.publishMode=e)},{default:(0,n.k6)(()=>[(0,n.bF)(i,{label:"sequence"},{default:(0,n.k6)(()=>[...a[27]||(a[27]=[(0,n.eW)("按顺序发布",-1)])]),_:1}),(0,n.bF)(i,{label:"random"},{default:(0,n.k6)(()=>[...a[28]||(a[28]=[(0,n.eW)("随机发布",-1)])]),_:1})]),_:1},8,["modelValue"])])]),(0,n.Lk)("div",yu,[a[30]||(a[30]=(0,n.Lk)("div",{class:"form-label"},"选择账号",-1)),(0,n.Lk)("div",bu,[(0,n.bF)(T,{modelValue:l.value.account,"onUpdate:modelValue":a[10]||(a[10]=e=>l.value.account=e),placeholder:"选择微信账号"},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(c.value,e=>((0,n.uX)(),(0,n.Wv)(R,{key:e.account_id,label:e.nickname,value:e.account_id},{default:(0,n.k6)(()=>[(0,n.Lk)("span",_u,[(0,n.Lk)("span",wu,(0,s.v_)(e.nickname),1),(0,n.Lk)("span",Lu,(0,s.v_)(e.account_id),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])])]),(0,n.Lk)("div",Fu,[(0,n.bF)(_,{onClick:a[11]||(a[11]=e=>d(1))},{default:(0,n.k6)(()=>[...a[31]||(a[31]=[(0,n.eW)("上一步",-1)])]),_:1}),(0,n.bF)(_,{type:"primary",disabled:!I.value,onClick:f},{default:(0,n.k6)(()=>[...a[32]||(a[32]=[(0,n.eW)("生成任务",-1)])]),_:1},8,["disabled"])])]))])}}}),Eu=(0,S.A)(Cu,[["__scopeId","data-v-4675d005"]]),Iu=Eu,Ru={key:0,class:"empty"},Tu={key:1,class:"log-list"},Vu={class:"log-header"},xu={class:"plan"},Au={class:"time"},Wu=["title"],Su={class:"footer"},Ku=(0,n.pM)({__name:"MomentLogsDialog",props:{visible:{type:Boolean},logs:{}},emits:["update:visible"],setup(e,{emit:a}){const t=e,l=a,o=(0,n.EW)({get:()=>t.visible,set:e=>l("update:visible",e)}),i=(0,n.EW)(()=>t.logs.map(e=>{const a=new Date(e.timestamp),t=`${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")} ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`,l=e.folder_path.split(/\\|\//),n=l.length>=2?l[l.length-2]:e.folder_path;return{...e,time:t,planName:n}})),r=()=>l("update:visible",!1),c=async e=>{await Hi(e)};return(a,t)=>{const l=(0,n.g2)("el-button"),u=(0,n.g2)("el-dialog");return(0,n.uX)(),(0,n.Wv)(u,{modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=e=>o.value=e),title:"发圈日志",width:"620px"},{footer:(0,n.k6)(()=>[(0,n.bF)(l,{onClick:r},{default:(0,n.k6)(()=>[...t[2]||(t[2]=[(0,n.eW)("关闭",-1)])]),_:1})]),default:(0,n.k6)(()=>[t[3]||(t[3]=(0,n.Lk)("div",{class:"subtitle"},"最近48小时，发朋友圈任务记录",-1)),0===e.logs.length?((0,n.uX)(),(0,n.CE)("div",Ru,"暂无日志记录")):((0,n.uX)(),(0,n.CE)("div",Tu,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(i.value,e=>((0,n.uX)(),(0,n.CE)("div",{key:e.id,class:"log-item"},[(0,n.Lk)("div",Vu,[(0,n.Lk)("div",xu,(0,s.v_)(e.planName),1),(0,n.Lk)("div",Au,(0,s.v_)(e.time),1),(0,n.Lk)("div",{class:(0,s.C4)(["status","success"===e.status?"ok":"fail"])},(0,s.v_)("success"===e.status?"发表成功":"发表失败"),3)]),(0,n.Lk)("div",{class:"text",title:e.text},(0,s.v_)(e.text),9,Wu),(0,n.Lk)("div",Su,[(0,n.Lk)("span",null,"账号："+(0,s.v_)(e.account),1),(0,n.bF)(l,{link:"",type:"primary",onClick:a=>c(e.folder_path)},{default:(0,n.k6)(()=>[...t[1]||(t[1]=[(0,n.eW)("查看素材",-1)])]),_:1},8,["onClick"])])]))),128))]))]),_:1},8,["modelValue"])}}}),Xu=(0,S.A)(Ku,[["__scopeId","data-v-64dcd870"]]),$u=Xu,Uu={class:"moments-container"},ju={class:"page-header"},Du={class:"title-wrap"},Pu={class:"title-line"},zu={class:"inline-stat"},Mu={class:"actions"},Nu={class:"content-grid"},Ou={class:"mini-sidebar"},Gu={class:"main-section"},qu=(0,n.pM)({name:"MomentsView",__name:"MomentsView",setup(e){const a=(0,o.KR)("list"),t=(0,o.KR)([]),l=(0,o.KR)(!1),r=(0,o.KR)([]),c=(0,o.KR)(0),u=(0,n.EW)(()=>{const e=new Date,a=e.getFullYear(),t=e.getMonth(),l=e.getDate();return r.value.filter(e=>{if("success"!==e.status)return!1;const n=new Date(e.timestamp);return n.getFullYear()===a&&n.getMonth()===t&&n.getDate()===l}).length}),d=e=>{a.value=e,"list"===e&&p()},v=async e=>{try{await Ke.s.confirm("确认取消该任务？","提示",{type:"warning"});const a=await ar(e);a.success?(t.value=t.value.filter(a=>a.id!==e),i.nk.success("已取消任务")):i.nk.error("取消任务失败")}catch{}},m=()=>{i.nk.success("任务创建成功"),a.value="list",p(),c.value++},p=async()=>{try{const e=await er();e.success&&(t.value=e.tasks)}catch{}};(0,n.sV)(()=>{p(),g()});const g=async()=>{try{const e=await tr();e.success&&(r.value=e.logs)}catch{}},k=async()=>{await g(),l.value=!0};return(e,o)=>{const i=(0,n.g2)("el-button");return(0,n.uX)(),(0,n.CE)("div",Uu,[(0,n.Lk)("div",ju,[(0,n.Lk)("div",Du,[(0,n.Lk)("div",Pu,[o[3]||(o[3]=(0,n.Lk)("div",{class:"page-title"},"朋友圈任务",-1)),(0,n.Lk)("div",zu,"今日自动发圈："+(0,s.v_)(u.value)+" 条",1)]),o[4]||(o[4]=(0,n.Lk)("div",{class:"page-subtitle"},"发朋友圈仅支持 4.0 以上微信",-1))]),(0,n.Lk)("div",Mu,[(0,n.bF)(i,{type:"primary",plain:"",onClick:k},{default:(0,n.k6)(()=>[...o[5]||(o[5]=[(0,n.eW)("发圈日志",-1)])]),_:1})])]),(0,n.Lk)("div",Nu,[(0,n.Lk)("aside",Ou,[(0,n.Lk)("div",{class:(0,s.C4)(["icon-btn",{active:"list"===a.value}]),onClick:o[0]||(o[0]=e=>d("list")),"data-title":"任务列表"},[...o[6]||(o[6]=[(0,n.Lk)("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[(0,n.Lk)("path",{d:"M4 6h16M4 12h16M4 18h16"})],-1)])],2),(0,n.Lk)("div",{class:(0,s.C4)(["icon-btn",{active:"create"===a.value}]),onClick:o[1]||(o[1]=e=>d("create")),"data-title":"新建任务"},[...o[7]||(o[7]=[(0,n.Lk)("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[(0,n.Lk)("path",{d:"M12 4v16m8-8H4"})],-1)])],2)]),(0,n.Lk)("section",Gu,[(0,n.bo)((0,n.bF)(Oc,{tasks:t.value,onCancel:v},null,8,["tasks"]),[[Se.aG,"list"===a.value]]),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(Iu,{key:c.value,onCreated:m})),[[Se.aG,"create"===a.value]]),(0,n.bF)($u,{visible:l.value,"onUpdate:visible":o[2]||(o[2]=e=>l.value=e),logs:r.value},null,8,["visible","logs"])])])])}}}),Ju=(0,S.A)(qu,[["__scopeId","data-v-10fa749c"]]),Bu=Ju,Qu=()=>window.innerWidth<650,Hu=[{path:"/license",name:"License",component:Wc},{path:"/",redirect:"/startup"},{path:"/startup",name:"StartupPage",component:X},{path:"/welcome",name:"WelcomePage",component:We,meta:{requiresStartup:!0}},{path:"/ai-chat",name:"AiChat",component:vn,meta:{requiresStartup:!0,shouldHideRightPanel:Qu}},{path:"/customer-management",name:"CustomerManagement",component:()=>t.e(618).then(t.bind(t,9618)),meta:{requiresStartup:!0}},{path:"/moments",name:"Moments",component:Bu,meta:{requiresStartup:!0}},{path:"/settings",name:"Settings",component:no,meta:{requiresStartup:!0}},{path:"/auto-add",name:"AutoSOP",component:Fc,meta:{requiresStartup:!0,shouldHideRightPanel:Qu},props:e=>({activeFunction:e.params.activeFunction})}],Yu=(0,l.aE)({history:(0,l.LA)(""),routes:Hu});Yu.beforeEach(async(e,a,t)=>{if("License"===e.name)return void t();const l=Rc();if(!l.isLicenseValid){if(l.isVerified)return void t("/license");{const e=await l.verifyLicenseOnce();if(!e)return void t("/license")}}t()}),Yu.afterEach(e=>{console.debug("after路由加载完成:",e.path)});const Zu=Yu},9220(e,a,t){t.a(e,async(e,a)=>{try{var l=t(5130),n=t(2261),s=t(6297),o=t(9048),i=t(3863),r=t(477),c=(t(4188),t(5186)),u=t(7477),d=t(4032),v=t(3957),m=t(7394);const e=(0,l.Ef)(s.A),p=(0,n.Ey)();e.use(p);const g=(0,v.J)(),k=(0,m.C)(),h=()=>{d.Y?(console.log("初始化websocket....success"),window.addEventListener("ws-error",e=>{console.error("WebSocket error:",e.detail)}),document.addEventListener("visibilitychange",()=>{"visible"===document.visibilityState&&(console.log("页面变为可见，检查 WebSocket 连接..."),d.Y.checkConnection())}),window.addEventListener("online",()=>{console.log("网络恢复，尝试重新连接 WebSocket..."),d.Y.checkConnection()})):console.error("WebSocket client initialization failed")};window.addEventListener("DOMContentLoaded",()=>{h()});for(const[a,t]of Object.entries(u))e.component(a,t);h(),await g.loadConfig(),k.initTheme(),e.use(r.A,{locale:c.A}),e.use(r.A),e.use(o.A),e.use(i.A),e.mount("#app"),a()}catch(p){a(p)}},1)}},a={};function t(l){var n=a[l];if(void 0!==n)return n.exports;var s=a[l]={id:l,loaded:!1,exports:{}};return e[l].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}t.m=e,(()=>{var e="function"===typeof Symbol,a=e?Symbol("webpack queues"):"__webpack_queues__",l=e?Symbol("webpack exports"):"__webpack_exports__",n=e?Symbol("webpack error"):"__webpack_error__",s=e=>{e&&e.d<1&&(e.d=1,e.forEach(e=>e.r--),e.forEach(e=>e.r--?e.r++:e()))},o=e=>e.map(e=>{if(null!==e&&"object"===typeof e){if(e[a])return e;if(e.then){var t=[];t.d=0,e.then(e=>{o[l]=e,s(t)},e=>{o[n]=e,s(t)});var o={};return o[a]=e=>e(t),o}}var i={};return i[a]=e=>{},i[l]=e,i});t.a=(e,t,i)=>{var r;i&&((r=[]).d=-1);var c,u,d,v=new Set,m=e.exports,p=new Promise((e,a)=>{d=a,u=e});p[l]=m,p[a]=e=>(r&&e(r),v.forEach(e),p["catch"](e=>{})),e.exports=p;var g=e=>{var t;c=o(e);var s=()=>c.map(e=>{if(e[n])throw e[n];return e[l]}),i=new Promise(e=>{t=()=>e(s),t.r=0;var l=e=>e!==r&&!v.has(e)&&(v.add(e),e&&!e.d&&(t.r++,e.push(t)));c.map(e=>e[a](l))});return t.r?i:s()},k=e=>(e?d(p[n]=e):u(m),s(r));t(g,k),r&&r.d<0&&(r.d=0)}})(),(()=>{var e=[];t.O=(a,l,n,s)=>{if(!l){var o=1/0;for(u=0;u<e.length;u++){for(var[l,n,s]=e[u],i=!0,r=0;r<l.length;r++)(!1&s||o>=s)&&Object.keys(t.O).every(e=>t.O[e](l[r]))?l.splice(r--,1):(i=!1,s<o&&(o=s));if(i){e.splice(u--,1);var c=n();void 0!==c&&(a=c)}}return a}s=s||0;for(var u=e.length;u>0&&e[u-1][2]>s;u--)e[u]=e[u-1];e[u]=[l,n,s]}})(),(()=>{t.n=e=>{var a=e&&e.__esModule?()=>e["default"]:()=>e;return t.d(a,{a}),a}})(),(()=>{t.d=(e,a)=>{for(var l in a)t.o(a,l)&&!t.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:a[l]})}})(),(()=>{t.f={},t.e=e=>Promise.all(Object.keys(t.f).reduce((a,l)=>(t.f[l](e,a),a),[]))})(),(()=>{t.u=e=>"js/"+e+".097d1742.js"})(),(()=>{t.miniCssF=e=>"css/"+e+".8a66e94a.css"})(),(()=>{t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{t.o=(e,a)=>Object.prototype.hasOwnProperty.call(e,a)})(),(()=>{var e={},a="webot:";t.l=(l,n,s,o)=>{if(e[l])e[l].push(n);else{var i,r;if(void 0!==s)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==l||d.getAttribute("data-webpack")==a+s){i=d;break}}i||(r=!0,i=document.createElement("script"),i.charset="utf-8",t.nc&&i.setAttribute("nonce",t.nc),i.setAttribute("data-webpack",a+s),i.src=l),e[l]=[n];var v=(a,t)=>{i.onerror=i.onload=null,clearTimeout(m);var n=e[l];if(delete e[l],i.parentNode&&i.parentNode.removeChild(i),n&&n.forEach(e=>e(t)),a)return a(t)},m=setTimeout(v.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=v.bind(null,i.onerror),i.onload=v.bind(null,i.onload),r&&document.head.appendChild(i)}}})(),(()=>{t.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{t.nmd=e=>(e.paths=[],e.children||(e.children=[]),e)})(),(()=>{t.p=""})(),(()=>{if("undefined"!==typeof document){var e=(e,a,l,n,s)=>{var o=document.createElement("link");o.rel="stylesheet",o.type="text/css",t.nc&&(o.nonce=t.nc);var i=t=>{if(o.onerror=o.onload=null,"load"===t.type)n();else{var l=t&&t.type,i=t&&t.target&&t.target.href||a,r=new Error("Loading CSS chunk "+e+" failed.\n("+l+": "+i+")");r.name="ChunkLoadError",r.code="CSS_CHUNK_LOAD_FAILED",r.type=l,r.request=i,o.parentNode&&o.parentNode.removeChild(o),s(r)}};return o.onerror=o.onload=i,o.href=a,l?l.parentNode.insertBefore(o,l.nextSibling):document.head.appendChild(o),o},a=(e,a)=>{for(var t=document.getElementsByTagName("link"),l=0;l<t.length;l++){var n=t[l],s=n.getAttribute("data-href")||n.getAttribute("href");if("stylesheet"===n.rel&&(s===e||s===a))return n}var o=document.getElementsByTagName("style");for(l=0;l<o.length;l++){n=o[l],s=n.getAttribute("data-href");if(s===e||s===a)return n}},l=l=>new Promise((n,s)=>{var o=t.miniCssF(l),i=t.p+o;if(a(o,i))return n();e(l,i,null,n,s)}),n={524:0};t.f.miniCss=(e,a)=>{var t={618:1};n[e]?a.push(n[e]):0!==n[e]&&t[e]&&a.push(n[e]=l(e).then(()=>{n[e]=0},a=>{throw delete n[e],a}))}}})(),(()=>{var e={524:0};t.f.j=(a,l)=>{var n=t.o(e,a)?e[a]:void 0;if(0!==n)if(n)l.push(n[2]);else{var s=new Promise((t,l)=>n=e[a]=[t,l]);l.push(n[2]=s);var o=t.p+t.u(a),i=new Error,r=l=>{if(t.o(e,a)&&(n=e[a],0!==n&&(e[a]=void 0),n)){var s=l&&("load"===l.type?"missing":l.type),o=l&&l.target&&l.target.src;i.message="Loading chunk "+a+" failed.\n("+s+": "+o+")",i.name="ChunkLoadError",i.type=s,i.request=o,n[1](i)}};t.l(o,r,"chunk-"+a,a)}},t.O.j=a=>0===e[a];var a=(a,l)=>{var n,s,[o,i,r]=l,c=0;if(o.some(a=>0!==e[a])){for(n in i)t.o(i,n)&&(t.m[n]=i[n]);if(r)var u=r(t)}for(a&&a(l);c<o.length;c++)s=o[c],t.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return t.O(u)},l=self["webpackChunkwebot"]=self["webpackChunkwebot"]||[];l.forEach(a.bind(null,0)),l.push=a.bind(null,l.push.bind(l))})();var l=t.O(void 0,[504],()=>t(9220));l=t.O(l)})();
//# sourceMappingURL=app.1dde3517.js.map